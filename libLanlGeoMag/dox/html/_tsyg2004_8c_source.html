<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>LanlGeoMag: /home/mgh/LanlGeoMag/libLanlGeoMag/Tsyg2004.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>/home/mgh/LanlGeoMag/libLanlGeoMag/Tsyg2004.c</h1><a href="_tsyg2004_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* WARNING!!!!!!!!!!</span>
<a name="l00002"></a>00002 <span class="comment"> *  This codes is NOT yet re-entrant!!!!</span>
<a name="l00003"></a>00003 <span class="comment"> *  Dont run it multi-threaded.</span>
<a name="l00004"></a>00004 <span class="comment"> *  We need to sort out all of the static vars....</span>
<a name="l00005"></a>00005 <span class="comment"> */</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00009"></a>00009 
<a name="l00010"></a><a class="code" href="_tsyg2004_8c.html#a8cecfc5c5c054d2875c03e77b7be15d">00010</a> <span class="preprocessor">#define TRUE 1</span>
<a name="l00011"></a><a class="code" href="_tsyg2004_8c.html#a93f0eb578d23995850d61f7d61c55c1">00011</a> <span class="preprocessor"></span><span class="preprocessor">#define FALSE 0</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span>
<a name="l00013"></a>00013 <span class="comment">/*</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> *    Converted to C by Michael G. Henderson (mghenderson@lanl.gov) Jan 5, 2005.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> *    ASSEMBLED:  MARCH 25, 2004; UPDATED:  AUGUST 2 &amp; 31, DECEMBER 27, 2004.</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> *  ------------------------------------------------------------------------------------------</span>
<a name="l00023"></a>00023 <span class="comment"> *    A DATA-BASED MODEL OF THE EXTERNAL (I.E., WITHOUT EARTH'S CONTRIBUTION) PART OF THE</span>
<a name="l00024"></a>00024 <span class="comment"> *    MAGNETOSPHERIC MAGNETIC FIELD, CALIBRATED BY</span>
<a name="l00025"></a>00025 <span class="comment"> *     (1) SOLAR WIND PRESSURE PDYN (NANOPASCALS),</span>
<a name="l00026"></a>00026 <span class="comment"> *     (2) DST (NANOTESLA),</span>
<a name="l00027"></a>00027 <span class="comment"> *     (3) BYIMF,</span>
<a name="l00028"></a>00028 <span class="comment"> *     (4) BZIMF (NANOTESLA)</span>
<a name="l00029"></a>00029 <span class="comment"> *     (5-10)   INDICES W1 - W6, CALCULATED AS TIME INTEGRALS FROM THE BEGINNING OF A STORM</span>
<a name="l00030"></a>00030 <span class="comment"> *                SEE THE REFERENCE (3) BELOW, FOR A DETAILED DEFINITION OF THOSE VARIABLES</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> *    THE ABOVE 10 INPUT PARAMETERS SHOULD BE PLACED IN THE ELEMENTS</span>
<a name="l00033"></a>00033 <span class="comment"> *    OF THE ARRAY PARMOD(10).</span>
<a name="l00034"></a>00034 <span class="comment"> *</span>
<a name="l00035"></a>00035 <span class="comment"> *    THE REST OF THE INPUT VARIABLES ARE: THE GEODIPOLE TILT ANGLE PS (RADIANS),</span>
<a name="l00036"></a>00036 <span class="comment"> *         X,Y,Z -  GSM POSITION (RE)</span>
<a name="l00037"></a>00037 <span class="comment"> *</span>
<a name="l00038"></a>00038 <span class="comment"> *    IOPT IS A DUMMY INPUT PARAMETER, INCLUDED TO MAKE THIS SUBROUTINE</span>
<a name="l00039"></a>00039 <span class="comment"> *    COMPATIBLE WITH THE TRACING SOFTWARE PACKAGE (GEOPACK). IN THIS MODEL,</span>
<a name="l00040"></a>00040 <span class="comment"> *    THE PARAMETER IOPT DOES NOT AFFECT THE OUTPUT FIELD.</span>
<a name="l00041"></a>00041 <span class="comment"> *</span>
<a name="l00042"></a>00042 <span class="comment"> *    ******************************************************************************************</span>
<a name="l00043"></a>00043 <span class="comment"> *    * ATTENTION:  THE MODEL IS BASED ON DATA TAKEN SUNWARD FROM X=-15Re, AND HENCE BECOMES   *</span>
<a name="l00044"></a>00044 <span class="comment"> *    *              INVALID AT LARGER TAILWARD DISTANCES !!!                                  *</span>
<a name="l00045"></a>00045 <span class="comment"> *    ******************************************************************************************</span>
<a name="l00046"></a>00046 <span class="comment"> *</span>
<a name="l00047"></a>00047 <span class="comment"> *    OUTPUT:  GSM COMPONENTS OF THE EXTERNAL MAGNETIC FIELD (BX,BY,BZ, nanotesla)</span>
<a name="l00048"></a>00048 <span class="comment"> *             COMPUTED AS A SUM OF CONTRIBUTIONS FROM PRINCIPAL FIELD SOURCES</span>
<a name="l00049"></a>00049 <span class="comment"> *</span>
<a name="l00050"></a>00050 <span class="comment"> *   (C) Copr. 2004, Nikolai A. Tsyganenko, USRA/Code 695.1, NASA GSFC</span>
<a name="l00051"></a>00051 <span class="comment"> *       Greenbelt, MD 20771, USA</span>
<a name="l00052"></a>00052 <span class="comment"> *</span>
<a name="l00053"></a>00053 <span class="comment"> *                             REFERENCES:</span>
<a name="l00054"></a>00054 <span class="comment"> *</span>
<a name="l00055"></a>00055 <span class="comment"> *   (1)   N. A. Tsyganenko, A new data-based model of the near magnetosphere magnetic field:</span>
<a name="l00056"></a>00056 <span class="comment"> *        1. Mathematical structure.</span>
<a name="l00057"></a>00057 <span class="comment"> *        2. Parameterization and fitting to observations.  JGR v. 107(A8), 1176/1179, doi:10.1029/2001JA000219/220, 2002.</span>
<a name="l00058"></a>00058 <span class="comment"> *</span>
<a name="l00059"></a>00059 <span class="comment"> *   (2)  N. A. Tsyganenko, H. J. Singer, J. C. Kasper, Storm-time distortion of the</span>
<a name="l00060"></a>00060 <span class="comment"> *            inner magnetosphere: How severe can it get ?  JGR v. 108(A5), 1209, doi:10.1029/2002JA009808, 2003.</span>
<a name="l00061"></a>00061 <span class="comment"> *</span>
<a name="l00062"></a>00062 <span class="comment"> *</span>
<a name="l00063"></a>00063 <span class="comment"> *   (3)  N. A. Tsyganenko and M. I. Sitnov, Modeling the dynamics of the inner</span>
<a name="l00064"></a>00064 <span class="comment"> *            magnetosphere during strong geomagnetic storms,  JGR v. 110, 2005, in press.</span>
<a name="l00065"></a>00065 <span class="comment"> *</span>
<a name="l00066"></a>00066 <span class="comment"> *</span>
<a name="l00067"></a>00067 <span class="comment"> *  ------------------------------------------------------------------------------------------</span>
<a name="l00068"></a>00068 <span class="comment"> *</span>
<a name="l00069"></a>00069 <span class="comment"> *</span>
<a name="l00070"></a>00070 <span class="comment"> */</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="comment">/*</span>
<a name="l00075"></a>00075 <span class="comment"> * Define some structures to accomodate the FORTRAN common blocks</span>
<a name="l00076"></a>00076 <span class="comment"> */</span>
<a name="l00077"></a><a class="code" href="struct___c_b___t_a_i_l.html#5947c5dfec8ec63b76f2a46d1719af3c">00077</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___c_b___t_a_i_l.html">_CB_TAIL</a>        { <span class="keywordtype">double</span> <a class="code" href="struct___c_b___t_a_i_l.html#12fe869b3516cc1eb6b73890b20335bc">DXSHIFT1</a>, <a class="code" href="struct___c_b___t_a_i_l.html#5947c5dfec8ec63b76f2a46d1719af3c">DXSHIFT2</a>, <a class="code" href="struct___c_b___t_a_i_l.html#d8657a5ec76e12f3066fb4b4eb75ace9">D</a>, <a class="code" href="struct___c_b___t_a_i_l.html#cf76b5500556d063c5d6cec9508879f6">DELTADY</a>; } <a class="code" href="struct___c_b___t_a_i_l.html">_CB_TAIL</a>;
<a name="l00078"></a><a class="code" href="struct___c_b___b_i_r_k_p_a_r.html#7939266cf05911b5c6f6e46e4e09e87c">00078</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___c_b___b_i_r_k_p_a_r.html">_CB_BIRKPAR</a>     { <span class="keywordtype">double</span> <a class="code" href="struct___c_b___b_i_r_k_p_a_r.html#09d632f8debd75ca49c99493f5f7be3d">XKAPPA1</a>, <a class="code" href="struct___c_b___b_i_r_k_p_a_r.html#7939266cf05911b5c6f6e46e4e09e87c">XKAPPA2</a>;               } <a class="code" href="struct___c_b___b_i_r_k_p_a_r.html">_CB_BIRKPAR</a>;
<a name="l00079"></a><a class="code" href="struct___c_b___r_c_p_a_r.html#a409bcc6077e57d83a88020286993cce">00079</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___c_b___r_c_p_a_r.html">_CB_RCPAR</a>       { <span class="keywordtype">double</span> <a class="code" href="struct___c_b___r_c_p_a_r.html#a409bcc6077e57d83a88020286993cce">SC_SY</a>, <a class="code" href="struct___c_b___r_c_p_a_r.html#4973a953d8c39d5be8e952d041b6adf4">SC_AS</a>, <a class="code" href="struct___c_b___r_c_p_a_r.html#38d8f926202c5208f4ea151b52bfe3ef">PHI</a>;              } <a class="code" href="struct___c_b___r_c_p_a_r.html">_CB_RCPAR</a>;
<a name="l00080"></a><a class="code" href="struct___c_b___g.html#67783a2c4f670ee5a9dadcf428324d32">00080</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___c_b___g.html">_CB_G</a>           { <span class="keywordtype">double</span> <a class="code" href="struct___c_b___g.html#67783a2c4f670ee5a9dadcf428324d32">G</a>;                              } <a class="code" href="struct___c_b___g.html">_CB_G</a>;
<a name="l00081"></a><a class="code" href="struct___c_b___r_h0.html#b8de82fc4984cbf441791ce41d02862e">00081</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___c_b___r_h0.html">_CB_RH0</a>         { <span class="keywordtype">double</span> <a class="code" href="struct___c_b___r_h0.html#b8de82fc4984cbf441791ce41d02862e">RH0</a>;                            } <a class="code" href="struct___c_b___r_h0.html">_CB_RH0</a>;      <span class="comment">// Its R-H-"Zero"</span>
<a name="l00082"></a><a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#c47e67864f6ce1555c7fbb0ca0429a1b">00082</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html">_CB_DPHI_B_RHO0</a> { <span class="keywordtype">double</span> <a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#bfa5828793e470e32c7cd371b5d698d4">DPHI</a>, <a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#df085adbf76beb194ac436d42cd1d725">B</a>, <a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#aaec50d7de5ec25604a887bb774a5ad2">RHO_0</a>, <a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#c47e67864f6ce1555c7fbb0ca0429a1b">XKAPPA</a>;         } <a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html">_CB_DPHI_B_RHO0</a>;
<a name="l00083"></a><a class="code" href="struct___c_b___m_o_d_e_n_u_m.html#5e78dbd5fd0fc01ba7b98dd15e27221e">00083</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___c_b___m_o_d_e_n_u_m.html">_CB_MODENUM</a>     { <span class="keywordtype">int</span> <a class="code" href="struct___c_b___m_o_d_e_n_u_m.html#5e78dbd5fd0fc01ba7b98dd15e27221e">M</a>;                                 } <a class="code" href="struct___c_b___m_o_d_e_n_u_m.html">_CB_MODENUM</a>;
<a name="l00084"></a><a class="code" href="struct___c_b___d_t_h_e_t_a.html#4a563a70a3df6760bcba2788ae797e76">00084</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___c_b___d_t_h_e_t_a.html">_CB_DTHETA</a>      { <span class="keywordtype">double</span> <a class="code" href="struct___c_b___d_t_h_e_t_a.html#4a563a70a3df6760bcba2788ae797e76">DTHETA</a>;                         } <a class="code" href="struct___c_b___d_t_h_e_t_a.html">_CB_DTHETA</a>;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="comment">/*</span>
<a name="l00088"></a>00088 <span class="comment"> *  Define the "COMMON BLOCK" structures as global</span>
<a name="l00089"></a>00089 <span class="comment"> *   BAD</span>
<a name="l00090"></a>00090 <span class="comment"> *   BAD</span>
<a name="l00091"></a>00091 <span class="comment"> *   BAD</span>
<a name="l00092"></a>00092 <span class="comment"> *   BAD</span>
<a name="l00093"></a>00093 <span class="comment"> */</span>
<a name="l00094"></a>00094 <span class="keyword">static</span> <a class="code" href="struct___c_b___t_a_i_l.html">_CB_TAIL</a>     CB_TAIL;
<a name="l00095"></a>00095 <span class="keyword">static</span> <a class="code" href="struct___c_b___b_i_r_k_p_a_r.html">_CB_BIRKPAR</a>      CB_BIRKPAR;
<a name="l00096"></a>00096 <span class="keyword">static</span> <a class="code" href="struct___c_b___r_c_p_a_r.html">_CB_RCPAR</a>        CB_RCPAR;
<a name="l00097"></a>00097 <span class="keyword">static</span> <a class="code" href="struct___c_b___g.html">_CB_G</a>            CB_G;
<a name="l00098"></a>00098 <span class="keyword">static</span> <a class="code" href="struct___c_b___r_h0.html">_CB_RH0</a>          CB_RH0;
<a name="l00099"></a>00099 <span class="keyword">static</span> <a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html">_CB_DPHI_B_RHO0</a>      CB_DPHI_B_RHO0;
<a name="l00100"></a>00100 <span class="keyword">static</span> <a class="code" href="struct___c_b___m_o_d_e_n_u_m.html">_CB_MODENUM</a>      CB_MODENUM;
<a name="l00101"></a>00101 <span class="keyword">static</span> <a class="code" href="struct___c_b___d_t_h_e_t_a.html">_CB_DTHETA</a>       CB_DTHETA;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="comment">/*</span>
<a name="l00105"></a>00105 <span class="comment"> *  SIN(PS) and COS(PS) are calculated 6 times each. This is very wasteful</span>
<a name="l00106"></a>00106 <span class="comment"> *  especially since we have it already. Lets pass sin_psi and cos_psi as globals....</span>
<a name="l00107"></a>00107 <span class="comment"> */</span>
<a name="l00108"></a><a class="code" href="_tsyg2004_8c.html#5b35fcda1a15310fa7b7e3e242431de3">00108</a> <span class="keywordtype">double</span>  <a class="code" href="_tsyg2004_8c.html#5b35fcda1a15310fa7b7e3e242431de3">sin_psi</a>, <a class="code" href="_tsyg2004_8c.html#98e0e08bb8a65f90813e5adb482aeb2c">cos_psi</a>;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="comment">/*</span>
<a name="l00113"></a>00113 <span class="comment"> *  Forward function declarations </span>
<a name="l00114"></a>00114 <span class="comment"> */</span>
<a name="l00115"></a>00115 <span class="keywordtype">void</span> <a class="code" href="_lgm___mag_model_info_8h.html#5c047252d169aae0974e5bfed6d71085">Lgm_EXTERN</a>( <span class="keywordtype">int</span> IOPGEN, <span class="keywordtype">int</span> IOPT, <span class="keywordtype">int</span> IOPB, <span class="keywordtype">int</span> IOPR, <span class="keywordtype">double</span> *A, <span class="keywordtype">int</span> NTOT, <span class="keywordtype">double</span> PDYN, <span class="keywordtype">double</span> DST, <span class="keywordtype">double</span> BXIMF, <span class="keywordtype">double</span> BYIMF, 
<a name="l00116"></a>00116         <span class="keywordtype">double</span> BZIMF, <span class="keywordtype">double</span> W1, <span class="keywordtype">double</span> W2, <span class="keywordtype">double</span> W3, <span class="keywordtype">double</span> W4, <span class="keywordtype">double</span> W5, <span class="keywordtype">double</span> W6, <span class="keywordtype">double</span> PS, 
<a name="l00117"></a>00117         <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BXCF, <span class="keywordtype">double</span> *BYCF, <span class="keywordtype">double</span> *BZCF, <span class="keywordtype">double</span> *BXT1, <span class="keywordtype">double</span> *BYT1, 
<a name="l00118"></a>00118         <span class="keywordtype">double</span> *BZT1, <span class="keywordtype">double</span> *BXT2, <span class="keywordtype">double</span> *BYT2, <span class="keywordtype">double</span> *BZT2, <span class="keywordtype">double</span> *BXSRC, <span class="keywordtype">double</span> *BYSRC, <span class="keywordtype">double</span> *BZSRC, 
<a name="l00119"></a>00119         <span class="keywordtype">double</span> *BXPRC, <span class="keywordtype">double</span> *BYPRC, <span class="keywordtype">double</span> *BZPRC,  <span class="keywordtype">double</span> *BXR11, <span class="keywordtype">double</span> *BYR11, <span class="keywordtype">double</span> *BZR11, <span class="keywordtype">double</span> *BXR12, 
<a name="l00120"></a>00120         <span class="keywordtype">double</span> *BYR12, <span class="keywordtype">double</span> *BZR12, <span class="keywordtype">double</span> *BXR21, <span class="keywordtype">double</span> *BYR21, <span class="keywordtype">double</span> *BZR21, <span class="keywordtype">double</span> *BXR22, <span class="keywordtype">double</span> *BYR22, 
<a name="l00121"></a>00121         <span class="keywordtype">double</span> *BZR22, <span class="keywordtype">double</span> *HXIMF, <span class="keywordtype">double</span> *HYIMF, <span class="keywordtype">double</span> *HZIMF, <span class="keywordtype">double</span> *BBX, <span class="keywordtype">double</span> *BBY, <span class="keywordtype">double</span> *BBZ );
<a name="l00122"></a>00122 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#464f1d83937f8412873a74ee415058a4">SHLCAR3X3</a>( <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ );
<a name="l00123"></a>00123 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#3ec00913121c60795f4052645698ddba">DEFORMED</a>( <span class="keywordtype">int</span> IOPT, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z,
<a name="l00124"></a>00124                 <span class="keywordtype">double</span> *BX1, <span class="keywordtype">double</span> *BY1, <span class="keywordtype">double</span> *BZ1, <span class="keywordtype">double</span> *BX2, <span class="keywordtype">double</span> *BY2, <span class="keywordtype">double</span> *BZ2);
<a name="l00125"></a>00125 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#584f134348f99945741cf42bfbd511d5">WARPED</a>( <span class="keywordtype">int</span> IOPT, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, 
<a name="l00126"></a>00126     <span class="keywordtype">double</span> *BX1, <span class="keywordtype">double</span> *BY1, <span class="keywordtype">double</span> *BZ1, <span class="keywordtype">double</span> *BX2, <span class="keywordtype">double</span> *BY2, <span class="keywordtype">double</span> *BZ2);
<a name="l00127"></a>00127 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#9114d15d3eb4beb81639e71c0b0235dd">UNWARPED</a>( <span class="keywordtype">int</span> IOPT, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, 
<a name="l00128"></a>00128         <span class="keywordtype">double</span> *BX1, <span class="keywordtype">double</span> *BY1, <span class="keywordtype">double</span> *BZ1, <span class="keywordtype">double</span> *BX2, <span class="keywordtype">double</span> *BY2, <span class="keywordtype">double</span> *BZ2);
<a name="l00129"></a>00129 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#81b0851907208b45c9721ef40e1e37a3">TAILDISK</a>( <span class="keywordtype">double</span> D0, <span class="keywordtype">double</span> DELTADX, <span class="keywordtype">double</span> DELTADY, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ);
<a name="l00130"></a>00130 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#d52c3a08bf2c11b9784a6ce1eb480fed">SHLCAR5X5</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> DSHIFT, <span class="keywordtype">double</span> *HX, <span class="keywordtype">double</span> *HY, <span class="keywordtype">double</span> *HZ );
<a name="l00131"></a>00131 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#a448f7ca5c043203dab6208c5c982571">BIRK_TOT</a>( <span class="keywordtype">int</span> IOPB, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z,
<a name="l00132"></a>00132         <span class="keywordtype">double</span> *BX11, <span class="keywordtype">double</span> *BY11, <span class="keywordtype">double</span> *BZ11, <span class="keywordtype">double</span> *BX12, <span class="keywordtype">double</span> *BY12, <span class="keywordtype">double</span> *BZ12,
<a name="l00133"></a>00133         <span class="keywordtype">double</span> *BX21, <span class="keywordtype">double</span> *BY21, <span class="keywordtype">double</span> *BZ21, <span class="keywordtype">double</span> *BX22, <span class="keywordtype">double</span> *BY22, <span class="keywordtype">double</span> *BZ22);
<a name="l00134"></a>00134 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#05b3a8c8d1e1b62725abe895df3d1ca1">BIRK_1N2</a>( <span class="keywordtype">int</span> NUMB, <span class="keywordtype">int</span> MODE, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ ) ;
<a name="l00135"></a>00135 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#b05c2844104041ea55de4c30aaa5b968">TWOCONES</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ);
<a name="l00136"></a>00136 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#d3ff91c1de1106c25ccbf3c1694cc883">ONE_CONE</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ);
<a name="l00137"></a>00137 <span class="keywordtype">double</span>  <a class="code" href="_tsyg2004_8c.html#af80d04276fc0dce8abc24392512cf8e">THETA_S</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> THETA);
<a name="l00138"></a>00138 <span class="keywordtype">double</span>  <a class="code" href="_tsyg2004_8c.html#22701b7ad2e702887750fdec469f01fb">R_S</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> THETA);
<a name="l00139"></a>00139 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#8e93acc99263e229c4b81a6c4cd9f148">FIALCOS</a>( <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> THETA, <span class="keywordtype">double</span> PHI, <span class="keywordtype">double</span> *BTHETA, <span class="keywordtype">double</span> *BPHI, <span class="keywordtype">int</span> N, <span class="keywordtype">double</span> THETA0, <span class="keywordtype">double</span> DT);
<a name="l00140"></a>00140 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#723d4ced4ac10c32344d63bda6126fdf">BIRK_SHL</a>( <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>, <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X_SC, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ );
<a name="l00141"></a>00141 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#2a492ba836369d99dfb597c1675f6a33">FULL_RC</a>( <span class="keywordtype">int</span> IOPR, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, 
<a name="l00142"></a>00142     <span class="keywordtype">double</span> *BXSRC, <span class="keywordtype">double</span> *BYSRC, <span class="keywordtype">double</span> *BZSRC, <span class="keywordtype">double</span> *BXPRC, <span class="keywordtype">double</span> *BYPRC,  <span class="keywordtype">double</span> *BZPRC);
<a name="l00143"></a>00143 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#9d8e16b4209da2c6896cb9fb1531f2fa">SRC_PRC</a>( <span class="keywordtype">int</span> IOPR, <span class="keywordtype">double</span> SC_SY, <span class="keywordtype">double</span> SC_PR, <span class="keywordtype">double</span> PHI, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, 
<a name="l00144"></a>00144         <span class="keywordtype">double</span> *BXSRC, <span class="keywordtype">double</span> *BYSRC, <span class="keywordtype">double</span> *BZSRC, <span class="keywordtype">double</span> *BXPRC, <span class="keywordtype">double</span> *BYPRC, <span class="keywordtype">double</span> *BZPRC);
<a name="l00145"></a>00145 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#16ec50640c104c5c2a57ef6a51b21f01">RC_SYMM</a>( <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ);
<a name="l00146"></a>00146 <span class="keywordtype">double</span>  <a class="code" href="_tsyg2004_8c.html#55f2b5b45100a3e191f3423e007d7174">AP</a>( <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> SINT, <span class="keywordtype">double</span> COST);
<a name="l00147"></a>00147 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#a49661b45ed199138df07d1806ad7240">PRC_SYMM</a>( <span class="keywordtype">double</span> X,<span class="keywordtype">double</span> Y,<span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ );
<a name="l00148"></a>00148 <span class="keywordtype">double</span>  <a class="code" href="_tsyg2004_8c.html#184ae8e5e4f65974829d3ff56683be12">APPRC</a>( <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> SINT, <span class="keywordtype">double</span> COST);
<a name="l00149"></a>00149 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#7d3132f7a6ed31b467740063133da1fe">PRC_QUAD</a>( <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ);
<a name="l00150"></a>00150 <span class="keywordtype">double</span>  <a class="code" href="_tsyg2004_8c.html#51ea88e5a0772dd9763092b23868d83e">BR_PRC_Q</a>( <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> SINT, <span class="keywordtype">double</span> COST );
<a name="l00151"></a>00151 <span class="keywordtype">double</span>  <a class="code" href="_tsyg2004_8c.html#40293e54c4b1290d9463ec556292303b">BT_PRC_Q</a>( <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> SINT, <span class="keywordtype">double</span> COST);
<a name="l00152"></a>00152 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#e9137c27c3c66aef974f6c4017b6ab9d">FFS</a>( <span class="keywordtype">double</span> A, <span class="keywordtype">double</span> A0, <span class="keywordtype">double</span> DA, <span class="keywordtype">double</span> *F, <span class="keywordtype">double</span> *FA, <span class="keywordtype">double</span> *FS );
<a name="l00153"></a>00153 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#ae1fabae2232fcfa073907bc921dbf66">RC_SHIELD</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X_SC, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ );
<a name="l00154"></a>00154 <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#b1ff14f59abcc09994d8743db9a8f736">DIPOLE</a>( <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ );
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 <span class="comment">/*</span>
<a name="l00158"></a>00158 <span class="comment"> *  This structure contains the numerous parameters</span>
<a name="l00159"></a>00159 <span class="comment"> *  that are passed to EXTERN, WE dont use this now(?)</span>
<a name="l00160"></a>00160 <span class="comment"> */</span>
<a name="l00161"></a><a class="code" href="struct___t_s04_info.html">00161</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___t_s04_info.html">_TS04Info</a> {
<a name="l00162"></a>00162 
<a name="l00163"></a><a class="code" href="struct___t_s04_info.html#9a0935747b885ca88e6e635b0ba85be7">00163</a>     <span class="keywordtype">int</span>    <a class="code" href="struct___t_s04_info.html#cd246ede1b8a4a4fd4696653df7ba165">IOPGEN</a>, <a class="code" href="struct___t_s04_info.html#9a0935747b885ca88e6e635b0ba85be7">IOPT</a>, <a class="code" href="struct___t_s04_info.html#d288271af02815f7cab79e1d9d16827c">IOPB</a>, <a class="code" href="struct___t_s04_info.html#6707cabde8b700cd0ded61d69a272960">IOPR</a>;
<a name="l00164"></a><a class="code" href="struct___t_s04_info.html#459caca3342bee05a2b76c6df3e085f3">00164</a>     <span class="keywordtype">int</span>    <a class="code" href="struct___t_s04_info.html#459caca3342bee05a2b76c6df3e085f3">NTOT</a>;
<a name="l00165"></a><a class="code" href="struct___t_s04_info.html#8e2788d33afba470d0eaf0adef38d288">00165</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#8e2788d33afba470d0eaf0adef38d288">A</a>[70];
<a name="l00166"></a><a class="code" href="struct___t_s04_info.html#6b4050a424d9e166a322d335d97ffa85">00166</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#6b4050a424d9e166a322d335d97ffa85">PDYN</a>, <a class="code" href="struct___t_s04_info.html#4e71f147ed71b137b574a818a29c5f43">DST</a>, <a class="code" href="struct___t_s04_info.html#e79afdc213835f23f6c3d9c61149e4e2">BXIMF</a>, <a class="code" href="struct___t_s04_info.html#821525967f196af580b5f98ff816aae8">BYIMF</a>, <a class="code" href="struct___t_s04_info.html#f36b8e6d8f3578a7f8274ec30917f4a2">BZIMF</a>;
<a name="l00167"></a><a class="code" href="struct___t_s04_info.html#866e9e4ccaa55cf04d187988806f1250">00167</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#34cbf6576a130ac93a6a2eeb153263b3">W1</a>, <a class="code" href="struct___t_s04_info.html#63a3207d198302df77e4bb177339f18f">W2</a>, <a class="code" href="struct___t_s04_info.html#0a5ed99cbecc8835fafcb0bcb8345e5b">W3</a>, <a class="code" href="struct___t_s04_info.html#6e860cf299bef0c1ccc448ee80760947">W4</a>, <a class="code" href="struct___t_s04_info.html#73d56f377ea7552b6b64161fe51237f8">W5</a>, <a class="code" href="struct___t_s04_info.html#866e9e4ccaa55cf04d187988806f1250">W6</a>;
<a name="l00168"></a><a class="code" href="struct___t_s04_info.html#a2d39f44b0d0c0b54e9d758deaacada6">00168</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#a2d39f44b0d0c0b54e9d758deaacada6">PS</a>;
<a name="l00169"></a><a class="code" href="struct___t_s04_info.html#0f16a8f561453187897f0820186da39b">00169</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#1059b82f84827fc49ea81b12566b3cdb">X</a>, <a class="code" href="struct___t_s04_info.html#c8d59bf77d5ef21e7c7a88b08f14c825">Y</a>, <a class="code" href="struct___t_s04_info.html#0f16a8f561453187897f0820186da39b">Z</a>;
<a name="l00170"></a><a class="code" href="struct___t_s04_info.html#af933c557e7b42b1650d06a878927f39">00170</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#66bc2a288fcf9f7bae6e3993d43c458b">BXCF</a>, <a class="code" href="struct___t_s04_info.html#721507c5ab1a75d3c249379bed1216a4">BYCF</a>, <a class="code" href="struct___t_s04_info.html#af933c557e7b42b1650d06a878927f39">BZCF</a>;
<a name="l00171"></a><a class="code" href="struct___t_s04_info.html#93a85c3a80b04297d6f27ec8f101a492">00171</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#a011d036e79b3e14b9894501557ceb2e">BXT1</a>, <a class="code" href="struct___t_s04_info.html#bed0b3a68e5e58be6d03ec0d6b2d4bac">BYT1</a>, <a class="code" href="struct___t_s04_info.html#93a85c3a80b04297d6f27ec8f101a492">BZT1</a>;
<a name="l00172"></a><a class="code" href="struct___t_s04_info.html#d575bebb4a1cdd837964550ff8aa5eee">00172</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#da5892db5a6efc3833cea1ea6d11038b">BXT2</a>, <a class="code" href="struct___t_s04_info.html#95a5d798af13bd1b13588f7ca9dd5469">BYT2</a>, <a class="code" href="struct___t_s04_info.html#d575bebb4a1cdd837964550ff8aa5eee">BZT2</a>;
<a name="l00173"></a><a class="code" href="struct___t_s04_info.html#4d8bb430b345437be7bdcdab9f669a83">00173</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#af2e403c9b140104188d1eef09cca4a6">BXSRC</a>, <a class="code" href="struct___t_s04_info.html#32f55c83dc6f14a4cbdb08ce786d5c09">BYSRC</a>, <a class="code" href="struct___t_s04_info.html#4d8bb430b345437be7bdcdab9f669a83">BZSRC</a>;
<a name="l00174"></a><a class="code" href="struct___t_s04_info.html#f988231e05be0d94639c1b8ba1ce76a5">00174</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#56d8d2c3e40e106b3e7bbc3fc834460a">BXPRC</a>, <a class="code" href="struct___t_s04_info.html#5f4117e80f0ac1412d3ce2159ff02138">BYPRC</a>, <a class="code" href="struct___t_s04_info.html#f988231e05be0d94639c1b8ba1ce76a5">BZPRC</a>;
<a name="l00175"></a><a class="code" href="struct___t_s04_info.html#dde08ef0abaed458dfa0b797e4dbb5bf">00175</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#d8d0d299f1a439a463f83df71dbc5f44">BXR11</a>, <a class="code" href="struct___t_s04_info.html#9485aa9f5abaefd62d2f430c82acb65b">BYR11</a>, <a class="code" href="struct___t_s04_info.html#dde08ef0abaed458dfa0b797e4dbb5bf">BZR11</a>;
<a name="l00176"></a><a class="code" href="struct___t_s04_info.html#23500101452343c6ceff7f5d0acdfced">00176</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#f458e0735f7ff015dca398deb8590923">BXR12</a>, <a class="code" href="struct___t_s04_info.html#d23df4618743e8dc55c84f391e76fe8e">BYR12</a>, <a class="code" href="struct___t_s04_info.html#23500101452343c6ceff7f5d0acdfced">BZR12</a>;
<a name="l00177"></a><a class="code" href="struct___t_s04_info.html#cf104617807d9c28716d97945d8bdda9">00177</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#a508ffc6a962d5f93b1084c889cb0fb5">BXR21</a>, <a class="code" href="struct___t_s04_info.html#93d072e6ba972405e72ac04b6cbe06a4">BYR21</a>, <a class="code" href="struct___t_s04_info.html#cf104617807d9c28716d97945d8bdda9">BZR21</a>;
<a name="l00178"></a><a class="code" href="struct___t_s04_info.html#417f542193c123afb851fb9ae24759d1">00178</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#2e25e21de5a89d9a9cf3f39a9cdbf6e6">BXR22</a>, <a class="code" href="struct___t_s04_info.html#fe8d51a2854838075c65ba5f9453d068">BYR22</a>, <a class="code" href="struct___t_s04_info.html#417f542193c123afb851fb9ae24759d1">BZR22</a>;
<a name="l00179"></a><a class="code" href="struct___t_s04_info.html#33e244d5c4043dd47a4c55a6fcdab2e3">00179</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#8b072a2e8afac1c3e168f081f7f29907">HXIMF</a>, <a class="code" href="struct___t_s04_info.html#badd0ee294949123f5a7481e23ec4f5e">HYIMF</a>, <a class="code" href="struct___t_s04_info.html#33e244d5c4043dd47a4c55a6fcdab2e3">HZIMF</a>;
<a name="l00180"></a><a class="code" href="struct___t_s04_info.html#361205dbe12b66613d8b2b0036a775f3">00180</a>     <span class="keywordtype">double</span> <a class="code" href="struct___t_s04_info.html#0b9b0532b448223253b5d5fefc28ddef">BX</a>, <a class="code" href="struct___t_s04_info.html#c2f197c29d02f4b0e2b15cbaaf5d8438">BY</a>, <a class="code" href="struct___t_s04_info.html#361205dbe12b66613d8b2b0036a775f3">BZ</a>;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 } <a class="code" href="struct___t_s04_info.html">_TS04Info</a>;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="_tsyg2004_8c.html#2a5550ebc6d255713c18b87010ed2594">00185</a> <a class="code" href="struct___t_s04_info.html">_TS04Info</a> *<a class="code" href="_tsyg2004_8c.html#2a5550ebc6d255713c18b87010ed2594">init_TS04Info</a>( ) {
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     <a class="code" href="struct___t_s04_info.html">_TS04Info</a>      *TS04Info = (<a class="code" href="struct___t_s04_info.html">_TS04Info</a> *) calloc (1, <span class="keyword">sizeof</span>(*TS04Info) );
<a name="l00188"></a>00188                       
<a name="l00189"></a>00189     
<a name="l00190"></a>00190                       
<a name="l00191"></a>00191     <span class="keywordflow">return</span> TS04Info;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="_tsyg2004_8c.html#54ecb238c46c4acfe5e022e19cc326ec">00198</a> <span class="keywordtype">void</span> <a class="code" href="_lgm___mag_model_info_8h.html#54ecb238c46c4acfe5e022e19cc326ec">Lgm_T04_s</a>( <span class="keywordtype">int</span> IOPT, <span class="keywordtype">double</span> *PARMOD, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> SINPS, <span class="keywordtype">double</span> COSPS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ) {
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <span class="keywordtype">double</span>     PDYN, DST_AST, BXIMF=0.0, BYIMF=0.0, BZIMF=0.0, W1, W2, W3, W4, W5, W6;
<a name="l00203"></a>00203     <span class="keywordtype">double</span>     PSS, XX, YY, ZZ, BXCF, BYCF, BZCF, BXT1, BYT1, BZT1, BXT2, BYT2, BZT2;
<a name="l00204"></a>00204     <span class="keywordtype">double</span>     BXSRC, BYSRC, BZSRC, BXPRC, BYPRC, BZPRC,  BXR11, BYR11, BZR11;
<a name="l00205"></a>00205     <span class="keywordtype">double</span>     BXR12, BYR12, BZR12, BXR21, BYR21, BZR21, BXR22, BYR22, BZR22, HXIMF;
<a name="l00206"></a>00206     <span class="keywordtype">double</span>     HYIMF, HZIMF, BBX, BBY, BBZ;
<a name="l00207"></a>00207     <span class="keywordtype">int</span>        IOPGEN=0, IOPTT=0, IOPB=0, IOPR=0;
<a name="l00208"></a>00208     <span class="keyword">static</span> <span class="keywordtype">double</span>  A[] = { -9e99, 1.00000, 5.19884, 0.923524, 8.68111, 0.00000, -6.44922, 11.3109, 
<a name="l00209"></a>00209                      -3.84555, 0.00000, 0.558081, 0.937044, 0.00000, 0.772433, 0.687241, 
<a name="l00210"></a>00210                      0.00000, 0.320369, 1.22531, -0.432246E-01, -0.382436, 0.457468, 
<a name="l00211"></a>00211                      0.741917, 0.227194, 0.154269, 5.75196, 22.3113, 10.3526, 64.3312, 
<a name="l00212"></a>00212                      1.01977, -0.200859E-01, 0.971643, 0.295525E-01, 1.01032, 0.215561, 
<a name="l00213"></a>00213                      1.50059, 0.730898E-01, 1.93625, 1.74545, 1.29533, 0.714744, 0.391687, 
<a name="l00214"></a>00214                      3.31283, 75.0127, 6.36283, 4.43561, 0.387801, 0.699661, 0.305352E-01, 
<a name="l00215"></a>00215                      0.581002, 1.14671, 0.876060, 0.386060, 0.801831, 0.874315, 0.463634, 
<a name="l00216"></a>00216                      0.175077, 0.673053, 0.388341, 2.32074, 1.32373, 0.419800, 1.24968, 
<a name="l00217"></a>00217                      1.28903, .409286, 1.57622, .690036, 1.28836, 2.4054, .528557, .564247 };
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     IOPGEN = 0;
<a name="l00221"></a>00221     IOPTT  = 0;
<a name="l00222"></a>00222     IOPB   = 0;
<a name="l00223"></a>00223     IOPR   = 0;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     PDYN    = PARMOD[1];
<a name="l00226"></a>00226     DST_AST = PARMOD[2]*0.8 - 13.0*sqrt( PDYN );
<a name="l00227"></a>00227     BYIMF   = PARMOD[3];
<a name="l00228"></a>00228     BZIMF   = PARMOD[4];
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     W1 = PARMOD[5];
<a name="l00232"></a>00232     W2 = PARMOD[6];
<a name="l00233"></a>00233     W3 = PARMOD[7];
<a name="l00234"></a>00234     W4 = PARMOD[8];
<a name="l00235"></a>00235     W5 = PARMOD[9];
<a name="l00236"></a>00236     W6 = PARMOD[10];
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     PSS = PS;
<a name="l00240"></a>00240     <a class="code" href="_tsyg2004_8c.html#5b35fcda1a15310fa7b7e3e242431de3">sin_psi</a> = SINPS;
<a name="l00241"></a>00241     <a class="code" href="_tsyg2004_8c.html#98e0e08bb8a65f90813e5adb482aeb2c">cos_psi</a> = COSPS;
<a name="l00242"></a>00242     XX  = X;
<a name="l00243"></a>00243     YY  = Y;
<a name="l00244"></a>00244     ZZ  = Z;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 
<a name="l00247"></a>00247     <a class="code" href="_lgm___mag_model_info_8h.html#5c047252d169aae0974e5bfed6d71085">Lgm_EXTERN</a>( IOPGEN, IOPTT, IOPB, IOPR, A, 79, PDYN, DST_AST, BXIMF, BYIMF, 
<a name="l00248"></a>00248         BZIMF, W1, W2, W3, W4, W5, W6, PSS, XX, YY, ZZ, &amp;BXCF, &amp;BYCF, &amp;BZCF, &amp;BXT1, &amp;BYT1, 
<a name="l00249"></a>00249         &amp;BZT1, &amp;BXT2, &amp;BYT2, &amp;BZT2, &amp;BXSRC, &amp;BYSRC, &amp;BZSRC, &amp;BXPRC, &amp;BYPRC, &amp;BZPRC,  &amp;BXR11, 
<a name="l00250"></a>00250         &amp;BYR11, &amp;BZR11, &amp;BXR12, &amp;BYR12, &amp;BZR12, &amp;BXR21, &amp;BYR21, &amp;BZR21, &amp;BXR22, &amp;BYR22, 
<a name="l00251"></a>00251         &amp;BZR22, &amp;HXIMF, &amp;HYIMF, &amp;HZIMF, &amp;BBX, &amp;BBY, &amp;BBZ );
<a name="l00252"></a>00252 
<a name="l00253"></a>00253 <span class="comment">/*</span>
<a name="l00254"></a>00254 <span class="comment">printf("BXCF, BYCF, BZCF   = %.10g %.10g %.10g\n", BXCF, BYCF, BZCF );</span>
<a name="l00255"></a>00255 <span class="comment">printf("BXT1, BYT1, BZT1   = %.10g %.10g %.10g\n", BXT1, BYT1, BZT1 );</span>
<a name="l00256"></a>00256 <span class="comment">printf("BXT2, BYT2, BZT2   = %.10g %.10g %.10g\n", BXT2, BYT2, BZT2 );</span>
<a name="l00257"></a>00257 <span class="comment">printf("BXSRC, BYSRC, BZSRC   = %.10g %.10g %.10g\n", BXSRC, BYSRC, BZSRC );</span>
<a name="l00258"></a>00258 <span class="comment">printf("BXPRC, BYPRC, BZPRC   = %.10g %.10g %.10g\n", BXPRC, BYPRC, BZPRC );</span>
<a name="l00259"></a>00259 <span class="comment">printf("BXR11, BYR11, BZR11   = %.10g %.10g %.10g\n", BXR11, BYR11, BZR11 );</span>
<a name="l00260"></a>00260 <span class="comment">printf("BXR12, BYR12, BZR12   = %.10g %.10g %.10g\n", BXR12, BYR12, BZR12 );</span>
<a name="l00261"></a>00261 <span class="comment">printf("BXR21, BYR21, BZR21   = %.10g %.10g %.10g\n", BXR21, BYR21, BZR21 );</span>
<a name="l00262"></a>00262 <span class="comment">printf("BXR22, BYR22, BZR22   = %.10g %.10g %.10g\n", BXR22, BYR22, BZR22 );</span>
<a name="l00263"></a>00263 <span class="comment">printf("HXIMF, HYIMF, HZIMF   = %.10g %.10g %.10g\n", HXIMF, HYIMF, HZIMF );</span>
<a name="l00264"></a>00264 <span class="comment">printf("BBX, BBY, BBZ   = %.10g %.10g %.10g\n", BBX, BBY, BBZ);</span>
<a name="l00265"></a>00265 <span class="comment">*/</span>
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     *BX = BBX;
<a name="l00269"></a>00269     *BY = BBY;
<a name="l00270"></a>00270     *BZ = BBZ;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     <span class="keywordflow">return</span>;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="comment">/*  </span>
<a name="l00283"></a>00283 <span class="comment"> *     IOPGEN - GENERAL OPTION FLAG:  IOPGEN=0 - CALCULATE TOTAL FIELD</span>
<a name="l00284"></a>00284 <span class="comment"> *                                    IOPGEN=1 - DIPOLE SHIELDING ONLY</span>
<a name="l00285"></a>00285 <span class="comment"> *                                    IOPGEN=2 - TAIL FIELD ONLY</span>
<a name="l00286"></a>00286 <span class="comment"> *                                    IOPGEN=3 - BIRKELAND FIELD ONLY</span>
<a name="l00287"></a>00287 <span class="comment"> *                                    IOPGEN=4 - RING CURRENT FIELD ONLY</span>
<a name="l00288"></a>00288 <span class="comment"> *                                    IOPGEN=5 - INTERCONNECTION FIELD ONLY</span>
<a name="l00289"></a>00289 <span class="comment"> *  </span>
<a name="l00290"></a>00290 <span class="comment"> *     IOPT -  TAIL FIELD FLAG:       IOPT=0  -  BOTH MODES</span>
<a name="l00291"></a>00291 <span class="comment"> *                                    IOPT=1  -  MODE 1 ONLY</span>
<a name="l00292"></a>00292 <span class="comment"> *                                    IOPT=2  -  MODE 2 ONLY</span>
<a name="l00293"></a>00293 <span class="comment"> *  </span>
<a name="l00294"></a>00294 <span class="comment"> *     IOPB -  BIRKELAND FIELD FLAG:  IOPB=0  -  ALL 4 TERMS</span>
<a name="l00295"></a>00295 <span class="comment"> *                                    IOPB=1  -  REGION 1, MODES 1 AND 2</span>
<a name="l00296"></a>00296 <span class="comment"> *                                    IOPB=2  -  REGION 2, MODES 1 AND 2</span>
<a name="l00297"></a>00297 <span class="comment"> *  </span>
<a name="l00298"></a>00298 <span class="comment"> *     IOPR -  RING CURRENT FLAG:     IOPR=0  -  BOTH SRC AND PRC</span>
<a name="l00299"></a>00299 <span class="comment"> *                                    IOPR=1  -  SRC ONLY</span>
<a name="l00300"></a>00300 <span class="comment"> *                                    IOPR=2  -  PRC ONLY</span>
<a name="l00301"></a>00301 <span class="comment"> */</span>
<a name="l00302"></a><a class="code" href="_lgm___mag_model_info_8h.html#5c047252d169aae0974e5bfed6d71085">00302</a> <span class="keywordtype">void</span> <a class="code" href="_lgm___mag_model_info_8h.html#5c047252d169aae0974e5bfed6d71085">Lgm_EXTERN</a>( <span class="keywordtype">int</span> IOPGEN, <span class="keywordtype">int</span> IOPT, <span class="keywordtype">int</span> IOPB, <span class="keywordtype">int</span> IOPR, <span class="keywordtype">double</span> *A, <span class="keywordtype">int</span> NTOT, <span class="keywordtype">double</span> PDYN, <span class="keywordtype">double</span> DST, <span class="keywordtype">double</span> BXIMF, <span class="keywordtype">double</span> BYIMF, 
<a name="l00303"></a>00303         <span class="keywordtype">double</span> BZIMF, <span class="keywordtype">double</span> W1, <span class="keywordtype">double</span> W2, <span class="keywordtype">double</span> W3, <span class="keywordtype">double</span> W4, <span class="keywordtype">double</span> W5, <span class="keywordtype">double</span> W6, <span class="keywordtype">double</span> PS, 
<a name="l00304"></a>00304         <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BXCF, <span class="keywordtype">double</span> *BYCF, <span class="keywordtype">double</span> *BZCF, <span class="keywordtype">double</span> *BXT1, <span class="keywordtype">double</span> *BYT1, 
<a name="l00305"></a>00305         <span class="keywordtype">double</span> *BZT1, <span class="keywordtype">double</span> *BXT2, <span class="keywordtype">double</span> *BYT2, <span class="keywordtype">double</span> *BZT2, <span class="keywordtype">double</span> *BXSRC, <span class="keywordtype">double</span> *BYSRC, <span class="keywordtype">double</span> *BZSRC, 
<a name="l00306"></a>00306         <span class="keywordtype">double</span> *BXPRC, <span class="keywordtype">double</span> *BYPRC, <span class="keywordtype">double</span> *BZPRC,  <span class="keywordtype">double</span> *BXR11, <span class="keywordtype">double</span> *BYR11, <span class="keywordtype">double</span> *BZR11, <span class="keywordtype">double</span> *BXR12, 
<a name="l00307"></a>00307         <span class="keywordtype">double</span> *BYR12, <span class="keywordtype">double</span> *BZR12, <span class="keywordtype">double</span> *BXR21, <span class="keywordtype">double</span> *BYR21, <span class="keywordtype">double</span> *BZR21, <span class="keywordtype">double</span> *BXR22, <span class="keywordtype">double</span> *BYR22, 
<a name="l00308"></a>00308         <span class="keywordtype">double</span> *BZR22, <span class="keywordtype">double</span> *HXIMF, <span class="keywordtype">double</span> *HYIMF, <span class="keywordtype">double</span> *HZIMF, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ ) {
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="keywordtype">int</span>     done;
<a name="l00311"></a>00311     <span class="keywordtype">double</span>  XAPPA, XAPPA2, XAPPA3, SPS, X0, AM, S0, FACTIMF, OIMFX, OIMFY, OIMFZ, R, XSS, ZSS;
<a name="l00312"></a>00312     <span class="keywordtype">double</span>  XSOLD, ZSOLD, ZSSoR, ZSSoR2, RH, RoRH, RoRH2, RoRH3, SINPSAS, SINPSAS2, COSPSAS, DD, RHO2, ASQ;
<a name="l00313"></a>00313     <span class="keywordtype">double</span>  XMXM, AXX0, ARO, AROpAXX0, AROpAXX02, SIGMA, CFX, CFY, CFZ, DSTT, ZNAM;
<a name="l00314"></a>00314     <span class="keywordtype">double</span>  DLP1, DLP2, TAMP1, TAMP2, A_SRC, A_PRC, A_R11, XX, YY, ZZ;
<a name="l00315"></a>00315     <span class="keywordtype">double</span>  A_R21, QX, QY, QZ, FINT, FEXT, ZNAM05, ooZNAM20, BBX, BBY, BBZ;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <span class="keywordtype">double</span>  A0_A=34.586, A0_S0=1.1960, A0_X0=3.4397;    <span class="comment">// SHUE ET AL. PARAMETERS</span>
<a name="l00319"></a>00319     <span class="keywordtype">double</span>  DSIG=0.005, RH2=-5.2;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     CB_G.<a class="code" href="struct___c_b___g.html#67783a2c4f670ee5a9dadcf428324d32">G</a>     = 35.0;  <span class="comment">// TAIL WARPING PARAMETER</span>
<a name="l00323"></a>00323     CB_RH0.<a class="code" href="struct___c_b___r_h0.html#b8de82fc4984cbf441791ce41d02862e">RH0</a> = 7.5;   <span class="comment">// TAIL HINGING DISTANCE</span>
<a name="l00324"></a>00324     
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     XAPPA = pow( 0.5*PDYN, A[23] );   <span class="comment">//  OVERALL SCALING PARAMETER</span>
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     XAPPA2 = XAPPA*XAPPA;
<a name="l00331"></a>00331     XAPPA3 = XAPPA*XAPPA2;
<a name="l00332"></a>00332         
<a name="l00333"></a>00333     XX = X*XAPPA;
<a name="l00334"></a>00334     YY = Y*XAPPA;
<a name="l00335"></a>00335     ZZ = Z*XAPPA;
<a name="l00336"></a>00336  
<a name="l00337"></a>00337 <span class="comment">//    SPS = sin( PS );</span>
<a name="l00338"></a>00338     SPS = <a class="code" href="_tsyg2004_8c.html#5b35fcda1a15310fa7b7e3e242431de3">sin_psi</a>;
<a name="l00339"></a>00339  
<a name="l00340"></a>00340     X0 = A0_X0/XAPPA;
<a name="l00341"></a>00341     AM = A0_A/XAPPA;
<a name="l00342"></a>00342     S0 = A0_S0;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="comment">/*</span>
<a name="l00346"></a>00346 <span class="comment">     *  CALCULATE "IMF" COMPONENTS OUTSIDE THE MAGNETOPAUSE LAYER (HENCE BEGIN WITH "O")</span>
<a name="l00347"></a>00347 <span class="comment">     *  THEY ARE NEEDED ONLY IF THE POINT (X,Y,Z) IS WITHIN THE TRANSITION MAGNETOPAUSE LAYER</span>
<a name="l00348"></a>00348 <span class="comment">     *  OR OUTSIDE THE MAGNETOSPHERE:</span>
<a name="l00349"></a>00349 <span class="comment">     */</span>
<a name="l00350"></a>00350     FACTIMF = A[20];
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     OIMFX = 0.0;
<a name="l00353"></a>00353     OIMFY = BYIMF*FACTIMF;
<a name="l00354"></a>00354     OIMFZ = BZIMF*FACTIMF;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     R   = sqrt( X*X + Y*Y + Z*Z );
<a name="l00358"></a>00358     XSS = X;
<a name="l00359"></a>00359     ZSS = Z;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="comment">/*</span>
<a name="l00363"></a>00363 <span class="comment">     *  BEGIN ITERATIVE SEARCH OF UNWARPED COORDS (TO FIND SIGMA)</span>
<a name="l00364"></a>00364 <span class="comment">     */</span>
<a name="l00365"></a>00365     done = <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00366"></a>00366     <span class="keywordflow">while</span> ( !done ) {
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     XSOLD = XSS;
<a name="l00369"></a>00369     ZSOLD = ZSS;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371         ZSSoR = ZSS/R;
<a name="l00372"></a>00372         ZSSoR2 = ZSSoR*ZSSoR;
<a name="l00373"></a>00373     RH = CB_RH0.<a class="code" href="struct___c_b___r_h0.html#b8de82fc4984cbf441791ce41d02862e">RH0</a> + RH2*ZSSoR2;
<a name="l00374"></a>00374         RoRH = R/RH;
<a name="l00375"></a>00375         RoRH2 = RoRH*RoRH;
<a name="l00376"></a>00376         RoRH3 = RoRH*RoRH2;
<a name="l00377"></a>00377     SINPSAS = SPS/pow( 1.0 + RoRH3, 0.33333333 );
<a name="l00378"></a>00378         SINPSAS2 = SINPSAS*SINPSAS;
<a name="l00379"></a>00379     COSPSAS = sqrt(1.0 - SINPSAS2);
<a name="l00380"></a>00380     ZSS = X*SINPSAS + Z*COSPSAS;
<a name="l00381"></a>00381     XSS = X*COSPSAS - Z*SINPSAS;
<a name="l00382"></a>00382     DD  = fabs( XSS-XSOLD ) + fabs( ZSS-ZSOLD );
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     <span class="keywordflow">if</span> ( DD &lt;= 1e-6 ) done = <a class="code" href="_lgm___c_trans_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 
<a name="l00389"></a>00389     RHO2 = Y*Y + ZSS*ZSS;
<a name="l00390"></a>00390     ASQ  = AM*AM;
<a name="l00391"></a>00391     XMXM = AM + XSS - X0;
<a name="l00392"></a>00392     <span class="keywordflow">if</span> (XMXM &lt; 0.0) XMXM = 0.0; <span class="comment">// THE BOUNDARY IS A CYLINDER TAILWARD OF X=X0-AM</span>
<a name="l00393"></a>00393     AXX0 = XMXM*XMXM;
<a name="l00394"></a>00394     ARO = ASQ + RHO2;
<a name="l00395"></a>00395     AROpAXX0 = ARO+AXX0;
<a name="l00396"></a>00396     AROpAXX02 = AROpAXX0*AROpAXX0;
<a name="l00397"></a>00397     SIGMA = sqrt((ARO+AXX0+sqrt(AROpAXX02-4.*ASQ*AXX0))/(2.*ASQ));
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     <span class="comment">/* </span>
<a name="l00401"></a>00401 <span class="comment">     *    NOW, THERE ARE THREE POSSIBLE CASES:</span>
<a name="l00402"></a>00402 <span class="comment">     *     (1) INSIDE THE MAGNETOSPHERE   (SIGMA</span>
<a name="l00403"></a>00403 <span class="comment">     *     (2) IN THE BOUNDARY LAYER</span>
<a name="l00404"></a>00404 <span class="comment">     *     (3) OUTSIDE THE MAGNETOSPHERE AND B.LAYER</span>
<a name="l00405"></a>00405 <span class="comment">     *        FIRST OF ALL, CONSIDER THE CASES (1) AND (2):</span>
<a name="l00406"></a>00406 <span class="comment">     * </span>
<a name="l00407"></a>00407 <span class="comment">     */</span>
<a name="l00408"></a>00408     <span class="keywordflow">if</span> (SIGMA &lt; S0+DSIG) {  <span class="comment">//  CASES (1) OR (2); CALCULATE THE MODEL FIELD</span>
<a name="l00409"></a>00409                                 <span class="comment">//  (WITH THE POTENTIAL "PENETRATED" INTERCONNECTION FIELD):</span>
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="keywordflow">if</span> (IOPGEN &lt;= 1) {
<a name="l00413"></a>00413         <a class="code" href="_tsyg2004_8c.html#464f1d83937f8412873a74ee415058a4">SHLCAR3X3</a>( XX, YY, ZZ, PS, &amp;CFX, &amp;CFY, &amp;CFZ );  <span class="comment">// DIPOLE SHIELDING FIELD</span>
<a name="l00414"></a>00414         *BXCF = CFX*XAPPA3;
<a name="l00415"></a>00415         *BYCF = CFY*XAPPA3;
<a name="l00416"></a>00416         *BZCF = CFZ*XAPPA3;
<a name="l00417"></a>00417     } <span class="keywordflow">else</span> {
<a name="l00418"></a>00418         *BXCF = 0.0;
<a name="l00419"></a>00419         *BYCF = 0.0;
<a name="l00420"></a>00420         *BZCF = 0.0;
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422         
<a name="l00423"></a>00423     <span class="keywordflow">if</span> ( (IOPGEN == 0) || (IOPGEN == 2) ) {
<a name="l00424"></a>00424         DSTT = -20.;
<a name="l00425"></a>00425         <span class="keywordflow">if</span> (DST &lt; DSTT) DSTT = DST;
<a name="l00426"></a>00426         ZNAM = pow( fabs( DSTT ), 0.37 );
<a name="l00427"></a>00427         CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#12fe869b3516cc1eb6b73890b20335bc">DXSHIFT1</a> = A[24]-A[25]/ZNAM;
<a name="l00428"></a>00428         CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#5947c5dfec8ec63b76f2a46d1719af3c">DXSHIFT2</a> = A[26]-A[27]/ZNAM;
<a name="l00429"></a>00429         CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#d8657a5ec76e12f3066fb4b4eb75ace9">D</a> = A[36]*exp(-W1/A[37])  +A[69];
<a name="l00430"></a>00430         CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#cf76b5500556d063c5d6cec9508879f6">DELTADY</a> = 4.7;
<a name="l00431"></a>00431         <a class="code" href="_tsyg2004_8c.html#3ec00913121c60795f4052645698ddba">DEFORMED</a>( IOPT, PS, XX, YY, ZZ, BXT1, BYT1, BZT1, BXT2, BYT2, BZT2);    <span class="comment">// TAIL FIELD (THREE MODES)</span>
<a name="l00432"></a>00432     } <span class="keywordflow">else</span> {
<a name="l00433"></a>00433         *BXT1=0.0;
<a name="l00434"></a>00434         *BYT1=0.0;
<a name="l00435"></a>00435         *BZT1=0.0;
<a name="l00436"></a>00436         *BXT2=0.0;
<a name="l00437"></a>00437         *BYT2=0.0;
<a name="l00438"></a>00438         *BZT2=0.0;
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440         
<a name="l00441"></a>00441     <span class="keywordflow">if</span>  ( (IOPGEN == 0) || (IOPGEN == 3) ) {
<a name="l00442"></a>00442         ZNAM = fabs( DST );
<a name="l00443"></a>00443         <span class="keywordflow">if</span> ( DST &gt;= -20.0 ) ZNAM = 20.0;
<a name="l00444"></a>00444         ZNAM05 = 0.05*ZNAM;
<a name="l00445"></a>00445         CB_BIRKPAR.<a class="code" href="struct___c_b___b_i_r_k_p_a_r.html#09d632f8debd75ca49c99493f5f7be3d">XKAPPA1</a> = A[32]*pow( ZNAM05, A[33] );
<a name="l00446"></a>00446         CB_BIRKPAR.<a class="code" href="struct___c_b___b_i_r_k_p_a_r.html#7939266cf05911b5c6f6e46e4e09e87c">XKAPPA2</a> = A[34]*pow( ZNAM05, A[35] );
<a name="l00447"></a>00447         <a class="code" href="_tsyg2004_8c.html#a448f7ca5c043203dab6208c5c982571">BIRK_TOT</a>( IOPB,PS,XX,YY,ZZ,BXR11,BYR11,BZR11,BXR12,BYR12,
<a name="l00448"></a>00448                 BZR12,BXR21,BYR21,BZR21,BXR22,BYR22,BZR22 );    <span class="comment">//   BIRKELAND FIELD (TWO MODES FOR R1 AND TWO MODES FOR R2)</span>
<a name="l00449"></a>00449     } <span class="keywordflow">else</span> {
<a name="l00450"></a>00450         *BXR11 = 0.0;
<a name="l00451"></a>00451         *BYR11 = 0.0;
<a name="l00452"></a>00452         *BZR11 = 0.0;
<a name="l00453"></a>00453         *BXR21 = 0.0;
<a name="l00454"></a>00454         *BYR21 = 0.0;
<a name="l00455"></a>00455         *BZR21 = 0.0;
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="keywordflow">if</span>  ( (IOPGEN == 0) || (IOPGEN == 4) ) {
<a name="l00460"></a>00460         CB_RCPAR.<a class="code" href="struct___c_b___r_c_p_a_r.html#38d8f926202c5208f4ea151b52bfe3ef">PHI</a>  = A[38];
<a name="l00461"></a>00461         ZNAM = fabs( DST );
<a name="l00462"></a>00462         <span class="keywordflow">if</span> ( DST &gt;= -20.0 ) ZNAM = 20.0;
<a name="l00463"></a>00463         ooZNAM20 = 20.0/ZNAM;
<a name="l00464"></a>00464         CB_RCPAR.<a class="code" href="struct___c_b___r_c_p_a_r.html#a409bcc6077e57d83a88020286993cce">SC_SY</a> = A[28]* pow( ooZNAM20, A[29]) * XAPPA;  <span class="comment">//</span>
<a name="l00465"></a>00465         CB_RCPAR.<a class="code" href="struct___c_b___r_c_p_a_r.html#4973a953d8c39d5be8e952d041b6adf4">SC_AS</a> = A[30]* pow( ooZNAM20, A[31]) * XAPPA;  <span class="comment">//  MULTIPLICATION  BY XAPPA IS MADE IN ORDER TO MAKE THE SRC AND PRC</span>
<a name="l00466"></a>00466                                 <span class="comment">//  SCALING COMPLETELY INDEPENDENT OF THE GENERAL SCALING DUE TO THE</span>
<a name="l00467"></a>00467                                 <span class="comment">//  MAGNETOPAUSE COMPRESSION/EXPANSION</span>
<a name="l00468"></a>00468         <a class="code" href="_tsyg2004_8c.html#2a492ba836369d99dfb597c1675f6a33">FULL_RC</a>( IOPR, PS, XX, YY, ZZ, BXSRC, BYSRC, BZSRC, BXPRC, BYPRC, BZPRC );  <span class="comment">// SHIELDED RING CURRENT (SRC AND PRC)</span>
<a name="l00469"></a>00469     } <span class="keywordflow">else</span> {
<a name="l00470"></a>00470         *BXSRC = 0.0;
<a name="l00471"></a>00471         *BYSRC = 0.0;
<a name="l00472"></a>00472         *BZSRC = 0.0;
<a name="l00473"></a>00473         *BXPRC = 0.0;
<a name="l00474"></a>00474         *BYPRC = 0.0;
<a name="l00475"></a>00475         *BZPRC = 0.0;
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478 
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <span class="keywordflow">if</span> ( (IOPGEN == 0) || (IOPGEN == 5) ) {
<a name="l00481"></a>00481         *HXIMF = 0.0;
<a name="l00482"></a>00482         *HYIMF = BYIMF;
<a name="l00483"></a>00483         *HZIMF = BZIMF; <span class="comment">//  THESE ARE COMPONENTS OF THE PENETRATED FIELD PER UNIT OF THE PENETRATION COEFFICIENT.</span>
<a name="l00484"></a>00484                 <span class="comment">//  IN OTHER WORDS, THESE ARE DERIVATIVES OF THE PENETRATION FIELD COMPONENTS WITH RESPECT</span>
<a name="l00485"></a>00485                 <span class="comment">//  TO THE PENETRATION COEFFICIENT.   WE ASSUME THAT ONLY TRANSVERSE COMPONENT OF THE</span>
<a name="l00486"></a>00486                 <span class="comment">//  FIELD PENETRATES INSIDE.</span>
<a name="l00487"></a>00487     } <span class="keywordflow">else</span> {
<a name="l00488"></a>00488         *HXIMF = 0.0;
<a name="l00489"></a>00489         *HYIMF = 0.0;
<a name="l00490"></a>00490         *HZIMF = 0.0;
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <span class="comment">/* </span>
<a name="l00496"></a>00496 <span class="comment">     *    NOW, ADD UP ALL THE COMPONENTS:</span>
<a name="l00497"></a>00497 <span class="comment">     */</span>
<a name="l00498"></a>00498     DLP1 = pow( 0.5*PDYN, A[21] );
<a name="l00499"></a>00499     DLP2 = pow( 0.5*PDYN, A[22] );
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     TAMP1 = A[2]  + A[3]*DLP1 +  A[4]*A[39]*W1/sqrt(W1*W1+A[39]*A[39]) + A[5]*DST;
<a name="l00502"></a>00502     TAMP2 = A[6]  + A[7]*DLP2 +  A[8]*A[40]*W2/sqrt(W2*W2+A[40]*A[40]) + A[9]*DST;
<a name="l00503"></a>00503     A_SRC = A[10]         + A[11]*A[41]*W3/sqrt(W3*W3+A[41]*A[41]) + A[12]*DST;
<a name="l00504"></a>00504     A_PRC = A[13]         + A[14]*A[42]*W4/sqrt(W4*W4+A[42]*A[42]) + A[15]*DST;
<a name="l00505"></a>00505     A_R11 = A[16]         + A[17]*A[43]*W5/sqrt(W5*W5+A[43]*A[43]);
<a name="l00506"></a>00506     A_R21 = A[18]         + A[19]*A[44]*W6/sqrt(W6*W6+A[44]*A[44]);
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     BBX = A[1]* *BXCF + TAMP1* *BXT1 + TAMP2* *BXT2 + A_SRC* *BXSRC + A_PRC* *BXPRC + A_R11* *BXR11 + A_R21* *BXR21 + A[20]* *HXIMF;
<a name="l00509"></a>00509     BBY = A[1]* *BYCF + TAMP1* *BYT1 + TAMP2* *BYT2 + A_SRC* *BYSRC + A_PRC* *BYPRC + A_R11* *BYR11 + A_R21* *BYR21 + A[20]* *HYIMF;
<a name="l00510"></a>00510     BBZ = A[1]* *BZCF + TAMP1* *BZT1 + TAMP2* *BZT2 + A_SRC* *BZSRC + A_PRC* *BZPRC + A_R11* *BZR11 + A_R21* *BZR21 + A[20]* *HZIMF;
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     <span class="comment">/* </span>
<a name="l00515"></a>00515 <span class="comment">     *    AND WE HAVE THE TOTAL EXTERNAL FIELD.</span>
<a name="l00516"></a>00516 <span class="comment">     *</span>
<a name="l00517"></a>00517 <span class="comment">     *</span>
<a name="l00518"></a>00518 <span class="comment">     *    NOW, LET US CHECK WHETHER WE HAVE THE CASE (1). IF YES - ALL DONE:</span>
<a name="l00519"></a>00519 <span class="comment">     */</span>
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     <span class="keywordflow">if</span> (SIGMA &lt; S0-DSIG) {      <span class="comment">//  (X,Y,Z) IS INSIDE THE MAGNETOSPHERE</span>
<a name="l00522"></a>00522         *BX = BBX;
<a name="l00523"></a>00523         *BY = BBY;
<a name="l00524"></a>00524         *BZ = BBZ;
<a name="l00525"></a>00525     } <span class="keywordflow">else</span> {            <span class="comment">//  THIS IS THE MOST COMPLEX CASE: WE ARE INSIDE</span>
<a name="l00526"></a>00526                     <span class="comment">//  THE INTERPOLATION REGION</span>
<a name="l00527"></a>00527         FINT = 0.5*(1.-(SIGMA-S0)/DSIG);
<a name="l00528"></a>00528         FEXT = 0.5*(1.+(SIGMA-S0)/DSIG);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530         <a class="code" href="_tsyg2004_8c.html#b1ff14f59abcc09994d8743db9a8f736">DIPOLE</a>( PS,X,Y,Z,&amp;QX,&amp;QY,&amp;QZ );
<a name="l00531"></a>00531         *BX = (BBX+QX)*FINT + OIMFX*FEXT - QX;
<a name="l00532"></a>00532         *BY = (BBY+QY)*FINT + OIMFY*FEXT - QY;
<a name="l00533"></a>00533         *BZ = (BBZ+QZ)*FINT + OIMFZ*FEXT - QZ;
<a name="l00534"></a>00534     }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     } <span class="keywordflow">else</span> {    <span class="comment">// THE CASES (1) AND (2) ARE EXHAUSTED; THE ONLY REMAINING</span>
<a name="l00538"></a>00538         <span class="comment">// POSSIBILITY IS NOW THE CASE (3):</span>
<a name="l00539"></a>00539     <a class="code" href="_tsyg2004_8c.html#b1ff14f59abcc09994d8743db9a8f736">DIPOLE</a>( PS,X,Y,Z,&amp;QX,&amp;QY,&amp;QZ );
<a name="l00540"></a>00540     *BX = OIMFX - QX;
<a name="l00541"></a>00541     *BY = OIMFY - QY;
<a name="l00542"></a>00542     *BZ = OIMFZ - QZ;
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <span class="keywordflow">return</span>;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <span class="comment">/*</span>
<a name="l00555"></a>00555 <span class="comment"> *    THIS S/R RETURNS THE SHIELDING FIELD FOR THE EARTH'S DIPOLE,</span>
<a name="l00556"></a>00556 <span class="comment"> *    REPRESENTED BY  2x3x3=18 "CARTESIAN" HARMONICS, tilted with respect</span>
<a name="l00557"></a>00557 <span class="comment"> *    to the z=0 plane</span>
<a name="l00558"></a>00558 <span class="comment"> * </span>
<a name="l00559"></a>00559 <span class="comment"> *  - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<a name="l00560"></a>00560 <span class="comment"> *   The 36 coefficients enter in pairs in the amplitudes of the "cartesian"</span>
<a name="l00561"></a>00561 <span class="comment"> *     harmonics (A(1)-A(36).</span>
<a name="l00562"></a>00562 <span class="comment"> *   The 14 nonlinear parameters (A(37)-A(50) are the scales Pi,Ri,Qi,and Si</span>
<a name="l00563"></a>00563 <span class="comment"> *    entering the arguments of exponents, sines, and cosines in each of the</span>
<a name="l00564"></a>00564 <span class="comment"> *    18 "Cartesian" harmonics  PLUS TWO TILT ANGLES FOR THE CARTESIAN HARMONICS</span>
<a name="l00565"></a>00565 <span class="comment"> *        (ONE FOR THE PSI=0 MODE AND ANOTHER FOR THE PSI=90 MODE)</span>
<a name="l00566"></a>00566 <span class="comment"> *  - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<a name="l00567"></a>00567 <span class="comment"> * </span>
<a name="l00568"></a>00568 <span class="comment"> */</span>
<a name="l00569"></a><a class="code" href="_tsyg2004_8c.html#464f1d83937f8412873a74ee415058a4">00569</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#464f1d83937f8412873a74ee415058a4">SHLCAR3X3</a>( <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ ) {
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     <span class="keyword">static</span> <span class="keywordtype">double</span>   A[] = { -9e99, -901.2327248,895.8011176,817.6208321,-845.5880889,
<a name="l00572"></a>00572                       -83.73539535,86.58542841,336.8781402,-329.3619944,-311.2947120,
<a name="l00573"></a>00573                       308.6011161,31.94469304,-31.30824526,125.8739681,-372.3384278,
<a name="l00574"></a>00574                       -235.4720434,286.7594095,21.86305585,-27.42344605,-150.4874688,
<a name="l00575"></a>00575                       2.669338538,1.395023949,-.5540427503,-56.85224007,3.681827033,
<a name="l00576"></a>00576                       -43.48705106,5.103131905,1.073551279,-.6673083508,12.21404266,
<a name="l00577"></a>00577                       4.177465543,5.799964188,-.3977802319,-1.044652977,.5703560010,
<a name="l00578"></a>00578                       3.536082962,-3.222069852,9.620648151,6.082014949,27.75216226,
<a name="l00579"></a>00579                       12.44199571,5.122226936,6.982039615,20.12149582,6.150973118,
<a name="l00580"></a>00580                       4.663639687,15.73319647,2.303504968,5.840511214,.8385953499E-01,
<a name="l00581"></a>00581                       .3477844929 };
<a name="l00582"></a>00582 
<a name="l00583"></a>00583     <span class="keywordtype">double</span>  P1, P2, P3, ooP1, ooP2, ooP3, ooP1_2, ooP2_2, ooP3_2;
<a name="l00584"></a>00584     <span class="keywordtype">double</span>  R1, R2, R3, ooR1, ooR2, ooR3, ooR1_2, ooR2_2, ooR3_2;
<a name="l00585"></a>00585     <span class="keywordtype">double</span>  Q1, Q2, Q3, ooQ1, ooQ2, ooQ3, ooQ1_2, ooQ2_2, ooQ3_2;
<a name="l00586"></a>00586     <span class="keywordtype">double</span>  S1, S2, S3, ooS1, ooS2, ooS3, ooS1_2, ooS2_2, ooS3_2;
<a name="l00587"></a>00587     <span class="keywordtype">double</span>  T1, T2;
<a name="l00588"></a>00588     <span class="keywordtype">double</span>  sqrtP1R1, sqrtP1R2, sqrtP1R3, sqrtP2R1, sqrtP2R2, sqrtP2R3, sqrtP3R1, sqrtP3R2, sqrtP3R3;
<a name="l00589"></a>00589     <span class="keywordtype">double</span>  sqrtQ1S1, sqrtQ1S2, sqrtQ1S3, sqrtQ2S1, sqrtQ2S2, sqrtQ2S3, sqrtQ3S1, sqrtQ3S2, sqrtQ3S3;
<a name="l00590"></a>00590     <span class="keywordtype">double</span>  YoP1, YoP2, YoP3, Z1oR1, Z1oR2, Z1oR3;
<a name="l00591"></a>00591     <span class="keywordtype">double</span>  YoQ1, YoQ2, YoQ3, Z2oS1, Z2oS2, Z2oS3;
<a name="l00592"></a>00592     <span class="keywordtype">double</span>  COSZ1oR1, COSZ1oR2, COSZ1oR3, SINZ1oR1, SINZ1oR2, SINZ1oR3;
<a name="l00593"></a>00593     <span class="keywordtype">double</span>  COSZ2oS1, COSZ2oS2, COSZ2oS3, SINZ2oS1, SINZ2oS2, SINZ2oS3;
<a name="l00594"></a>00594     <span class="keywordtype">double</span>  COSYoP1, COSYoP2, COSYoP3, SINYoP1, SINYoP2, SINYoP3;
<a name="l00595"></a>00595     <span class="keywordtype">double</span>  COSYoQ1, COSYoQ2, COSYoQ3, SINYoQ1, SINYoQ2, SINYoQ3;
<a name="l00596"></a>00596     <span class="keywordtype">double</span>  X1, X2, Z1, Z2, SQPR, EXPR, SQQS, EXQS, CPS, SPS, S2PS, ooSQPR;
<a name="l00597"></a>00597     <span class="keywordtype">double</span>  ST1, ST2, CT1, CT2;
<a name="l00598"></a>00598     <span class="keywordtype">double</span>  FX1, HY1, FZ1, HX1, HZ1, FX2, HY2, FZ2, HX2, HZ2, FX3, HY3, FZ3, HX3, HZ3;
<a name="l00599"></a>00599     <span class="keywordtype">double</span>  FX4, HY4, FZ4, HX4, HZ4, FX5, HY5, FZ5, HX5, HZ5, FX6, HY6, FZ6, HX6, HZ6;
<a name="l00600"></a>00600     <span class="keywordtype">double</span>  FX7, HY7, FZ7, HX7, HZ7, FX8, HY8, FZ8, HX8, HZ8, FX9, HY9, FZ9, HX9, HZ9;
<a name="l00601"></a>00601     <span class="keywordtype">double</span>  A1, A2, A3, A4, A5, A6, A7, A8, A9;
<a name="l00602"></a>00602 
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     P1 = A[37]; P2 = A[38]; P3=A[39];
<a name="l00605"></a>00605     R1 = A[40]; R2 = A[41]; R3=A[42];
<a name="l00606"></a>00606     Q1 = A[43]; Q2 = A[44]; Q3=A[45];
<a name="l00607"></a>00607     S1 = A[46]; S2 = A[47]; S3=A[48];
<a name="l00608"></a>00608     T1 = A[49]; T2 = A[50];
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 <span class="comment">//    CPS = cos(PS); SPS = sin(PS); S2PS = 2.0*CPS;</span>
<a name="l00611"></a>00611     CPS = <a class="code" href="_tsyg2004_8c.html#98e0e08bb8a65f90813e5adb482aeb2c">cos_psi</a>; SPS = <a class="code" href="_tsyg2004_8c.html#5b35fcda1a15310fa7b7e3e242431de3">sin_psi</a>; S2PS = 2.0*CPS;
<a name="l00612"></a>00612 
<a name="l00613"></a>00613     ST1 = sin( PS*T1 ); CT1 = cos( PS*T1 ); 
<a name="l00614"></a>00614     ST2 = sin( PS*T2 ); CT2 = cos( PS*T2 );
<a name="l00615"></a>00615 
<a name="l00616"></a>00616     X1 = X*CT1 - Z*ST1; Z1 = X*ST1 + Z*CT1;
<a name="l00617"></a>00617     X2 = X*CT2 - Z*ST2; Z2 = X*ST2 + Z*CT2;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <span class="comment">/*</span>
<a name="l00620"></a>00620 <span class="comment">     *   MAKE THE TERMS IN THE 1ST SUM ("PERPENDICULAR" SYMMETRY):</span>
<a name="l00621"></a>00621 <span class="comment">      *</span>
<a name="l00622"></a>00622 <span class="comment">     *   MGH - the original fortran code repeats many calculations.</span>
<a name="l00623"></a>00623 <span class="comment">     *         In addition, there are far more divides than necessary.</span>
<a name="l00624"></a>00624 <span class="comment">     *         Very expensive. (Is there a recurrence relation for any of this?)</span>
<a name="l00625"></a>00625 <span class="comment">     *         sqrt()'s andm trigs are very expensive so dont do more than we need. </span>
<a name="l00626"></a>00626 <span class="comment">     */</span>
<a name="l00627"></a>00627 <span class="comment">// do these change? Isnt this wasteful if they dont?</span>
<a name="l00628"></a>00628 <span class="comment">// especially the sqrt() below...</span>
<a name="l00629"></a>00629     ooP1 = 1.0/P1; ooP1_2 = ooP1*ooP1;
<a name="l00630"></a>00630     ooP2 = 1.0/P2; ooP2_2 = ooP2*ooP2;
<a name="l00631"></a>00631     ooP3 = 1.0/P3; ooP3_2 = ooP3*ooP3;
<a name="l00632"></a>00632     ooR1 = 1.0/R1; ooR1_2 = ooR1*ooR1;
<a name="l00633"></a>00633     ooR2 = 1.0/R2; ooR2_2 = ooR2*ooR2;
<a name="l00634"></a>00634     ooR3 = 1.0/R3; ooR3_2 = ooR3*ooR3;
<a name="l00635"></a>00635     
<a name="l00636"></a>00636 <span class="comment">// are these constants?!</span>
<a name="l00637"></a>00637     sqrtP1R1 = sqrt(ooP1_2 + ooR1_2);
<a name="l00638"></a>00638     sqrtP1R2 = sqrt(ooP1_2 + ooR2_2);
<a name="l00639"></a>00639     sqrtP1R3 = sqrt(ooP1_2 + ooR3_2);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     sqrtP2R1 = sqrt(ooP2_2 + ooR1_2);
<a name="l00642"></a>00642     sqrtP2R2 = sqrt(ooP2_2 + ooR2_2);
<a name="l00643"></a>00643     sqrtP2R3 = sqrt(ooP2_2 + ooR3_2);
<a name="l00644"></a>00644 
<a name="l00645"></a>00645     sqrtP3R1 = sqrt(ooP3_2 + ooR1_2);
<a name="l00646"></a>00646     sqrtP3R2 = sqrt(ooP3_2 + ooR2_2);
<a name="l00647"></a>00647     sqrtP3R3 = sqrt(ooP3_2 + ooR3_2);
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     
<a name="l00650"></a>00650     YoP1 = Y*ooP1;
<a name="l00651"></a>00651     YoP2 = Y*ooP2;
<a name="l00652"></a>00652     YoP3 = Y*ooP3;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654     Z1oR1 = Z1*ooR1;
<a name="l00655"></a>00655     Z1oR2 = Z1*ooR2;
<a name="l00656"></a>00656     Z1oR3 = Z1*ooR3;
<a name="l00657"></a>00657 
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     COSZ1oR1 = cos(Z1oR1); SINZ1oR1 = sin(Z1oR1);
<a name="l00660"></a>00660     COSZ1oR2 = cos(Z1oR2); SINZ1oR2 = sin(Z1oR2);
<a name="l00661"></a>00661     COSZ1oR3 = cos(Z1oR3); SINZ1oR3 = sin(Z1oR3);
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     COSYoP1 = cos(YoP1); SINYoP1 = sin(YoP1);
<a name="l00664"></a>00664     COSYoP2 = cos(YoP2); SINYoP2 = sin(YoP2);
<a name="l00665"></a>00665     COSYoP3 = cos(YoP3); SINYoP3 = sin(YoP3);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667 
<a name="l00668"></a>00668     <span class="comment">// I = 1</span>
<a name="l00669"></a>00669     SQPR =  sqrtP1R1; EXPR =  exp(SQPR*X1);
<a name="l00670"></a>00670     FX1  = -SQPR*EXPR*COSYoP1*SINZ1oR1;
<a name="l00671"></a>00671     HY1  =  EXPR*ooP1*SINYoP1*SINZ1oR1;
<a name="l00672"></a>00672     FZ1  = -EXPR*COSYoP1*ooR1*COSZ1oR1;
<a name="l00673"></a>00673     HX1  =  FX1*CT1 + FZ1*ST1;
<a name="l00674"></a>00674     HZ1  = -FX1*ST1 + FZ1*CT1;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676     SQPR =  sqrtP1R2; EXPR =  exp(SQPR*X1);
<a name="l00677"></a>00677     FX2  = -SQPR*EXPR*COSYoP1*SINZ1oR2;
<a name="l00678"></a>00678     HY2  =  EXPR*ooP1*SINYoP1*SINZ1oR2;
<a name="l00679"></a>00679     FZ2  = -EXPR*COSYoP1*ooR2*COSZ1oR2;
<a name="l00680"></a>00680     HX2  =  FX2*CT1+FZ2*ST1;
<a name="l00681"></a>00681     HZ2  = -FX2*ST1+FZ2*CT1;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683     SQPR =  sqrtP1R3; ooSQPR = 1.0/SQPR; EXPR =  exp(SQPR*X1);
<a name="l00684"></a>00684     FX3  = -EXPR*COSYoP1*(SQPR*Z1*COSZ1oR3 + SINZ1oR3*ooR3*(X1+ooSQPR));
<a name="l00685"></a>00685     HY3  =  EXPR*ooP1*SINYoP1*(Z1*COSZ1oR3 + X1*ooR3*SINZ1oR3*ooSQPR);
<a name="l00686"></a>00686     FZ3  = -EXPR*COSYoP1*( COSZ1oR3*(1.0 + X1*ooR3_2*ooSQPR) - Z1*ooR3*SINZ1oR3);
<a name="l00687"></a>00687     HX3  =  FX3*CT1 + FZ3*ST1;
<a name="l00688"></a>00688     HZ3  = -FX3*ST1 + FZ3*CT1;
<a name="l00689"></a>00689 
<a name="l00690"></a>00690 
<a name="l00691"></a>00691     <span class="comment">// I = 2</span>
<a name="l00692"></a>00692     SQPR =  sqrtP2R1; EXPR =  exp(SQPR*X1);
<a name="l00693"></a>00693     FX4  = -SQPR*EXPR*COSYoP2*SINZ1oR1;
<a name="l00694"></a>00694     HY4  =  EXPR*ooP2*SINYoP2*SINZ1oR1;
<a name="l00695"></a>00695     FZ4  = -EXPR*COSYoP2*ooR1*COSZ1oR1;
<a name="l00696"></a>00696     HX4  =  FX4*CT1+FZ4*ST1;
<a name="l00697"></a>00697     HZ4  = -FX4*ST1+FZ4*CT1;
<a name="l00698"></a>00698         
<a name="l00699"></a>00699     SQPR =  sqrtP2R2; EXPR =  exp(SQPR*X1);
<a name="l00700"></a>00700     FX5  = -SQPR*EXPR*COSYoP2*SINZ1oR2;
<a name="l00701"></a>00701     HY5  =  EXPR*ooP2*SINYoP2*SINZ1oR2;
<a name="l00702"></a>00702     FZ5  = -EXPR*COSYoP2*ooR2*COSZ1oR2;
<a name="l00703"></a>00703     HX5  =  FX5*CT1+FZ5*ST1;
<a name="l00704"></a>00704     HZ5  = -FX5*ST1+FZ5*CT1;
<a name="l00705"></a>00705 
<a name="l00706"></a>00706     SQPR =  sqrtP2R3; ooSQPR = 1.0/SQPR; EXPR =  exp(SQPR*X1);
<a name="l00707"></a>00707     FX6  = -EXPR*COSYoP2*(SQPR*Z1*COSZ1oR3+SINZ1oR3/R3*(X1+ooSQPR));
<a name="l00708"></a>00708     HY6  =  EXPR*ooP2*SINYoP2*(Z1*COSZ1oR3+X1*ooR3*SINZ1oR3*ooSQPR);
<a name="l00709"></a>00709     FZ6  = -EXPR*COSYoP2*(COSZ1oR3*(1.0+X1*ooR3_2*ooSQPR)-Z1*ooR3*SINZ1oR3);
<a name="l00710"></a>00710     HX6  =  FX6*CT1+FZ6*ST1;
<a name="l00711"></a>00711     HZ6  = -FX6*ST1+FZ6*CT1;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713 
<a name="l00714"></a>00714     <span class="comment">// I = 3</span>
<a name="l00715"></a>00715     SQPR =  sqrtP3R1; EXPR =  exp(SQPR*X1);
<a name="l00716"></a>00716     FX7  = -SQPR*EXPR*COSYoP3*SINZ1oR1;
<a name="l00717"></a>00717     HY7  =  EXPR*ooP3*SINYoP3*SINZ1oR1;
<a name="l00718"></a>00718     FZ7  = -EXPR*COSYoP3*ooR1*COSZ1oR1;
<a name="l00719"></a>00719     HX7  =  FX7*CT1+FZ7*ST1;
<a name="l00720"></a>00720     HZ7  = -FX7*ST1+FZ7*CT1;
<a name="l00721"></a>00721     
<a name="l00722"></a>00722     SQPR =  sqrtP3R2; EXPR =  exp(SQPR*X1);
<a name="l00723"></a>00723     FX8  = -SQPR*EXPR*COSYoP3*SINZ1oR2;
<a name="l00724"></a>00724     HY8  =  EXPR*ooP3*SINYoP3*SINZ1oR2;
<a name="l00725"></a>00725     FZ8  = -EXPR*COSYoP3*ooR2*COSZ1oR2;
<a name="l00726"></a>00726     HX8  =  FX8*CT1+FZ8*ST1;
<a name="l00727"></a>00727     HZ8  = -FX8*ST1+FZ8*CT1;
<a name="l00728"></a>00728     
<a name="l00729"></a>00729     SQPR =  sqrtP3R3; ooSQPR = 1.0/SQPR; EXPR =  exp(SQPR*X1);
<a name="l00730"></a>00730     FX9  = -EXPR*COSYoP3*(SQPR*Z1*COSZ1oR3+SINZ1oR3*ooR3*(X1+ooSQPR));
<a name="l00731"></a>00731     HY9  =  EXPR*ooP3*SINYoP3*(Z1*COSZ1oR3+X1*ooR3*SINZ1oR3*ooSQPR);
<a name="l00732"></a>00732     FZ9  = -EXPR*COSYoP3*(COSZ1oR3*(1.0+X1*ooR3_2*ooSQPR)-Z1*ooR3*SINZ1oR3);
<a name="l00733"></a>00733     HX9  =  FX9*CT1+FZ9*ST1;
<a name="l00734"></a>00734     HZ9  = -FX9*ST1+FZ9*CT1;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     A1 = A[1]  + A[2]*CPS;
<a name="l00737"></a>00737     A2 = A[3]  + A[4]*CPS;
<a name="l00738"></a>00738     A3 = A[5]  + A[6]*CPS;
<a name="l00739"></a>00739     A4 = A[7]  + A[8]*CPS;
<a name="l00740"></a>00740     A5 = A[9]  + A[10]*CPS;
<a name="l00741"></a>00741     A6 = A[11] + A[12]*CPS;
<a name="l00742"></a>00742     A7 = A[13] + A[14]*CPS;
<a name="l00743"></a>00743     A8 = A[15] + A[16]*CPS;
<a name="l00744"></a>00744     A9 = A[17] + A[18]*CPS;
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     *BX = A1*HX1 + A2*HX2 + A3*HX3 + A4*HX4 + A5*HX5 + A6*HX6 + A7*HX7 + A8*HX8 + A9*HX9;
<a name="l00747"></a>00747     *BY = A1*HY1 + A2*HY2 + A3*HY3 + A4*HY4 + A5*HY5 + A6*HY6 + A7*HY7 + A8*HY8 + A9*HY9;
<a name="l00748"></a>00748     *BZ = A1*HZ1 + A2*HZ2 + A3*HZ3 + A4*HZ4 + A5*HZ5 + A6*HZ6 + A7*HZ7 + A8*HZ8 + A9*HZ9;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750 
<a name="l00751"></a>00751 
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     <span class="comment">/*</span>
<a name="l00754"></a>00754 <span class="comment">     *  MAKE THE TERMS IN THE 2ND SUM ("PARALLEL" SYMMETRY):</span>
<a name="l00755"></a>00755 <span class="comment">     */</span>
<a name="l00756"></a>00756     ooQ1 = 1.0/Q1; ooQ1_2 = ooQ1*ooQ1;
<a name="l00757"></a>00757     ooQ2 = 1.0/Q2; ooQ2_2 = ooQ2*ooQ2;
<a name="l00758"></a>00758     ooQ3 = 1.0/Q3; ooQ3_2 = ooQ3*ooQ3;
<a name="l00759"></a>00759     ooS1 = 1.0/S1; ooS1_2 = ooR1*ooS1;
<a name="l00760"></a>00760     ooS2 = 1.0/S2; ooS2_2 = ooR2*ooS2;
<a name="l00761"></a>00761     ooS3 = 1.0/S3; ooS3_2 = ooR3*ooS3;
<a name="l00762"></a>00762     
<a name="l00763"></a>00763     sqrtQ1S1 = sqrt(ooQ1_2 + ooS1_2);
<a name="l00764"></a>00764     sqrtQ1S2 = sqrt(ooQ1_2 + ooS2_2);
<a name="l00765"></a>00765     sqrtQ1S3 = sqrt(ooQ1_2 + ooS3_2);
<a name="l00766"></a>00766 
<a name="l00767"></a>00767     sqrtQ2S1 = sqrt(ooQ2_2 + ooS1_2);
<a name="l00768"></a>00768     sqrtQ2S2 = sqrt(ooQ2_2 + ooS2_2);
<a name="l00769"></a>00769     sqrtQ2S3 = sqrt(ooQ2_2 + ooS3_2);
<a name="l00770"></a>00770 
<a name="l00771"></a>00771     sqrtQ3S1 = sqrt(ooQ3_2 + ooS1_2);
<a name="l00772"></a>00772     sqrtQ3S2 = sqrt(ooQ3_2 + ooS2_2);
<a name="l00773"></a>00773     sqrtQ3S3 = sqrt(ooQ3_2 + ooS3_2);
<a name="l00774"></a>00774 
<a name="l00775"></a>00775     
<a name="l00776"></a>00776     YoQ1 = Y*ooQ1;
<a name="l00777"></a>00777     YoQ2 = Y*ooQ2;
<a name="l00778"></a>00778     YoQ3 = Y*ooQ3;
<a name="l00779"></a>00779 
<a name="l00780"></a>00780     Z2oS1 = Z2*ooS1;
<a name="l00781"></a>00781     Z2oS2 = Z2*ooS2;
<a name="l00782"></a>00782     Z2oS3 = Z2*ooS3;
<a name="l00783"></a>00783 
<a name="l00784"></a>00784     COSZ2oS1 = cos(Z2oS1); SINZ2oS1 = sin(Z2oS1);
<a name="l00785"></a>00785     COSZ2oS2 = cos(Z2oS2); SINZ2oS2 = sin(Z2oS2);
<a name="l00786"></a>00786     COSZ2oS3 = cos(Z2oS3); SINZ2oS3 = sin(Z2oS3);
<a name="l00787"></a>00787 
<a name="l00788"></a>00788     COSYoQ1 = cos(YoQ1); SINYoQ1 = sin(YoQ1);
<a name="l00789"></a>00789     COSYoQ2 = cos(YoQ2); SINYoQ2 = sin(YoQ2);
<a name="l00790"></a>00790     COSYoQ3 = cos(YoQ3); SINYoQ3 = sin(YoQ3);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792     <span class="comment">// I = 1</span>
<a name="l00793"></a>00793     SQQS =  sqrtQ1S1; EXQS =  exp(SQQS*X2);
<a name="l00794"></a>00794     FX1  = -SQQS*EXQS*COSYoQ1*COSZ2oS1 *SPS;
<a name="l00795"></a>00795     HY1  =  EXQS*ooQ1*SINYoQ1*COSZ2oS1   *SPS;
<a name="l00796"></a>00796     FZ1  =  EXQS*COSYoQ1*ooS1*SINZ2oS1   *SPS;
<a name="l00797"></a>00797     HX1  =  FX1*CT2+FZ1*ST2;
<a name="l00798"></a>00798     HZ1  = -FX1*ST2+FZ1*CT2;
<a name="l00799"></a>00799         
<a name="l00800"></a>00800     SQQS =  sqrtQ1S2; EXQS =  exp(SQQS*X2);
<a name="l00801"></a>00801     FX2  = -SQQS*EXQS*COSYoQ1*COSZ2oS1 *SPS;
<a name="l00802"></a>00802     HY2  =  EXQS*ooQ1*SINYoQ1*COSZ2oS1   *SPS;
<a name="l00803"></a>00803     FZ2  =  EXQS*COSYoQ1*ooS2*SINZ2oS1   *SPS;
<a name="l00804"></a>00804     HX2  =  FX2*CT2+FZ2*ST2;
<a name="l00805"></a>00805     HZ2  = -FX2*ST2+FZ2*CT2;
<a name="l00806"></a>00806         
<a name="l00807"></a>00807     SQQS =  sqrtQ1S3; EXQS =  exp(SQQS*X2);
<a name="l00808"></a>00808     FX3  = -SQQS*EXQS*COSYoQ1*COSZ2oS1 *SPS;
<a name="l00809"></a>00809     HY3  =  EXQS*ooQ1*SINYoQ1*COSZ2oS1   *SPS;
<a name="l00810"></a>00810     FZ3  =  EXQS*COSYoQ1*ooS3*SINZ2oS1   *SPS;
<a name="l00811"></a>00811     HX3  =  FX3*CT2+FZ3*ST2;
<a name="l00812"></a>00812     HZ3  = -FX3*ST2+FZ3*CT2;
<a name="l00813"></a>00813 
<a name="l00814"></a>00814 
<a name="l00815"></a>00815     <span class="comment">// I = 2</span>
<a name="l00816"></a>00816     SQQS =  sqrtQ2S1; EXQS =  exp(SQQS*X2);
<a name="l00817"></a>00817     FX4  = -SQQS*EXQS*COSYoQ2*COSZ2oS1 *SPS;
<a name="l00818"></a>00818     HY4  =  EXQS*ooQ2*SINYoQ2*COSZ2oS1   *SPS;
<a name="l00819"></a>00819     FZ4  =  EXQS*COSYoQ2*ooS1*SINZ2oS1   *SPS;
<a name="l00820"></a>00820     HX4  =  FX4*CT2+FZ4*ST2;
<a name="l00821"></a>00821     HZ4  = -FX4*ST2+FZ4*CT2;
<a name="l00822"></a>00822     
<a name="l00823"></a>00823     SQQS =  sqrtQ2S2; EXQS =  exp(SQQS*X2);
<a name="l00824"></a>00824     FX5  = -SQQS*EXQS*COSYoQ2*COSZ2oS1 *SPS;
<a name="l00825"></a>00825     HY5  =  EXQS*ooQ2*SINYoQ2*COSZ2oS1   *SPS;
<a name="l00826"></a>00826     FZ5  =  EXQS*COSYoQ2*ooS2*SINZ2oS1   *SPS;
<a name="l00827"></a>00827     HX5  =  FX5*CT2+FZ5*ST2;
<a name="l00828"></a>00828     HZ5  = -FX5*ST2+FZ5*CT2;
<a name="l00829"></a>00829     
<a name="l00830"></a>00830     SQQS =  sqrtQ2S3; EXQS =  exp(SQQS*X2);
<a name="l00831"></a>00831     FX6  = -SQQS*EXQS*COSYoQ2*COSZ2oS1 *SPS;
<a name="l00832"></a>00832     HY6  =  EXQS*ooQ2*SINYoQ2*COSZ2oS1   *SPS;
<a name="l00833"></a>00833     FZ6  =  EXQS*COSYoQ2*ooS3*SINZ2oS1   *SPS;
<a name="l00834"></a>00834     HX6  =  FX6*CT2+FZ6*ST2;
<a name="l00835"></a>00835     HZ6  = -FX6*ST2+FZ6*CT2;
<a name="l00836"></a>00836 
<a name="l00837"></a>00837     <span class="comment">// I = 3</span>
<a name="l00838"></a>00838     SQQS =  sqrtQ3S1; EXQS =  exp(SQQS*X2);
<a name="l00839"></a>00839     FX7  = -SQQS*EXQS*COSYoQ3*COSZ2oS1 *SPS;
<a name="l00840"></a>00840     HY7  =  EXQS*ooQ3*SINYoQ3*COSZ2oS1   *SPS;
<a name="l00841"></a>00841     FZ7  =  EXQS*COSYoQ3*ooS1*SINZ2oS1   *SPS;
<a name="l00842"></a>00842     HX7  =  FX7*CT2+FZ7*ST2;
<a name="l00843"></a>00843     HZ7  = -FX7*ST2+FZ7*CT2;
<a name="l00844"></a>00844     
<a name="l00845"></a>00845     SQQS =  sqrtQ3S2; EXQS =  exp(SQQS*X2);
<a name="l00846"></a>00846     FX8  = -SQQS*EXQS*COSYoQ3*COSZ2oS1 *SPS;
<a name="l00847"></a>00847     HY8  =  EXQS*ooQ3*SINYoQ3*COSZ2oS1   *SPS;
<a name="l00848"></a>00848     FZ8  =  EXQS*COSYoQ3*ooS2*SINZ2oS1   *SPS;
<a name="l00849"></a>00849     HX8  =  FX8*CT2+FZ8*ST2;
<a name="l00850"></a>00850     HZ8  = -FX8*ST2+FZ8*CT2;
<a name="l00851"></a>00851     
<a name="l00852"></a>00852     SQQS =  sqrtQ3S3; EXQS =  exp(SQQS*X2);
<a name="l00853"></a>00853     FX9  = -SQQS*EXQS*COSYoQ3*COSZ2oS1 *SPS;
<a name="l00854"></a>00854     HY9  =  EXQS*ooQ3*SINYoQ3*COSZ2oS1   *SPS;
<a name="l00855"></a>00855     FZ9  =  EXQS*COSYoQ3*ooS3*SINZ2oS1   *SPS;
<a name="l00856"></a>00856     HX9  =  FX9*CT2+FZ9*ST2;
<a name="l00857"></a>00857     HZ9  = -FX9*ST2+FZ9*CT2;
<a name="l00858"></a>00858     
<a name="l00859"></a>00859     A1 = A[19] + A[20]*S2PS;
<a name="l00860"></a>00860     A2 = A[21] + A[22]*S2PS;
<a name="l00861"></a>00861     A3 = A[23] + A[24]*S2PS;
<a name="l00862"></a>00862     A4 = A[25] + A[26]*S2PS;
<a name="l00863"></a>00863     A5 = A[27] + A[28]*S2PS;
<a name="l00864"></a>00864     A6 = A[29] + A[30]*S2PS;
<a name="l00865"></a>00865     A7 = A[31] + A[32]*S2PS;
<a name="l00866"></a>00866     A8 = A[33] + A[34]*S2PS;
<a name="l00867"></a>00867     A9 = A[35] + A[36]*S2PS;
<a name="l00868"></a>00868     
<a name="l00869"></a>00869     
<a name="l00870"></a>00870     *BX += A1*HX1 + A2*HX2 + A3*HX3 + A4*HX4 + A5*HX5 + A6*HX6 + A7*HX7 + A8*HX8 + A9*HX9;
<a name="l00871"></a>00871     *BY += A1*HY1 + A2*HY2 + A3*HY3 + A4*HY4 + A5*HY5 + A6*HY6 + A7*HY7 + A8*HY8 + A9*HY9;
<a name="l00872"></a>00872     *BZ += A1*HZ1 + A2*HZ2 + A3*HZ3 + A4*HZ4 + A5*HZ5 + A6*HZ6 + A7*HZ7 + A8*HZ8 + A9*HZ9;
<a name="l00873"></a>00873 
<a name="l00874"></a>00874 
<a name="l00875"></a>00875     <span class="keywordflow">return</span>;
<a name="l00876"></a>00876 
<a name="l00877"></a>00877 
<a name="l00878"></a>00878 }
<a name="l00879"></a>00879 
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 
<a name="l00882"></a>00882 
<a name="l00883"></a>00883 
<a name="l00884"></a><a class="code" href="_tsyg2004_8c.html#3ec00913121c60795f4052645698ddba">00884</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#3ec00913121c60795f4052645698ddba">DEFORMED</a>( <span class="keywordtype">int</span> IOPT, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z,
<a name="l00885"></a>00885         <span class="keywordtype">double</span> *BX1, <span class="keywordtype">double</span> *BY1, <span class="keywordtype">double</span> *BZ1, <span class="keywordtype">double</span> *BX2, <span class="keywordtype">double</span> *BY2, <span class="keywordtype">double</span> *BZ2) {
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 <span class="comment">//    static int        IEPS=3;</span>
<a name="l00888"></a>00888     <span class="keyword">static</span> <span class="keywordtype">double</span>   RH2=-5.2;
<a name="l00889"></a>00889     <span class="keywordtype">double</span>      SPS, CPS, R2, R, ZR, RH, DRHDR, DRHDZ, RRH, F, DFDR, DFDRH;
<a name="l00890"></a>00890     <span class="keywordtype">double</span>      SPSAS, CPSAS, XAS, ZAS, FACPS, PSASX, PSASY, PSASZ;
<a name="l00891"></a>00891     <span class="keywordtype">double</span>      DXASDX, DXASDY, DXASDZ, DZASDX, DZASDY, DZASDZ, FAC1, FAC2, FAC3;
<a name="l00892"></a>00892     <span class="keywordtype">double</span>      SPS2, X2, Y2, Z2, ooR, ZR2, RRH2, RRH3, F2, F4, SPSAS2, ooCPSAS;
<a name="l00893"></a>00893     <span class="keywordtype">double</span>      BXAS1, BYAS1, BZAS1, BXAS2, BYAS2, BZAS2;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     <span class="comment">/*</span>
<a name="l00897"></a>00897 <span class="comment">     *   RH0,RH1,RH2, AND IEPS CONTROL THE TILT-RELATED DEFORMATION OF THE TAIL FIELD</span>
<a name="l00898"></a>00898 <span class="comment">     */</span> 
<a name="l00899"></a>00899     <span class="comment">//SPS = sin(PS); SPS2 = SPS*SPS;</span>
<a name="l00900"></a>00900     SPS = <a class="code" href="_tsyg2004_8c.html#5b35fcda1a15310fa7b7e3e242431de3">sin_psi</a>; SPS2 = SPS*SPS;
<a name="l00901"></a>00901     CPS = sqrt(1.0-SPS2);
<a name="l00902"></a>00902     X2 = X*X; Y2 = Y*Y; Z2 = Z*Z; R2 = X2+Y2+Z2;
<a name="l00903"></a>00903     R = sqrt(R2); ooR = 1.0/R;
<a name="l00904"></a>00904     ZR = Z*ooR; ZR2 = ZR*ZR;
<a name="l00905"></a>00905     RH = CB_RH0.<a class="code" href="struct___c_b___r_h0.html#b8de82fc4984cbf441791ce41d02862e">RH0</a>+RH2*ZR2;
<a name="l00906"></a>00906     DRHDR = -ZR*ooR*2.0*RH2*ZR;
<a name="l00907"></a>00907     DRHDZ =  2.0*RH2*ZR*ooR;
<a name="l00908"></a>00908 
<a name="l00909"></a>00909     RRH = R/RH; RRH2 = RRH*RRH;  RRH3 = RRH2*RRH;
<a name="l00910"></a>00910         
<a name="l00911"></a>00911     F = pow( 1.0/(1.0+RRH3), 1.0/3.0 ); F2 = F*F; F4 = F2*F2;
<a name="l00912"></a>00912     DFDR = -RRH2*F4/RH;
<a name="l00913"></a>00913     DFDRH = -RRH*DFDR;
<a name="l00914"></a>00914  
<a name="l00915"></a>00915     SPSAS = SPS*F; SPSAS2 = SPSAS*SPSAS;
<a name="l00916"></a>00916     CPSAS = sqrt(1.0-SPSAS2);
<a name="l00917"></a>00917  
<a name="l00918"></a>00918     XAS = X*CPSAS-Z*SPSAS;
<a name="l00919"></a>00919     ZAS = X*SPSAS+Z*CPSAS;
<a name="l00920"></a>00920  
<a name="l00921"></a>00921     ooCPSAS = 1.0/CPSAS;
<a name="l00922"></a>00922     FACPS = SPS*ooCPSAS*(DFDR+DFDRH*DRHDR)*ooR;
<a name="l00923"></a>00923     PSASX = FACPS*X;
<a name="l00924"></a>00924     PSASY = FACPS*Y;
<a name="l00925"></a>00925     PSASZ = FACPS*Z+SPS*ooCPSAS*DFDRH*DRHDZ;
<a name="l00926"></a>00926  
<a name="l00927"></a>00927     DXASDX = CPSAS-ZAS*PSASX;
<a name="l00928"></a>00928     DXASDY = -ZAS*PSASY;
<a name="l00929"></a>00929     DXASDZ = -SPSAS-ZAS*PSASZ;
<a name="l00930"></a>00930     DZASDX = SPSAS+XAS*PSASX;
<a name="l00931"></a>00931     DZASDY = XAS*PSASY;
<a name="l00932"></a>00932     DZASDZ = CPSAS+XAS*PSASZ;
<a name="l00933"></a>00933     FAC1 = DXASDZ*DZASDY-DXASDY*DZASDZ;
<a name="l00934"></a>00934     FAC2 = DXASDX*DZASDZ-DXASDZ*DZASDX;
<a name="l00935"></a>00935     FAC3 = DZASDX*DXASDY-DXASDX*DZASDY;
<a name="l00936"></a>00936 
<a name="l00937"></a>00937 
<a name="l00938"></a>00938     <span class="comment">/* </span>
<a name="l00939"></a>00939 <span class="comment">     *      DEFORM:</span>
<a name="l00940"></a>00940 <span class="comment">     */</span> 
<a name="l00941"></a>00941     <a class="code" href="_tsyg2004_8c.html#584f134348f99945741cf42bfbd511d5">WARPED</a>( IOPT, PS, XAS, Y, ZAS, &amp;BXAS1, &amp;BYAS1, &amp;BZAS1, &amp;BXAS2, &amp;BYAS2, &amp;BZAS2 );
<a name="l00942"></a>00942  
<a name="l00943"></a>00943     *BX1 = BXAS1*DZASDZ - BZAS1*DXASDZ + BYAS1*FAC1;
<a name="l00944"></a>00944     *BY1 = BYAS1*FAC2;
<a name="l00945"></a>00945     *BZ1 = BZAS1*DXASDX - BXAS1*DZASDX + BYAS1*FAC3;
<a name="l00946"></a>00946 
<a name="l00947"></a>00947         
<a name="l00948"></a>00948     *BX2 = BXAS2*DZASDZ - BZAS2*DXASDZ + BYAS2*FAC1;
<a name="l00949"></a>00949     *BY2 = BYAS2*FAC2;
<a name="l00950"></a>00950     *BZ2 = BZAS2*DXASDX - BXAS2*DZASDX + BYAS2*FAC3;
<a name="l00951"></a>00951         
<a name="l00952"></a>00952     <span class="keywordflow">return</span>;
<a name="l00953"></a>00953 
<a name="l00954"></a>00954 }
<a name="l00955"></a>00955 
<a name="l00956"></a>00956 
<a name="l00957"></a>00957 
<a name="l00958"></a><a class="code" href="_tsyg2004_8c.html#584f134348f99945741cf42bfbd511d5">00958</a> <span class="keywordtype">void</span> <a class="code" href="_tsyg2004_8c.html#584f134348f99945741cf42bfbd511d5">WARPED</a>( <span class="keywordtype">int</span> IOPT, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, 
<a name="l00959"></a>00959     <span class="keywordtype">double</span> *BX1, <span class="keywordtype">double</span> *BY1, <span class="keywordtype">double</span> *BZ1, <span class="keywordtype">double</span> *BX2, <span class="keywordtype">double</span> *BY2, <span class="keywordtype">double</span> *BZ2) {
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     <span class="comment">/* </span>
<a name="l00962"></a>00962 <span class="comment">     *    CALCULATES GSM COMPONENTS OF THE WARPED FIELD FOR TWO TAIL UNIT MODES.</span>
<a name="l00963"></a>00963 <span class="comment">     *    THE WARPING DEFORMATION IS IMPOSED ON THE UNWARPED FIELD, COMPUTED</span>
<a name="l00964"></a>00964 <span class="comment">     *    BY THE S/R "UNWARPED".  THE WARPING PARAMETERS WERE TAKEN FROM THE</span>
<a name="l00965"></a>00965 <span class="comment">     *    RESULTS OF GEOTAIL OBSERVATIONS (TSYGANENKO ET AL. [1998]).</span>
<a name="l00966"></a>00966 <span class="comment">     *    NB # 6, P.106, OCT 12, 2000.</span>
<a name="l00967"></a>00967 <span class="comment">     * </span>
<a name="l00968"></a>00968 <span class="comment">     *    IOPT - TAIL FIELD MODE FLAG:   IOPT=0 - THE TWO TAIL MODES ARE ADDED UP</span>
<a name="l00969"></a>00969 <span class="comment">     *                                   IOPT=1 - MODE 1 ONLY</span>
<a name="l00970"></a>00970 <span class="comment">     *                                   IOPT=2 - MODE 2 ONLY</span>
<a name="l00971"></a>00971 <span class="comment">     */</span>
<a name="l00972"></a>00972     <span class="keywordtype">double</span>  DGDX, XL, DXLDX, SPS, RHO2, RHO, PHI, CPHI, SPHI, XL2, XL4, XL3, RHO4, RR4L4;
<a name="l00973"></a>00973     <span class="keywordtype">double</span>  F, G, DFDPHI, RR4L42, DFDRHO, DFDX, CF, SF, YAS, ZAS, BX_AS1, BY_AS1, BZ_AS1;
<a name="l00974"></a>00974     <span class="keywordtype">double</span>  BX_AS2, BY_AS2, BZ_AS2, BRHO_AS, BPHI_AS, BRHO_S, BPHI_S;
<a name="l00975"></a>00975 
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     G = CB_G.<a class="code" href="struct___c_b___g.html#67783a2c4f670ee5a9dadcf428324d32">G</a>;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     DGDX  = 0.0;
<a name="l00980"></a>00980     XL    = 20.0;
<a name="l00981"></a>00981     DXLDX = 0.0;
<a name="l00982"></a>00982         
<a name="l00983"></a>00983     SPS  = sin( PS );
<a name="l00984"></a>00984     RHO2 = Y*Y+Z*Z;
<a name="l00985"></a>00985     RHO  = sqrt( RHO2 );
<a name="l00986"></a>00986         
<a name="l00987"></a>00987     <span class="keywordflow">if</span> ( (Y == 0.0) &amp;&amp; (Z == 0.0) ) {
<a name="l00988"></a>00988     PHI  = 0.0;
<a name="l00989"></a>00989     CPHI = 1.0;
<a name="l00990"></a>00990     SPHI = 0.0;
<a name="l00991"></a>00991     } <span class="keywordflow">else</span> {
<a name="l00992"></a>00992     PHI  = atan2( Z, Y );
<a name="l00993"></a>00993     CPHI = Y/RHO;
<a name="l00994"></a>00994     SPHI = Z/RHO;
<a name="l00995"></a>00995     }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997     XL2 = XL*XL; XL4 = XL2*XL2; XL3 = XL2*XL; RHO4 = RHO2*RHO2;
<a name="l00998"></a>00998     RR4L4 = RHO/(RHO4+XL4);
<a name="l00999"></a>00999  
<a name="l01000"></a>01000  
<a name="l01001"></a>01001     F      = PHI+G*RHO2*RR4L4*CPHI*SPS;
<a name="l01002"></a>01002     DFDPHI = 1.0-G*RHO2*RR4L4*SPHI*SPS;
<a name="l01003"></a>01003     RR4L42 = RR4L4*RR4L4;
<a name="l01004"></a>01004     DFDRHO = G*RR4L42*(3.0*XL4-RHO4)*CPHI*SPS;
<a name="l01005"></a>01005     DFDX   = RR4L4*CPHI*SPS*(DGDX*RHO2-G*RHO*RR4L4*4.0*XL3*DXLDX);
<a name="l01006"></a>01006  
<a name="l01007"></a>01007     CF  = cos(F);
<a name="l01008"></a>01008     SF  = sin(F);
<a name="l01009"></a>01009     YAS = RHO*CF;
<a name="l01010"></a>01010     ZAS = RHO*SF;
<a name="l01011"></a>01011  
<a name="l01012"></a>01012     <a class="code" href="_tsyg2004_8c.html#9114d15d3eb4beb81639e71c0b0235dd">UNWARPED</a>( IOPT, X, YAS, ZAS, &amp;BX_AS1, &amp;BY_AS1, &amp;BZ_AS1, &amp;BX_AS2, &amp;BY_AS2, &amp;BZ_AS2 );
<a name="l01013"></a>01013  
<a name="l01014"></a>01014     BRHO_AS  =   BY_AS1*CF+BZ_AS1*SF;       <span class="comment">//   DEFORM THE 1ST MODE</span>
<a name="l01015"></a>01015     BPHI_AS  =  -BY_AS1*SF+BZ_AS1*CF;
<a name="l01016"></a>01016  
<a name="l01017"></a>01017     BRHO_S  =  BRHO_AS*DFDPHI;
<a name="l01018"></a>01018     BPHI_S  =  BPHI_AS-RHO*(BX_AS1*DFDX+BRHO_AS*DFDRHO);
<a name="l01019"></a>01019     *BX1     =  BX_AS1*DFDPHI;
<a name="l01020"></a>01020  
<a name="l01021"></a>01021     *BY1     =  BRHO_S*CPHI-BPHI_S*SPHI;
<a name="l01022"></a>01022     *BZ1     =  BRHO_S*SPHI+BPHI_S*CPHI;        <span class="comment">//   DONE</span>
<a name="l01023"></a>01023  
<a name="l01024"></a>01024     BRHO_AS =   BY_AS2*CF+BZ_AS2*SF;        <span class="comment">//   DEFORM THE 2ND MODE</span>
<a name="l01025"></a>01025     BPHI_AS =  -BY_AS2*SF+BZ_AS2*CF;
<a name="l01026"></a>01026     
<a name="l01027"></a>01027     BRHO_S  =  BRHO_AS*DFDPHI;
<a name="l01028"></a>01028     BPHI_S  =  BPHI_AS-RHO*(BX_AS2*DFDX+BRHO_AS*DFDRHO);
<a name="l01029"></a>01029     *BX2     =  BX_AS2*DFDPHI;
<a name="l01030"></a>01030     
<a name="l01031"></a>01031     *BY2     = BRHO_S*CPHI-BPHI_S*SPHI;
<a name="l01032"></a>01032     *BZ2     = BRHO_S*SPHI+BPHI_S*CPHI;     <span class="comment">//   DONE</span>
<a name="l01033"></a>01033     
<a name="l01034"></a>01034     <span class="keywordflow">return</span>;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036 }
<a name="l01037"></a>01037 
<a name="l01038"></a>01038 
<a name="l01039"></a>01039 
<a name="l01040"></a>01040 
<a name="l01041"></a>01041 
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 
<a name="l01044"></a>01044 
<a name="l01045"></a>01045 
<a name="l01046"></a>01046 
<a name="l01047"></a>01047 
<a name="l01048"></a><a class="code" href="_tsyg2004_8c.html#9114d15d3eb4beb81639e71c0b0235dd">01048</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#9114d15d3eb4beb81639e71c0b0235dd">UNWARPED</a>( <span class="keywordtype">int</span> IOPT, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, 
<a name="l01049"></a>01049         <span class="keywordtype">double</span> *BX1, <span class="keywordtype">double</span> *BY1, <span class="keywordtype">double</span> *BZ1, <span class="keywordtype">double</span> *BX2, <span class="keywordtype">double</span> *BY2, <span class="keywordtype">double</span> *BZ2) {
<a name="l01050"></a>01050 
<a name="l01051"></a>01051     <span class="comment">/* </span>
<a name="l01052"></a>01052 <span class="comment">     *     IOPT - TAIL FIELD MODE FLAG:   IOPT=0 - THE TWO TAIL MODES ARE ADDED UP</span>
<a name="l01053"></a>01053 <span class="comment">     *                                    IOPT=1 - MODE 1 ONLY</span>
<a name="l01054"></a>01054 <span class="comment">     *                                    IOPT=2 - MODE 2 ONLY</span>
<a name="l01055"></a>01055 <span class="comment">     *  </span>
<a name="l01056"></a>01056 <span class="comment">     *      CALCULATES GSM COMPONENTS OF THE SHIELDED FIELD OF TWO TAIL MODES WITH UNIT</span>
<a name="l01057"></a>01057 <span class="comment">     *      AMPLITUDES,  WITHOUT ANY WARPING OR BENDING.  NONLINEAR PARAMETERS OF THE MODES</span>
<a name="l01058"></a>01058 <span class="comment">     *      ARE FORWARDED HERE VIA A COMMON BLOCK /TAIL/.</span>
<a name="l01059"></a>01059 <span class="comment">     *  </span>
<a name="l01060"></a>01060 <span class="comment">     */</span>
<a name="l01061"></a>01061 
<a name="l01062"></a>01062 
<a name="l01063"></a>01063         
<a name="l01064"></a>01064 <span class="comment">//      COMMON /TAIL/ DXSHIFT1,DXSHIFT2,D0,DELTADY  ! ATTENTION:  HERE D0 &amp; DELTADY ARE INCLUDED IN /TAIL/</span>
<a name="l01065"></a>01065 <span class="comment">//                                                                  AND EXCLUDED FROM DATA</span>
<a name="l01066"></a>01066 
<a name="l01067"></a>01067 
<a name="l01068"></a>01068     <span class="comment">// TAIL SHIELDING FIELD PARAMETERS FOR THE MODES #1 &amp; #2</span>
<a name="l01069"></a>01069     <span class="keywordtype">double</span>    DELTADX1=1.0, ALPHA1=1.1,  XSHIFT1=6.0;
<a name="l01070"></a>01070     <span class="keyword">static</span> <span class="keywordtype">double</span> A1[] = { -9e99, -25.45869857,57.35899080,317.5501869,-2.626756717,
<a name="l01071"></a>01071                       -93.38053698,-199.6467926,-858.8129729,34.09192395,845.4214929,
<a name="l01072"></a>01072                       -29.07463068,47.10678547,-128.9797943,-781.7512093,6.165038619,
<a name="l01073"></a>01073                       167.8905046,492.0680410,1654.724031,-46.77337920,-1635.922669,
<a name="l01074"></a>01074                       40.86186772,-.1349775602,-.9661991179E-01,-.1662302354,
<a name="l01075"></a>01075                       .002810467517,.2487355077,.1025565237,-14.41750229,-.8185333989,
<a name="l01076"></a>01076                       11.07693629,.7569503173,-9.655264745,112.2446542,777.5948964,
<a name="l01077"></a>01077                       -5.745008536,-83.03921993,-490.2278695,-1155.004209,39.08023320,
<a name="l01078"></a>01078                       1172.780574,-39.44349797,-14.07211198,-40.41201127,-313.2277343,
<a name="l01079"></a>01079                       2.203920979,8.232835341,197.7065115,391.2733948,-18.57424451,
<a name="l01080"></a>01080                       -437.2779053,23.04976898,11.75673963,13.60497313,4.691927060,
<a name="l01081"></a>01081                       18.20923547,27.59044809,6.677425469,1.398283308,2.839005878,
<a name="l01082"></a>01082                       31.24817706,24.53577264 };
<a name="l01083"></a>01083 
<a name="l01084"></a>01084     <span class="keywordtype">double</span>    DELTADX2=0.0, ALPHA2=0.25, XSHIFT2=4.0;
<a name="l01085"></a>01085     <span class="keyword">static</span> <span class="keywordtype">double</span> A2[] = { -9e99, -287187.1962,4970.499233,410490.1952,-1347.839052,
<a name="l01086"></a>01086                       -386370.3240,3317.983750,-143462.3895,5706.513767,171176.2904,
<a name="l01087"></a>01087                       250.8882750,-506570.8891,5733.592632,397975.5842,9771.762168,
<a name="l01088"></a>01088                       -941834.2436,7990.975260,54313.10318,447.5388060,528046.3449,
<a name="l01089"></a>01089                       12751.04453,-21920.98301,-21.05075617,31971.07875,3012.641612,
<a name="l01090"></a>01090                       -301822.9103,-3601.107387,1797.577552,-6.315855803,142578.8406,
<a name="l01091"></a>01091                       13161.93640,804184.8410,-14168.99698,-851926.6360,-1890.885671,
<a name="l01092"></a>01092                       972475.6869,-8571.862853,26432.49197,-2554.752298,-482308.3431,
<a name="l01093"></a>01093                       -4391.473324,105155.9160,-1134.622050,-74353.53091,-5382.670711,
<a name="l01094"></a>01094                       695055.0788,-916.3365144,-12111.06667,67.20923358,-367200.9285,
<a name="l01095"></a>01095                       -21414.14421,14.75567902,20.75638190,59.78601609,16.86431444,
<a name="l01096"></a>01096                       32.58482365,23.69472951,17.24977936,13.64902647,68.40989058,
<a name="l01097"></a>01097                       11.67828167 };
<a name="l01098"></a>01098 
<a name="l01099"></a>01099     <span class="keywordtype">double</span>  XM1=-12.0, XM2=-12.0;
<a name="l01100"></a>01100     <span class="keywordtype">double</span>  XSC1, YSC1, ZSC1, D0SC1, FX1, FY1, FZ1, HX1, HY1, HZ1;
<a name="l01101"></a>01101     <span class="keywordtype">double</span>  XSC2, YSC2, ZSC2, D0SC2, FX2, FY2, FZ2, HX2, HY2, HZ2;
<a name="l01102"></a>01102         
<a name="l01103"></a>01103     <span class="keywordflow">if</span> (IOPT != 2) {
<a name="l01104"></a>01104         
<a name="l01105"></a>01105     XSC1  = (X-XSHIFT1-CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#12fe869b3516cc1eb6b73890b20335bc">DXSHIFT1</a>)*ALPHA1-XM1*(ALPHA1-1.0);
<a name="l01106"></a>01106     YSC1  = Y*ALPHA1;
<a name="l01107"></a>01107     ZSC1  = Z*ALPHA1;
<a name="l01108"></a>01108     D0SC1 = CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#d8657a5ec76e12f3066fb4b4eb75ace9">D</a>*ALPHA1;       <span class="comment">// HERE WE USE A SINGLE VALUE D0 OF THE THICKNESS FOR BOTH MODES</span>
<a name="l01109"></a>01109         
<a name="l01110"></a>01110     <a class="code" href="_tsyg2004_8c.html#81b0851907208b45c9721ef40e1e37a3">TAILDISK</a>( D0SC1, DELTADX1, CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#cf76b5500556d063c5d6cec9508879f6">DELTADY</a>, XSC1, YSC1, ZSC1, &amp;FX1, &amp;FY1, &amp;FZ1 );
<a name="l01111"></a>01111     <a class="code" href="_tsyg2004_8c.html#d52c3a08bf2c11b9784a6ce1eb480fed">SHLCAR5X5</a>( A1, X, Y, Z, CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#12fe869b3516cc1eb6b73890b20335bc">DXSHIFT1</a>, &amp;HX1, &amp;HY1, &amp;HZ1 );
<a name="l01112"></a>01112         
<a name="l01113"></a>01113     *BX1 = FX1 + HX1;
<a name="l01114"></a>01114     *BY1 = FY1 + HY1;
<a name="l01115"></a>01115     *BZ1 = FZ1 + HZ1;
<a name="l01116"></a>01116         
<a name="l01117"></a>01117     <span class="keywordflow">if</span> (IOPT == 1) {
<a name="l01118"></a>01118             *BX2 = 0.0;
<a name="l01119"></a>01119             *BY2 = 0.0;
<a name="l01120"></a>01120             *BZ2 = 0.0;
<a name="l01121"></a>01121             <span class="keywordflow">return</span>;
<a name="l01122"></a>01122     }
<a name="l01123"></a>01123 
<a name="l01124"></a>01124     }
<a name="l01125"></a>01125         
<a name="l01126"></a>01126     XSC2  = (X-XSHIFT2-CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#5947c5dfec8ec63b76f2a46d1719af3c">DXSHIFT2</a>)*ALPHA2-XM2*(ALPHA2-1.0);
<a name="l01127"></a>01127     YSC2  = Y*ALPHA2;
<a name="l01128"></a>01128     ZSC2  = Z*ALPHA2;
<a name="l01129"></a>01129     D0SC2 = CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#d8657a5ec76e12f3066fb4b4eb75ace9">D</a>*ALPHA2;           <span class="comment">// HERE WE USE A SINGLE VALUE D0 OF THE THICKNESS FOR BOTH MODES</span>
<a name="l01130"></a>01130 
<a name="l01131"></a>01131 
<a name="l01132"></a>01132     <a class="code" href="_tsyg2004_8c.html#81b0851907208b45c9721ef40e1e37a3">TAILDISK</a>( D0SC2, DELTADX2, CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#cf76b5500556d063c5d6cec9508879f6">DELTADY</a>, XSC2, YSC2, ZSC2, &amp;FX2, &amp;FY2, &amp;FZ2);
<a name="l01133"></a>01133     <a class="code" href="_tsyg2004_8c.html#d52c3a08bf2c11b9784a6ce1eb480fed">SHLCAR5X5</a>( A2, X, Y, Z, CB_TAIL.<a class="code" href="struct___c_b___t_a_i_l.html#5947c5dfec8ec63b76f2a46d1719af3c">DXSHIFT2</a>, &amp;HX2, &amp;HY2, &amp;HZ2);
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     *BX2 = FX2 + HX2;
<a name="l01136"></a>01136     *BY2 = FY2 + HY2;
<a name="l01137"></a>01137     *BZ2 = FZ2 + HZ2;
<a name="l01138"></a>01138 
<a name="l01139"></a>01139     <span class="keywordflow">if</span> (IOPT == 2) {
<a name="l01140"></a>01140     *BX1 = 0.0;
<a name="l01141"></a>01141     *BY1 = 0.0;
<a name="l01142"></a>01142     *BZ1 = 0.0;
<a name="l01143"></a>01143     }
<a name="l01144"></a>01144 
<a name="l01145"></a>01145     <span class="keywordflow">return</span>;
<a name="l01146"></a>01146 
<a name="l01147"></a>01147 }
<a name="l01148"></a>01148 
<a name="l01149"></a>01149 
<a name="l01150"></a><a class="code" href="_tsyg2004_8c.html#81b0851907208b45c9721ef40e1e37a3">01150</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#81b0851907208b45c9721ef40e1e37a3">TAILDISK</a>( <span class="keywordtype">double</span> D0, <span class="keywordtype">double</span> DELTADX, <span class="keywordtype">double</span> DELTADY, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ) {
<a name="l01151"></a>01151 
<a name="l01152"></a>01152     <span class="comment">/*</span>
<a name="l01153"></a>01153 <span class="comment">     *        THIS SUBROUTINE COMPUTES THE COMPONENTS OF THE TAIL CURRENT FIELD,</span>
<a name="l01154"></a>01154 <span class="comment">     *         SIMILAR TO THAT DESCRIBED BY TSYGANENKO AND PEREDO (1994).  THE</span>
<a name="l01155"></a>01155 <span class="comment">     *          DIFFERENCE IS THAT NOW WE USE SPACEWARPING, AS DESCRIBED IN OUR</span>
<a name="l01156"></a>01156 <span class="comment">     *           PAPER ON MODELING BIRKELAND CURRENTS (TSYGANENKO AND STERN, 1996)</span>
<a name="l01157"></a>01157 <span class="comment">     *            INSTEAD OF SHEARING IT IN THE SPIRIT OF T89 TAIL MODEL.</span>
<a name="l01158"></a>01158 <span class="comment">     */</span>
<a name="l01159"></a>01159 
<a name="l01160"></a>01160     <span class="keyword">static</span> <span class="keywordtype">double</span>   F[] = { -9e99, -71.09346626, -1014.308601, -1272.939359, -3224.935936, -44546.86232 };
<a name="l01161"></a>01161     <span class="keyword">static</span> <span class="keywordtype">double</span>   B[] = { -9e99, 10.90101242, 12.68393898, 13.51791954, 14.86775017, 15.12306404 };
<a name="l01162"></a>01162     <span class="keyword">static</span> <span class="keywordtype">double</span>   C[] = { -9e99, .7954069972, .6716601849, 1.174866319, 2.565249920, 10.01986790 };
<a name="l01163"></a>01163     <span class="keywordtype">double</span>      Y2, RHO, DRHODX, DRHODY, ooSeven, DEX, D, DDDY, DDDX, DZETA, ooDZETA, DDZETADX, DDZETADY, DDZETADZ;
<a name="l01164"></a>01164     <span class="keywordtype">double</span>      DBX, CI, RHOpBI, BI, RHOpBI2, RHOmBI, RHOmBI2, DZETApCI, DZETApCI2, S1, S2, ooS1, ooS2;
<a name="l01165"></a>01165     <span class="keywordtype">double</span>      DS1DRHO, DS2DRHO, DS1DDZ, DS2DDZ, DS1DX, DS1DY, DS1DZ, DS2DX, DS2DY, DS2DZ, S1TS2, S1PS2, S1PS2SQ;
<a name="l01166"></a>01166     <span class="keywordtype">double</span>      BI2, FAC1, AS, DASDS1, DASDS2, DASDX, DASDY, DASDZ, DBY, DBZ;
<a name="l01167"></a>01167     <span class="keywordtype">int</span>         I;
<a name="l01168"></a>01168 
<a name="l01169"></a>01169 
<a name="l01170"></a>01170     Y2 = Y*Y;
<a name="l01171"></a>01171     RHO    = sqrt(X*X+Y2);
<a name="l01172"></a>01172     DRHODX = X/RHO;
<a name="l01173"></a>01173     DRHODY = Y/RHO;
<a name="l01174"></a>01174 
<a name="l01175"></a>01175     ooSeven = 1.0/7.0;
<a name="l01176"></a>01176 
<a name="l01177"></a>01177     DEX  = exp(X*ooSeven);
<a name="l01178"></a>01178     D    = D0+DELTADY*0.0025*Y2  + DELTADX*DEX;     <span class="comment">// THE LAST TERM (INTRODUCED 10/11/2000) MAKES THE SHEET</span>
<a name="l01179"></a>01179     DDDY = DELTADY*Y*0.005;             <span class="comment">// THICKEN SUNWARD, TO AVOID PROBLEMS IN THE SUBSOLAR REGION</span>
<a name="l01180"></a>01180     DDDX = DELTADX*ooSeven*DEX;
<a name="l01181"></a>01181  
<a name="l01182"></a>01182     DZETA    = sqrt(Z*Z+D*D);               <span class="comment">// THIS IS THE SAME SIMPLE WAY TO SPREAD OUT THE SHEET, AS THAT USED IN T89</span>
<a name="l01183"></a>01183     ooDZETA = 1.0/DZETA;
<a name="l01184"></a>01184     DDZETADX = D*DDDX*ooDZETA;
<a name="l01185"></a>01185     DDZETADY = D*DDDY*ooDZETA;
<a name="l01186"></a>01186     DDZETADZ = Z*ooDZETA;
<a name="l01187"></a>01187 
<a name="l01188"></a>01188     DBX = 0.0;
<a name="l01189"></a>01189     DBY = 0.0;
<a name="l01190"></a>01190     DBZ = 0.0;
<a name="l01191"></a>01191  
<a name="l01192"></a>01192     <span class="keywordflow">for</span> ( I=1; I&lt;=5; I++ ){
<a name="l01193"></a>01193  
<a name="l01194"></a>01194     BI = B[I];
<a name="l01195"></a>01195     CI = C[I];
<a name="l01196"></a>01196  
<a name="l01197"></a>01197     RHOpBI = RHO+BI; RHOpBI2 = RHOpBI*RHOpBI;
<a name="l01198"></a>01198     RHOmBI = RHO-BI; RHOmBI2 = RHOmBI*RHOmBI;
<a name="l01199"></a>01199     DZETApCI = DZETA+CI; DZETApCI2 = DZETApCI*DZETApCI;
<a name="l01200"></a>01200     S1 = sqrt(RHOpBI2+DZETApCI2);
<a name="l01201"></a>01201     S2 = sqrt(RHOmBI2+DZETApCI2);
<a name="l01202"></a>01202 
<a name="l01203"></a>01203     ooS1 = 1.0/S1; ooS2 = 1.0/S2;
<a name="l01204"></a>01204     DS1DRHO = RHOpBI*ooS1;
<a name="l01205"></a>01205     DS2DRHO = RHOmBI*ooS2;
<a name="l01206"></a>01206     DS1DDZ  = DZETApCI*ooS1;
<a name="l01207"></a>01207     DS2DDZ  = DZETApCI*ooS2;
<a name="l01208"></a>01208  
<a name="l01209"></a>01209     DS1DX = DS1DRHO*DRHODX  + DS1DDZ*DDZETADX;
<a name="l01210"></a>01210     DS1DY = DS1DRHO*DRHODY  + DS1DDZ*DDZETADY;
<a name="l01211"></a>01211     DS1DZ =                   DS1DDZ*DDZETADZ;
<a name="l01212"></a>01212  
<a name="l01213"></a>01213     DS2DX = DS2DRHO*DRHODX  + DS2DDZ*DDZETADX;
<a name="l01214"></a>01214     DS2DY = DS2DRHO*DRHODY  + DS2DDZ*DDZETADY;
<a name="l01215"></a>01215     DS2DZ =                   DS2DDZ*DDZETADZ;
<a name="l01216"></a>01216  
<a name="l01217"></a>01217     S1TS2   = S1*S2;
<a name="l01218"></a>01218     S1PS2   = S1+S2;
<a name="l01219"></a>01219     S1PS2SQ = S1PS2*S1PS2;
<a name="l01220"></a>01220 
<a name="l01221"></a>01221     BI2 = BI*BI;
<a name="l01222"></a>01222     FAC1   = sqrt(S1PS2SQ-4.0*BI2);
<a name="l01223"></a>01223     AS     = FAC1/(S1TS2*S1PS2SQ);
<a name="l01224"></a>01224     DASDS1 = (1.0/(FAC1*S2)-AS/S1PS2*(S2*S2+S1*(3.0*S1+4.0*S2))) /(S1*S1PS2);
<a name="l01225"></a>01225     DASDS2 = (1.0/(FAC1*S1)-AS/S1PS2*(S1*S1+S2*(3.0*S2+4.0*S1))) /(S2*S1PS2);
<a name="l01226"></a>01226  
<a name="l01227"></a>01227     DASDX = DASDS1*DS1DX + DASDS2*DS2DX;
<a name="l01228"></a>01228     DASDY = DASDS1*DS1DY + DASDS2*DS2DY;
<a name="l01229"></a>01229     DASDZ = DASDS1*DS1DZ + DASDS2*DS2DZ;
<a name="l01230"></a>01230  
<a name="l01231"></a>01231     DBX = DBX - F[I]*X*DASDZ;
<a name="l01232"></a>01232     DBY = DBY - F[I]*Y*DASDZ;
<a name="l01233"></a>01233     DBZ = DBZ + F[I]*(2.0*AS+X*DASDX+Y*DASDY);
<a name="l01234"></a>01234 
<a name="l01235"></a>01235     }
<a name="l01236"></a>01236         
<a name="l01237"></a>01237     *BX = DBX;
<a name="l01238"></a>01238     *BY = DBY;
<a name="l01239"></a>01239     *BZ = DBZ;
<a name="l01240"></a>01240         
<a name="l01241"></a>01241     <span class="keywordflow">return</span>;
<a name="l01242"></a>01242 
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 }
<a name="l01245"></a>01245 
<a name="l01246"></a>01246 
<a name="l01247"></a>01247 
<a name="l01248"></a>01248 
<a name="l01249"></a><a class="code" href="_tsyg2004_8c.html#d52c3a08bf2c11b9784a6ce1eb480fed">01249</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#d52c3a08bf2c11b9784a6ce1eb480fed">SHLCAR5X5</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> DSHIFT, <span class="keywordtype">double</span> *HX, <span class="keywordtype">double</span> *HY, <span class="keywordtype">double</span> *HZ ) {
<a name="l01250"></a>01250 
<a name="l01251"></a>01251     <span class="comment">/* </span>
<a name="l01252"></a>01252 <span class="comment">     * </span>
<a name="l01253"></a>01253 <span class="comment">     *  THIS CODE RETURNS THE SHIELDING FIELD REPRESENTED BY  5x5=25 "CARTESIAN"</span>
<a name="l01254"></a>01254 <span class="comment">     *     HARMONICS</span>
<a name="l01255"></a>01255 <span class="comment">     * </span>
<a name="l01256"></a>01256 <span class="comment">     * </span>
<a name="l01257"></a>01257 <span class="comment">     *  - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<a name="l01258"></a>01258 <span class="comment">     *   The NLIN coefficients are the amplitudes of the "cartesian"</span>
<a name="l01259"></a>01259 <span class="comment">     *     harmonics (A(1)-A(NLIN).</span>
<a name="l01260"></a>01260 <span class="comment">     *   The NNP nonlinear parameters (A(NLIN+1)-A(NTOT) are the scales Pi and Ri</span>
<a name="l01261"></a>01261 <span class="comment">     *    entering the arguments of exponents, sines, and cosines in each of the</span>
<a name="l01262"></a>01262 <span class="comment">     *    NLIN "Cartesian" harmonics</span>
<a name="l01263"></a>01263 <span class="comment">     *  - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<a name="l01264"></a>01264 <span class="comment">     */</span>
<a name="l01265"></a>01265 
<a name="l01266"></a>01266     <span class="keywordtype">int</span>     I, K, L;
<a name="l01267"></a>01267     <span class="keywordtype">double</span>  DHX, DHY, DHZ, RP, RP2, YRP, CYPI, SYPI, RR, RR2;
<a name="l01268"></a>01268     <span class="keywordtype">double</span>  SZRK, CZRK, SQPR, EPR, DBX, DBY, DBZ, COEF;
<a name="l01269"></a>01269 
<a name="l01270"></a>01270     DHX = 0.0;
<a name="l01271"></a>01271     DHY = 0.0;
<a name="l01272"></a>01272     DHZ = 0.0;
<a name="l01273"></a>01273 
<a name="l01274"></a>01274     L = 0;
<a name="l01275"></a>01275  
<a name="l01276"></a>01276     <span class="keywordflow">for</span> ( I=1; I&lt;=5; I++ ) {
<a name="l01277"></a>01277 
<a name="l01278"></a>01278     RP   = 1.0/A[50+I];   <span class="comment">// we could get rid of these divides by hand computing the inverse cooeffs...</span>
<a name="l01279"></a>01279     RP2 = RP*RP;
<a name="l01280"></a>01280     YRP = Y*RP;
<a name="l01281"></a>01281     CYPI = cos(YRP);
<a name="l01282"></a>01282     SYPI = sin(YRP);
<a name="l01283"></a>01283     
<a name="l01284"></a>01284         <span class="keywordflow">for</span> ( K=1; K&lt;=5; K++ ) {
<a name="l01285"></a>01285 
<a name="l01286"></a>01286         RR   = 1.0/A[55+K];   <span class="comment">// we could get rid of these divides by hand computing the inverse cooeffs...</span>
<a name="l01287"></a>01287         RR2  = RR*RR;
<a name="l01288"></a>01288         SZRK = sin(Z*RR);
<a name="l01289"></a>01289         CZRK = cos(Z*RR);
<a name="l01290"></a>01290         SQPR = sqrt(RP2+RR2);
<a name="l01291"></a>01291         EPR  = exp(X*SQPR);
<a name="l01292"></a>01292     
<a name="l01293"></a>01293         DBX = -SQPR*EPR*CYPI*SZRK;
<a name="l01294"></a>01294         DBY =  RP*EPR*SYPI*SZRK;
<a name="l01295"></a>01295         DBZ = -RR*EPR*CYPI*CZRK;
<a name="l01296"></a>01296     
<a name="l01297"></a>01297         L += 2;
<a name="l01298"></a>01298         COEF = A[L-1]+A[L]*DSHIFT;
<a name="l01299"></a>01299     
<a name="l01300"></a>01300         DHX = DHX+COEF*DBX;
<a name="l01301"></a>01301         DHY = DHY+COEF*DBY;
<a name="l01302"></a>01302         DHZ = DHZ+COEF*DBZ;
<a name="l01303"></a>01303 
<a name="l01304"></a>01304     }
<a name="l01305"></a>01305     }
<a name="l01306"></a>01306  
<a name="l01307"></a>01307 
<a name="l01308"></a>01308     *HX = DHX;
<a name="l01309"></a>01309     *HY = DHY;
<a name="l01310"></a>01310     *HZ = DHZ;
<a name="l01311"></a>01311 
<a name="l01312"></a>01312  
<a name="l01313"></a>01313     <span class="keywordflow">return</span>;
<a name="l01314"></a>01314 
<a name="l01315"></a>01315 }
<a name="l01316"></a>01316 
<a name="l01317"></a>01317 
<a name="l01318"></a>01318 
<a name="l01319"></a><a class="code" href="_tsyg2004_8c.html#a448f7ca5c043203dab6208c5c982571">01319</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#a448f7ca5c043203dab6208c5c982571">BIRK_TOT</a>( <span class="keywordtype">int</span> IOPB, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z,
<a name="l01320"></a>01320         <span class="keywordtype">double</span> *BX11, <span class="keywordtype">double</span> *BY11, <span class="keywordtype">double</span> *BZ11, <span class="keywordtype">double</span> *BX12, <span class="keywordtype">double</span> *BY12, <span class="keywordtype">double</span> *BZ12,
<a name="l01321"></a>01321         <span class="keywordtype">double</span> *BX21, <span class="keywordtype">double</span> *BY21, <span class="keywordtype">double</span> *BZ21, <span class="keywordtype">double</span> *BX22, <span class="keywordtype">double</span> *BY22, <span class="keywordtype">double</span> *BZ22){
<a name="l01322"></a>01322 
<a name="l01323"></a>01323     <span class="comment">/*  </span>
<a name="l01324"></a>01324 <span class="comment">     *  </span>
<a name="l01325"></a>01325 <span class="comment">     *  </span>
<a name="l01326"></a>01326 <span class="comment">     *        IOPB -  BIRKELAND FIELD MODE FLAG:</span>
<a name="l01327"></a>01327 <span class="comment">     *           IOPB=0 - ALL COMPONENTS</span>
<a name="l01328"></a>01328 <span class="comment">     *           IOPB=1 - REGION 1, MODES 1 &amp; 2</span>
<a name="l01329"></a>01329 <span class="comment">     *           IOPB=2 - REGION 2, MODES 1 &amp; 2</span>
<a name="l01330"></a>01330 <span class="comment">     */</span> 
<a name="l01331"></a>01331 
<a name="l01332"></a>01332         
<a name="l01333"></a>01333     <span class="keyword">static</span> <span class="keywordtype">double</span> SH11[] = { -9e99, 46488.84663,-15541.95244,-23210.09824,-32625.03856,
<a name="l01334"></a>01334                     -109894.4551,-71415.32808,58168.94612,55564.87578,-22890.60626,
<a name="l01335"></a>01335                         -6056.763968,5091.368100,239.7001538,-13899.49253,4648.016991,
<a name="l01336"></a>01336                         6971.310672,9699.351891,32633.34599,21028.48811,-17395.96190,
<a name="l01337"></a>01337                         -16461.11037,7447.621471,2528.844345,-1934.094784,-588.3108359,
<a name="l01338"></a>01338                         -32588.88216,10894.11453,16238.25044,22925.60557,77251.11274,
<a name="l01339"></a>01339                         50375.97787,-40763.78048,-39088.60660,15546.53559,3559.617561,
<a name="l01340"></a>01340                         -3187.730438,309.1487975,88.22153914,-243.0721938,-63.63543051,
<a name="l01341"></a>01341                         191.1109142,69.94451996,-187.9539415,-49.89923833,104.0902848,
<a name="l01342"></a>01342                         -120.2459738,253.5572433,89.25456949,-205.6516252,-44.93654156,
<a name="l01343"></a>01343                         124.7026309,32.53005523,-98.85321751,-36.51904756,98.88241690,
<a name="l01344"></a>01344                         24.88493459,-55.04058524,61.14493565,-128.4224895,-45.35023460,
<a name="l01345"></a>01345                         105.0548704,-43.66748755,119.3284161,31.38442798,-92.87946767,
<a name="l01346"></a>01346                         -33.52716686,89.98992001,25.87341323,-48.86305045,59.69362881,
<a name="l01347"></a>01347                         -126.5353789,-44.39474251,101.5196856,59.41537992,41.18892281,
<a name="l01348"></a>01348                         80.86101200,3.066809418,7.893523804,30.56212082,10.36861082,
<a name="l01349"></a>01349                         8.222335945,19.97575641,2.050148531,4.992657093,2.300564232,
<a name="l01350"></a>01350                         .2256245602,-.05841594319 };
<a name="l01351"></a>01351         
<a name="l01352"></a>01352     <span class="keyword">static</span> <span class="keywordtype">double</span> SH12[] = { -9e99, 210260.4816,-1443587.401,-1468919.281,281939.2993,
<a name="l01353"></a>01353                         -1131124.839,729331.7943,2573541.307,304616.7457,468887.5847,
<a name="l01354"></a>01354                         181554.7517,-1300722.650,-257012.8601,645888.8041,-2048126.412,
<a name="l01355"></a>01355                         -2529093.041,571093.7972,-2115508.353,1122035.951,4489168.802,
<a name="l01356"></a>01356                         75234.22743,823905.6909,147926.6121,-2276322.876,-155528.5992,
<a name="l01357"></a>01357                         -858076.2979,3474422.388,3986279.931,-834613.9747,3250625.781,
<a name="l01358"></a>01358                         -1818680.377,-7040468.986,-414359.6073,-1295117.666,-346320.6487,
<a name="l01359"></a>01359                         3565527.409,430091.9496,-.1565573462,7.377619826,.4115646037,
<a name="l01360"></a>01360                         -6.146078880,3.808028815,-.5232034932,1.454841807,-12.32274869,
<a name="l01361"></a>01361                         -4.466974237,-2.941184626,-.6172620658,12.64613490,1.494922012,
<a name="l01362"></a>01362                         -21.35489898,-1.652256960,16.81799898,-1.404079922,-24.09369677,
<a name="l01363"></a>01363                         -10.99900839,45.94237820,2.248579894,31.91234041,7.575026816,
<a name="l01364"></a>01364                         -45.80833339,-1.507664976,14.60016998,1.348516288,-11.05980247,
<a name="l01365"></a>01365                         -5.402866968,31.69094514,12.28261196,-37.55354174,4.155626879,
<a name="l01366"></a>01366                         -33.70159657,-8.437907434,36.22672602,145.0262164,70.73187036,
<a name="l01367"></a>01367                         85.51110098,21.47490989,24.34554406,31.34405345,4.655207476,
<a name="l01368"></a>01368                         5.747889264,7.802304187,1.844169801,4.867254550,2.941393119,
<a name="l01369"></a>01369                         .1379899178,.06607020029 };
<a name="l01370"></a>01370         
<a name="l01371"></a>01371     <span class="keyword">static</span> <span class="keywordtype">double</span> SH21[] = { -9e99, 162294.6224,503885.1125,-27057.67122,-531450.1339,
<a name="l01372"></a>01372                         84747.05678,-237142.1712,84133.61490,259530.0402,69196.05160,
<a name="l01373"></a>01373                         -189093.5264,-19278.55134,195724.5034,-263082.6367,-818899.6923,
<a name="l01374"></a>01374                         43061.10073,863506.6932,-139707.9428,389984.8850,-135167.5555,
<a name="l01375"></a>01375                         -426286.9206,-109504.0387,295258.3531,30415.07087,-305502.9405,
<a name="l01376"></a>01376                         100785.3400,315010.9567,-15999.50673,-332052.2548,54964.34639,
<a name="l01377"></a>01377                         -152808.3750,51024.67566,166720.0603,40389.67945,-106257.7272,
<a name="l01378"></a>01378                         -11126.14442,109876.2047,2.978695024,558.6019011,2.685592939,
<a name="l01379"></a>01379                         -338.0004730,-81.99724090,-444.1102659,89.44617716,212.0849592,
<a name="l01380"></a>01380                         -32.58562625,-982.7336105,-35.10860935,567.8931751,-1.917212423,
<a name="l01381"></a>01381                         -260.2023543,-1.023821735,157.5533477,23.00200055,232.0603673,
<a name="l01382"></a>01382                         -36.79100036,-111.9110936,18.05429984,447.0481000,15.10187415,
<a name="l01383"></a>01383                         -258.7297813,-1.032340149,-298.6402478,-1.676201415,180.5856487,
<a name="l01384"></a>01384                         64.52313024,209.0160857,-53.85574010,-98.52164290,14.35891214,
<a name="l01385"></a>01385                         536.7666279,20.09318806,-309.7349530,58.54144539,67.45226850,
<a name="l01386"></a>01386                         97.92374406,4.752449760,10.46824379,32.91856110,12.05124381,
<a name="l01387"></a>01387                         9.962933904,15.91258637,1.804233877,6.578149088,2.515223491,
<a name="l01388"></a>01388                         .1930034238,-.02261109942 };
<a name="l01389"></a>01389         
<a name="l01390"></a>01390     <span class="keyword">static</span> <span class="keywordtype">double</span> SH22[] = { -9e99, -131287.8986,-631927.6885,-318797.4173,616785.8782,
<a name="l01391"></a>01391                         -50027.36189,863099.9833,47680.20240,-1053367.944,-501120.3811,
<a name="l01392"></a>01392                         -174400.9476,222328.6873,333551.7374,-389338.7841,-1995527.467,
<a name="l01393"></a>01393                         -982971.3024,1960434.268,297239.7137,2676525.168,-147113.4775,
<a name="l01394"></a>01394                         -3358059.979,-2106979.191,-462827.1322,1017607.960,1039018.475,
<a name="l01395"></a>01395                         520266.9296,2627427.473,1301981.763,-2577171.706,-238071.9956,
<a name="l01396"></a>01396                         -3539781.111,94628.16420,4411304.724,2598205.733,637504.9351,
<a name="l01397"></a>01397                         -1234794.298,-1372562.403,-2.646186796,-31.10055575,2.295799273,
<a name="l01398"></a>01398                         19.20203279,30.01931202,-302.1028550,-14.78310655,162.1561899,
<a name="l01399"></a>01399                         .4943938056,176.8089129,-.2444921680,-100.6148929,9.172262228,
<a name="l01400"></a>01400                         137.4303440,-8.451613443,-84.20684224,-167.3354083,1321.830393,
<a name="l01401"></a>01401                         76.89928813,-705.7586223,18.28186732,-770.1665162,-9.084224422,
<a name="l01402"></a>01402                         436.3368157,-6.374255638,-107.2730177,6.080451222,65.53843753,
<a name="l01403"></a>01403                         143.2872994,-1028.009017,-64.22739330,547.8536586,-20.58928632,
<a name="l01404"></a>01404                         597.3893669,10.17964133,-337.7800252,159.3532209,76.34445954,
<a name="l01405"></a>01405                         84.74398828,12.76722651,27.63870691,32.69873634,5.145153451,
<a name="l01406"></a>01406                         6.310949163,6.996159733,1.971629939,4.436299219,2.904964304,
<a name="l01407"></a>01407                         .1486276863,.06859991529 };
<a name="l01408"></a>01408 
<a name="l01409"></a>01409 <span class="comment">//    double        XKAPPA;</span>
<a name="l01410"></a>01410     <span class="keywordtype">double</span>      X_SC, FX11, FY11, FZ11, HX11, HY11, HZ11, FX12, FY12, FZ12, HX12, HY12, HZ12;
<a name="l01411"></a>01411     <span class="keywordtype">double</span>      FX21, FY21, FZ21, HX21, HY21, HZ21, FX22, FY22, FZ22, HX22, HY22, HZ22;
<a name="l01412"></a>01412     <span class="keyword">static</span> <span class="keywordtype">double</span>   OLD_PS=-9e99, OLD_X=-9e99, OLD_Y=-9e99, OLD_Z=-9e99;
<a name="l01413"></a>01413     <span class="keywordtype">int</span>         PSChanged, XChanged, YChanged, ZChanged;
<a name="l01414"></a>01414 
<a name="l01415"></a>01415 <span class="comment">// Not thread-safe?</span>
<a name="l01416"></a>01416     PSChanged = ( fabs(PS-OLD_PS) &gt; 1e-10 ) ? <a class="code" href="_lgm___c_trans_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01417"></a>01417     XChanged = ( fabs(X-OLD_X) &gt; 1e-10 ) ? <a class="code" href="_lgm___c_trans_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01418"></a>01418     YChanged = ( fabs(Y-OLD_Y) &gt; 1e-10 ) ? <a class="code" href="_lgm___c_trans_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01419"></a>01419     ZChanged = ( fabs(Z-OLD_Z) &gt; 1e-10 ) ? <a class="code" href="_lgm___c_trans_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421     CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#c47e67864f6ce1555c7fbb0ca0429a1b">XKAPPA</a> = CB_BIRKPAR.<a class="code" href="struct___c_b___b_i_r_k_p_a_r.html#09d632f8debd75ca49c99493f5f7be3d">XKAPPA1</a>;     <span class="comment">// FORWARDED IN BIRK_1N2</span>
<a name="l01422"></a>01422     X_SC   = CB_BIRKPAR.<a class="code" href="struct___c_b___b_i_r_k_p_a_r.html#09d632f8debd75ca49c99493f5f7be3d">XKAPPA1</a>-1.1;    <span class="comment">// FORWARDED IN BIRK_SHL</span>
<a name="l01423"></a>01423         
<a name="l01424"></a>01424     <span class="keywordflow">if</span> ( (IOPB == 0) || (IOPB == 1) ) {
<a name="l01425"></a>01425         
<a name="l01426"></a>01426     <a class="code" href="_tsyg2004_8c.html#05b3a8c8d1e1b62725abe895df3d1ca1">BIRK_1N2</a>( 1, 1, PS, X, Y, Z, &amp;FX11, &amp;FY11, &amp;FZ11 );     <span class="comment">// REGION 1,  MODE 1</span>
<a name="l01427"></a>01427     <a class="code" href="_tsyg2004_8c.html#723d4ced4ac10c32344d63bda6126fdf">BIRK_SHL</a>( 0, PSChanged, XChanged, YChanged, ZChanged, SH11, PS, X_SC, X, Y, Z, &amp;HX11, &amp;HY11, &amp;HZ11 );
<a name="l01428"></a>01428     *BX11 = FX11 + HX11;
<a name="l01429"></a>01429     *BY11 = FY11 + HY11;
<a name="l01430"></a>01430     *BZ11 = FZ11 + HZ11;
<a name="l01431"></a>01431         
<a name="l01432"></a>01432     <a class="code" href="_tsyg2004_8c.html#05b3a8c8d1e1b62725abe895df3d1ca1">BIRK_1N2</a>( 1, 2, PS, X, Y, Z, &amp;FX12, &amp;FY12, &amp;FZ12 );     <span class="comment">// REGION 1,  MODE 2</span>
<a name="l01433"></a>01433     <a class="code" href="_tsyg2004_8c.html#723d4ced4ac10c32344d63bda6126fdf">BIRK_SHL</a>( 1, PSChanged, XChanged, YChanged, ZChanged, SH12, PS, X_SC, X, Y, Z, &amp;HX12, &amp;HY12, &amp;HZ12 );
<a name="l01434"></a>01434     *BX12 = FX12 + HX12;
<a name="l01435"></a>01435     *BY12 = FY12 + HY12;
<a name="l01436"></a>01436     *BZ12 = FZ12 + HZ12;
<a name="l01437"></a>01437         
<a name="l01438"></a>01438     }
<a name="l01439"></a>01439         
<a name="l01440"></a>01440     CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#c47e67864f6ce1555c7fbb0ca0429a1b">XKAPPA</a> = CB_BIRKPAR.<a class="code" href="struct___c_b___b_i_r_k_p_a_r.html#7939266cf05911b5c6f6e46e4e09e87c">XKAPPA2</a>;     <span class="comment">// FORWARDED IN BIRK_1N2</span>
<a name="l01441"></a>01441     X_SC   = CB_BIRKPAR.<a class="code" href="struct___c_b___b_i_r_k_p_a_r.html#7939266cf05911b5c6f6e46e4e09e87c">XKAPPA2</a>-1.0;    <span class="comment">// FORWARDED IN BIRK_SHL</span>
<a name="l01442"></a>01442         
<a name="l01443"></a>01443     <span class="keywordflow">if</span> ( (IOPB == 0)  || (IOPB == 2) ) {
<a name="l01444"></a>01444 
<a name="l01445"></a>01445     <a class="code" href="_tsyg2004_8c.html#05b3a8c8d1e1b62725abe895df3d1ca1">BIRK_1N2</a>( 2, 1, PS, X, Y, Z, &amp;FX21, &amp;FY21, &amp;FZ21 );     <span class="comment">// REGION 2,  MODE 1</span>
<a name="l01446"></a>01446     <a class="code" href="_tsyg2004_8c.html#723d4ced4ac10c32344d63bda6126fdf">BIRK_SHL</a>( 2, PSChanged, XChanged, YChanged, ZChanged, SH21, PS, X_SC, X, Y, Z, &amp;HX21, &amp;HY21, &amp;HZ21 );
<a name="l01447"></a>01447     *BX21 = FX21 + HX21;
<a name="l01448"></a>01448     *BY21 = FY21 + HY21;
<a name="l01449"></a>01449     *BZ21 = FZ21 + HZ21;
<a name="l01450"></a>01450  
<a name="l01451"></a>01451     <a class="code" href="_tsyg2004_8c.html#05b3a8c8d1e1b62725abe895df3d1ca1">BIRK_1N2</a>( 2, 2, PS, X, Y, Z, &amp;FX22, &amp;FY22, &amp;FZ22 );     <span class="comment">// REGION 2,  MODE 2</span>
<a name="l01452"></a>01452     <a class="code" href="_tsyg2004_8c.html#723d4ced4ac10c32344d63bda6126fdf">BIRK_SHL</a>( 3, PSChanged, XChanged, YChanged, ZChanged, SH22, PS, X_SC, X, Y, Z, &amp;HX22, &amp;HY22, &amp;HZ22 );
<a name="l01453"></a>01453     *BX22 = FX22 + HX22;
<a name="l01454"></a>01454     *BY22 = FY22 + HY22;
<a name="l01455"></a>01455     *BZ22 = FZ22 + HZ22;
<a name="l01456"></a>01456 
<a name="l01457"></a>01457     }
<a name="l01458"></a>01458 
<a name="l01459"></a>01459     OLD_PS = PS;
<a name="l01460"></a>01460     OLD_X = X;
<a name="l01461"></a>01461     OLD_Y = Y;
<a name="l01462"></a>01462     OLD_Z = Z;
<a name="l01463"></a>01463         
<a name="l01464"></a>01464     <span class="keywordflow">return</span>;
<a name="l01465"></a>01465 
<a name="l01466"></a>01466 }
<a name="l01467"></a>01467 
<a name="l01468"></a>01468 
<a name="l01469"></a><a class="code" href="_tsyg2004_8c.html#05b3a8c8d1e1b62725abe895df3d1ca1">01469</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#05b3a8c8d1e1b62725abe895df3d1ca1">BIRK_1N2</a>( <span class="keywordtype">int</span> NUMB, <span class="keywordtype">int</span> MODE, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ ) {
<a name="l01470"></a>01470 
<a name="l01471"></a>01471 
<a name="l01472"></a>01472     <span class="comment">/* </span>
<a name="l01473"></a>01473 <span class="comment">     *  </span>
<a name="l01474"></a>01474 <span class="comment">     *  </span>
<a name="l01475"></a>01475 <span class="comment">     *  </span>
<a name="l01476"></a>01476 <span class="comment">     *    CALCULATES COMPONENTS  OF REGION 1/2 FIELD IN SPHERICAL COORDS.  DERIVED FROM THE S/R DIPDEF2C (WHICH</span>
<a name="l01477"></a>01477 <span class="comment">     *      DOES THE SAME JOB, BUT INPUT/OUTPUT THERE WAS IN SPHERICAL COORDS, WHILE HERE WE USE CARTESIAN ONES)</span>
<a name="l01478"></a>01478 <span class="comment">     *  </span>
<a name="l01479"></a>01479 <span class="comment">     *     INPUT:  NUMB=1 (2) FOR REGION 1 (2) CURRENTS</span>
<a name="l01480"></a>01480 <span class="comment">     *             MODE=1 YIELDS SIMPLE SINUSOIDAL MLT VARIATION, WITH MAXIMUM CURRENT AT DAWN/DUSK MERIDIAN</span>
<a name="l01481"></a>01481 <span class="comment">     *       WHILE MODE=2 YIELDS THE SECOND HARMONIC.</span>
<a name="l01482"></a>01482 <span class="comment">     *  </span>
<a name="l01483"></a>01483 <span class="comment">     *  (1) DPHI:   HALF-DIFFERENCE (IN RADIANS) BETWEEN DAY AND NIGHT LATITUDE OF FAC OVAL AT IONOSPHERIC ALTITUDE;</span>
<a name="l01484"></a>01484 <span class="comment">     *              TYPICAL VALUE: 0.06</span>
<a name="l01485"></a>01485 <span class="comment">     *  (2) B:      AN ASYMMETRY FACTOR AT HIGH-ALTITUDES;  FOR B=0, THE ONLY ASYMMETRY IS THAT FROM DPHI</span>
<a name="l01486"></a>01486 <span class="comment">     *              TYPICAL VALUES: 0.35-0.70</span>
<a name="l01487"></a>01487 <span class="comment">     *  (3) RHO_0:  A FIXED PARAMETER, DEFINING THE DISTANCE RHO, AT WHICH THE LATITUDE SHIFT GRADUALLY SATURATES AND</span>
<a name="l01488"></a>01488 <span class="comment">     *              STOPS INCREASING</span>
<a name="l01489"></a>01489 <span class="comment">     *              ITS VALUE WAS ASSUMED FIXED, EQUAL TO 7.0.</span>
<a name="l01490"></a>01490 <span class="comment">     *  (4) XKAPPA: AN OVERALL SCALING FACTOR, WHICH CAN BE USED FOR CHANGING THE SIZE OF THE F.A.C. OVAL</span>
<a name="l01491"></a>01491 <span class="comment">     *</span>
<a name="l01492"></a>01492 <span class="comment">     */</span>
<a name="l01493"></a>01493 
<a name="l01494"></a>01494 
<a name="l01495"></a>01495     <span class="keyword">static</span> <span class="keywordtype">double</span> A11[] = { -9e99, .1618068350,-.1797957553,2.999642482,-.9322708978,
<a name="l01496"></a>01496                    -.6811059760,.2099057262,-8.358815746,-14.86033550,.3838362986,
<a name="l01497"></a>01497                    -16.30945494,4.537022847,2.685836007,27.97833029,6.330871059,
<a name="l01498"></a>01498                    1.876532361,18.95619213,.9651528100,.4217195118,-.08957770020,
<a name="l01499"></a>01499                    -1.823555887,.7457045438,-.5785916524,-1.010200918,.01112389357,
<a name="l01500"></a>01500                    .09572927448,-.3599292276,8.713700514,.9763932955,3.834602998,
<a name="l01501"></a>01501                    2.492118385,.7113544659 };
<a name="l01502"></a>01502 
<a name="l01503"></a>01503     <span class="keyword">static</span> <span class="keywordtype">double</span> A12[] = { -9e99, .7058026940,-.2845938535,5.715471266,-2.472820880,
<a name="l01504"></a>01504                    -.7738802408,.3478293930,-11.37653694,-38.64768867,.6932927651,
<a name="l01505"></a>01505                    -212.4017288,4.944204937,3.071270411,33.05882281,7.387533799,
<a name="l01506"></a>01506                    2.366769108,79.22572682,.6154290178,.5592050551,-.1796585105,
<a name="l01507"></a>01507                    -1.654932210,.7309108776,-.4926292779,-1.130266095,-.009613974555,
<a name="l01508"></a>01508                    .1484586169,-.2215347198,7.883592948,.02768251655,2.950280953,
<a name="l01509"></a>01509                    1.212634762,.5567714182 };
<a name="l01510"></a>01510 
<a name="l01511"></a>01511     <span class="keyword">static</span> <span class="keywordtype">double</span> A21[] = { -9e99, .1278764024,-.2320034273,1.805623266,-32.37241440,
<a name="l01512"></a>01512                    -.9931490648,.3175085630,-2.492465814,-16.21600096,.2695393416,
<a name="l01513"></a>01513                    -6.752691265,3.971794901,14.54477563,41.10158386,7.912889730,
<a name="l01514"></a>01514                    1.258297372,9.583547721,1.014141963,.5104134759,-.1790430468,
<a name="l01515"></a>01515                    -1.756358428,.7561986717,-.6775248254,-.04014016420,.01446794851,
<a name="l01516"></a>01516                    .1200521731,-.2203584559,4.508963850,.8221623576,1.779933730,
<a name="l01517"></a>01517                    1.102649543,.8867880020 };
<a name="l01518"></a>01518 
<a name="l01519"></a>01519     <span class="keyword">static</span> <span class="keywordtype">double</span> A22[] = { -9e99, .4036015198,-.3302974212,2.827730930,-45.44405830,
<a name="l01520"></a>01520                    -1.611103927,.4927112073,-.003258457559,-49.59014949,.3796217108,
<a name="l01521"></a>01521                    -233.7884098,4.312666980,18.05051709,28.95320323,11.09948019,
<a name="l01522"></a>01522                    .7471649558,67.10246193,.5667096597,.6468519751,-.1560665317,
<a name="l01523"></a>01523                    -1.460805289,.7719653528,-.6658988668,.2515179349E-05,
<a name="l01524"></a>01524                    .02426021891,.1195003324,-.2625739255,4.377172556,.2421190547,
<a name="l01525"></a>01525                    2.503482679,1.071587299,.7247997430 };
<a name="l01526"></a>01526                                                                    
<a name="l01527"></a>01527 
<a name="l01528"></a>01528     <span class="keywordtype">double</span>  BETA=0.9, RH=10.0;  <span class="comment">// parameters of the tilt-dependent deformation of the untilted F.A.C. field</span>
<a name="l01529"></a>01529 <span class="comment">//    double    EPS=3.0;            // parameters of the tilt-dependent deformation of the untilted F.A.C. field</span>
<a name="l01530"></a>01530     <span class="keywordtype">double</span>  RHO2, Xsc, Xsc2, Ysc, Zsc, Zsc2, RHO, RHOSQ;
<a name="l01531"></a>01531     <span class="keywordtype">double</span>  Rsc, Ysc2, PHI, SPHIC, CPHIC, BRACK, R1RH, R1RH2, R1RH3, PSIAS, PHIS, DPHISPHI;
<a name="l01532"></a>01532     <span class="keywordtype">double</span>  RHO2pRHOSQ, RHO2pRHOSQ2, DPHISRHO, DPHISDY, SPHICS, CPHICS, XS, ZS, BXS, BYAS;
<a name="l01533"></a>01533     <span class="keywordtype">double</span>  BZS, BRHOAS, BPHIAS, BRHO_S, BPHI_S, BY_S;
<a name="l01534"></a>01534 
<a name="l01535"></a>01535 
<a name="l01536"></a>01536     CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#df085adbf76beb194ac436d42cd1d725">B</a>     = 0.5;
<a name="l01537"></a>01537     CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#aaec50d7de5ec25604a887bb774a5ad2">RHO_0</a> = 7.0; RHO2 = 49.0;
<a name="l01538"></a>01538                                                                    
<a name="l01539"></a>01539     CB_MODENUM.<a class="code" href="struct___c_b___m_o_d_e_n_u_m.html#5e78dbd5fd0fc01ba7b98dd15e27221e">M</a> = MODE;
<a name="l01540"></a>01540     <span class="keywordflow">if</span> (NUMB == 1) {
<a name="l01541"></a>01541     CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#bfa5828793e470e32c7cd371b5d698d4">DPHI</a>   = 0.055;
<a name="l01542"></a>01542     CB_DTHETA.<a class="code" href="struct___c_b___d_t_h_e_t_a.html#4a563a70a3df6760bcba2788ae797e76">DTHETA</a> = 0.06;
<a name="l01543"></a>01543     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NUMB == 2) {
<a name="l01544"></a>01544     CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#bfa5828793e470e32c7cd371b5d698d4">DPHI</a>   = 0.030;
<a name="l01545"></a>01545     CB_DTHETA.<a class="code" href="struct___c_b___d_t_h_e_t_a.html#4a563a70a3df6760bcba2788ae797e76">DTHETA</a> = 0.09;
<a name="l01546"></a>01546     }
<a name="l01547"></a>01547                                                                    
<a name="l01548"></a>01548     Xsc = X*CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#c47e67864f6ce1555c7fbb0ca0429a1b">XKAPPA</a>; Xsc2 = Xsc*Xsc;
<a name="l01549"></a>01549     Ysc = Y*CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#c47e67864f6ce1555c7fbb0ca0429a1b">XKAPPA</a>; Ysc2 = Ysc*Ysc;
<a name="l01550"></a>01550     Zsc = Z*CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#c47e67864f6ce1555c7fbb0ca0429a1b">XKAPPA</a>; Zsc2 = Zsc*Zsc;
<a name="l01551"></a>01551     RHO = sqrt(Xsc2+Zsc2); 
<a name="l01552"></a>01552     RHOSQ = Xsc2+Zsc2;
<a name="l01553"></a>01553                                                                    
<a name="l01554"></a>01554     Rsc  = sqrt(Xsc2+Ysc2+Zsc2);        <span class="comment">// SCALED</span>
<a name="l01555"></a>01555                                                                    
<a name="l01556"></a>01556     <span class="keywordflow">if</span> ( (Xsc == 0.0) &amp;&amp; (Zsc == 0.0) ) {
<a name="l01557"></a>01557     PHI = 0.0;
<a name="l01558"></a>01558     } <span class="keywordflow">else</span> {
<a name="l01559"></a>01559     PHI = atan2(-Zsc, Xsc);         <span class="comment">// FROM CARTESIAN TO CYLINDRICAL (RHO,PHI,Y)</span>
<a name="l01560"></a>01560     }
<a name="l01561"></a>01561                                                                    
<a name="l01562"></a>01562     SPHIC = sin(PHI);
<a name="l01563"></a>01563     CPHIC = cos(PHI);               <span class="comment">// "C" means "CYLINDRICAL", TO DISTINGUISH FROM SPHERICAL PHI</span>
<a name="l01564"></a>01564                                                                    
<a name="l01565"></a>01565     BRACK = CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#bfa5828793e470e32c7cd371b5d698d4">DPHI</a>+CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#df085adbf76beb194ac436d42cd1d725">B</a>*RHO2/(RHO2+1.0)*(RHOSQ-1.0)/(RHO2+RHOSQ);
<a name="l01566"></a>01566     R1RH  = (Rsc-1.0)/RH;
<a name="l01567"></a>01567     R1RH2 = R1RH*R1RH; R1RH3 = R1RH2*R1RH;
<a name="l01568"></a>01568     PSIAS = BETA*PS/pow( 1.0+R1RH3, 1.0/3.0 );
<a name="l01569"></a>01569                                                                    
<a name="l01570"></a>01570     PHIS = PHI-BRACK*SPHIC - PSIAS;
<a name="l01571"></a>01571     DPHISPHI = 1.0-BRACK*CPHIC;
<a name="l01572"></a>01572     RHO2pRHOSQ = RHO2+RHOSQ; RHO2pRHOSQ2 = RHO2pRHOSQ*RHO2pRHOSQ;
<a name="l01573"></a>01573     DPHISRHO = -2.0*CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#df085adbf76beb194ac436d42cd1d725">B</a>*RHO2*RHO/RHO2pRHOSQ2*SPHIC +BETA*PS*R1RH2*RHO/(RH*Rsc*pow( 1.0+R1RH3, 4.0/3.0 ));
<a name="l01574"></a>01574     DPHISDY= BETA*PS*R1RH2*Ysc/(RH*Rsc*pow( 1.0+R1RH3, 4.0/3.0 ));
<a name="l01575"></a>01575                                                                    
<a name="l01576"></a>01576     SPHICS = sin(PHIS);
<a name="l01577"></a>01577     CPHICS = cos(PHIS);
<a name="l01578"></a>01578                                                                    
<a name="l01579"></a>01579     XS =  RHO*CPHICS;
<a name="l01580"></a>01580     ZS = -RHO*SPHICS;
<a name="l01581"></a>01581                                                                    
<a name="l01582"></a>01582     <span class="keywordflow">if</span> (NUMB == 1) {
<a name="l01583"></a>01583     <span class="keywordflow">if</span> (MODE == 1) <a class="code" href="_tsyg2004_8c.html#b05c2844104041ea55de4c30aaa5b968">TWOCONES</a>( A11, XS, Ysc, ZS, &amp;BXS, &amp;BYAS, &amp;BZS );
<a name="l01584"></a>01584     <span class="keywordflow">if</span> (MODE == 2) <a class="code" href="_tsyg2004_8c.html#b05c2844104041ea55de4c30aaa5b968">TWOCONES</a>( A12, XS, Ysc, ZS, &amp;BXS, &amp;BYAS, &amp;BZS );
<a name="l01585"></a>01585     } <span class="keywordflow">else</span> {
<a name="l01586"></a>01586     <span class="keywordflow">if</span> (MODE == 1) <a class="code" href="_tsyg2004_8c.html#b05c2844104041ea55de4c30aaa5b968">TWOCONES</a>( A21, XS, Ysc, ZS, &amp;BXS, &amp;BYAS, &amp;BZS );
<a name="l01587"></a>01587     <span class="keywordflow">if</span> (MODE == 2) <a class="code" href="_tsyg2004_8c.html#b05c2844104041ea55de4c30aaa5b968">TWOCONES</a>( A22, XS, Ysc, ZS, &amp;BXS, &amp;BYAS, &amp;BZS );
<a name="l01588"></a>01588     }
<a name="l01589"></a>01589                                                                    
<a name="l01590"></a>01590     BRHOAS = BXS*CPHICS-BZS*SPHICS;
<a name="l01591"></a>01591     BPHIAS = -BXS*SPHICS-BZS*CPHICS;
<a name="l01592"></a>01592                                                                    
<a name="l01593"></a>01593     BRHO_S = BRHOAS*DPHISPHI                             *CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#c47e67864f6ce1555c7fbb0ca0429a1b">XKAPPA</a>;    <span class="comment">// SCALING</span>
<a name="l01594"></a>01594     BPHI_S = (BPHIAS-RHO*(BYAS*DPHISDY+BRHOAS*DPHISRHO)) *CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#c47e67864f6ce1555c7fbb0ca0429a1b">XKAPPA</a>;
<a name="l01595"></a>01595     BY_S   = BYAS*DPHISPHI                               *CB_DPHI_B_RHO0.<a class="code" href="struct___c_b___d_p_h_i___b___r_h_o0.html#c47e67864f6ce1555c7fbb0ca0429a1b">XKAPPA</a>;
<a name="l01596"></a>01596                                                                    
<a name="l01597"></a>01597     *BX = BRHO_S*CPHIC-BPHI_S*SPHIC;
<a name="l01598"></a>01598     *BY = BY_S;
<a name="l01599"></a>01599     *BZ = -BRHO_S*SPHIC-BPHI_S*CPHIC;
<a name="l01600"></a>01600                                                                    
<a name="l01601"></a>01601     <span class="keywordflow">return</span>;
<a name="l01602"></a>01602 
<a name="l01603"></a>01603 }
<a name="l01604"></a>01604 
<a name="l01605"></a><a class="code" href="_tsyg2004_8c.html#b05c2844104041ea55de4c30aaa5b968">01605</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#b05c2844104041ea55de4c30aaa5b968">TWOCONES</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ){
<a name="l01606"></a>01606 
<a name="l01607"></a>01607     <span class="comment">/* </span>
<a name="l01608"></a>01608 <span class="comment">     *  </span>
<a name="l01609"></a>01609 <span class="comment">     *  </span>
<a name="l01610"></a>01610 <span class="comment">     *     ADDS FIELDS FROM TWO CONES (NORTHERN AND SOUTHERN), WITH A PROPER SYMMETRY OF THE CURRENT AND FIELD,</span>
<a name="l01611"></a>01611 <span class="comment">     *       CORRESPONDING TO THE REGION 1 BIRKELAND CURRENTS.</span>
<a name="l01612"></a>01612 <span class="comment">     */</span>  
<a name="l01613"></a>01613     <span class="keywordtype">double</span>  BXN, BYN, BZN, BXS, BYS, BZS;
<a name="l01614"></a>01614 
<a name="l01615"></a>01615     <a class="code" href="_tsyg2004_8c.html#d3ff91c1de1106c25ccbf3c1694cc883">ONE_CONE</a>( A, X, Y, Z, &amp;BXN, &amp;BYN, &amp;BZN );
<a name="l01616"></a>01616     <a class="code" href="_tsyg2004_8c.html#d3ff91c1de1106c25ccbf3c1694cc883">ONE_CONE</a>( A, X, -Y, -Z, &amp;BXS, &amp;BYS, &amp;BZS );
<a name="l01617"></a>01617     *BX = BXN - BXS;
<a name="l01618"></a>01618     *BY = BYN + BYS;
<a name="l01619"></a>01619     *BZ = BZN + BZS;
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     <span class="keywordflow">return</span>;
<a name="l01622"></a>01622 
<a name="l01623"></a>01623 }
<a name="l01624"></a>01624 
<a name="l01625"></a>01625 
<a name="l01626"></a>01626 
<a name="l01627"></a><a class="code" href="_tsyg2004_8c.html#d3ff91c1de1106c25ccbf3c1694cc883">01627</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#d3ff91c1de1106c25ccbf3c1694cc883">ONE_CONE</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ) {
<a name="l01628"></a>01628 
<a name="l01629"></a>01629     <span class="comment">/*</span>
<a name="l01630"></a>01630 <span class="comment">     *</span>
<a name="l01631"></a>01631 <span class="comment">     *</span>
<a name="l01632"></a>01632 <span class="comment">     *</span>
<a name="l01633"></a>01633 <span class="comment">     *  RETURNS FIELD COMPONENTS FOR A DEFORMED CONICAL CURRENT SYSTEM, FITTED TO A BIOSAVART FIELD</span>
<a name="l01634"></a>01634 <span class="comment">     *    BY SIM_14.FOR.  HERE ONLY THE NORTHERN CONE IS TAKEN INTO ACCOUNT.</span>
<a name="l01635"></a>01635 <span class="comment">     *</span>
<a name="l01636"></a>01636 <span class="comment">     */</span>
<a name="l01637"></a>01637                                                                    
<a name="l01638"></a>01638     <span class="keywordtype">double</span>  DR=1e-6, DT=1e-6;   <span class="comment">// JUST FOR NUMERICAL DIFFERENTIATION</span>
<a name="l01639"></a>01639     <span class="keywordtype">double</span>  THETA0, RHO2, RHO, R, THETA, PHI, RS, THETAS, PHIS, BTAST, BFAST;
<a name="l01640"></a>01640     <span class="keywordtype">double</span>  DRSDR, DRSDT, DTSDR, DTSDT, STSST, RSR, BR, BTHETA, BPHI;
<a name="l01641"></a>01641     <span class="keywordtype">double</span>  S, C, SF, CF, BE;
<a name="l01642"></a>01642 
<a name="l01643"></a>01643                                                                    
<a name="l01644"></a>01644     THETA0 = A[31];
<a name="l01645"></a>01645                                                                    
<a name="l01646"></a>01646     RHO2  = X*X+Y*Y;
<a name="l01647"></a>01647     RHO   = sqrt(RHO2);
<a name="l01648"></a>01648     R     = sqrt(RHO2+Z*Z);
<a name="l01649"></a>01649     THETA = atan2(RHO,Z);
<a name="l01650"></a>01650     PHI   = atan2(Y,X);
<a name="l01651"></a>01651 
<a name="l01652"></a>01652 
<a name="l01653"></a>01653     <span class="comment">/*</span>
<a name="l01654"></a>01654 <span class="comment">     *   MAKE THE DEFORMATION OF COORDINATES:</span>
<a name="l01655"></a>01655 <span class="comment">     */</span>
<a name="l01656"></a>01656     RS     = <a class="code" href="_tsyg2004_8c.html#22701b7ad2e702887750fdec469f01fb">R_S</a>( A, R, THETA );
<a name="l01657"></a>01657     THETAS = <a class="code" href="_tsyg2004_8c.html#af80d04276fc0dce8abc24392512cf8e">THETA_S</a>( A, R, THETA );
<a name="l01658"></a>01658     PHIS   = PHI;
<a name="l01659"></a>01659 
<a name="l01660"></a>01660 
<a name="l01661"></a>01661     <span class="comment">/* </span>
<a name="l01662"></a>01662 <span class="comment">     *   CALCULATE FIELD COMPONENTS AT THE NEW POSITION (ASTERISKED):</span>
<a name="l01663"></a>01663 <span class="comment">     */</span>
<a name="l01664"></a>01664     <a class="code" href="_tsyg2004_8c.html#8e93acc99263e229c4b81a6c4cd9f148">FIALCOS</a>( RS, THETAS, PHIS, &amp;BTAST, &amp;BFAST, CB_MODENUM.<a class="code" href="struct___c_b___m_o_d_e_n_u_m.html#5e78dbd5fd0fc01ba7b98dd15e27221e">M</a>, THETA0, CB_DTHETA.<a class="code" href="struct___c_b___d_t_h_e_t_a.html#4a563a70a3df6760bcba2788ae797e76">DTHETA</a>); <span class="comment">// MODE #M</span>
<a name="l01665"></a>01665 <span class="comment">//FIX what gets returned here?</span>
<a name="l01666"></a>01666 
<a name="l01667"></a>01667 
<a name="l01668"></a>01668     <span class="comment">/* </span>
<a name="l01669"></a>01669 <span class="comment">     *   NOW TRANSFORM B{R,T,F}_AST BY THE DEFORMATION TENSOR:</span>
<a name="l01670"></a>01670 <span class="comment">     *</span>
<a name="l01671"></a>01671 <span class="comment">     *      FIRST OF ALL, FIND THE DERIVATIVES:</span>
<a name="l01672"></a>01672 <span class="comment">     */</span>
<a name="l01673"></a>01673     DRSDR = (<a class="code" href="_tsyg2004_8c.html#22701b7ad2e702887750fdec469f01fb">R_S</a>(A,R+DR,THETA)-<a class="code" href="_tsyg2004_8c.html#22701b7ad2e702887750fdec469f01fb">R_S</a>(A,R-DR,THETA))/(2.0*DR);
<a name="l01674"></a>01674     DRSDT = (<a class="code" href="_tsyg2004_8c.html#22701b7ad2e702887750fdec469f01fb">R_S</a>(A,R,THETA+DT)-<a class="code" href="_tsyg2004_8c.html#22701b7ad2e702887750fdec469f01fb">R_S</a>(A,R,THETA-DT))/(2.0*DT);
<a name="l01675"></a>01675     DTSDR = (<a class="code" href="_tsyg2004_8c.html#af80d04276fc0dce8abc24392512cf8e">THETA_S</a>(A,R+DR,THETA)-<a class="code" href="_tsyg2004_8c.html#af80d04276fc0dce8abc24392512cf8e">THETA_S</a>(A,R-DR,THETA))/(2.0*DR);
<a name="l01676"></a>01676     DTSDT = (<a class="code" href="_tsyg2004_8c.html#af80d04276fc0dce8abc24392512cf8e">THETA_S</a>(A,R,THETA+DT)-<a class="code" href="_tsyg2004_8c.html#af80d04276fc0dce8abc24392512cf8e">THETA_S</a>(A,R,THETA-DT))/(2.0*DT);
<a name="l01677"></a>01677                                                                    
<a name="l01678"></a>01678     STSST = sin(THETAS)/sin(THETA);
<a name="l01679"></a>01679     RSR  =  RS/R;
<a name="l01680"></a>01680                                                                    
<a name="l01681"></a>01681     BR      =  -RSR/R*STSST*BTAST*DRSDT;
<a name="l01682"></a>01682     BTHETA  =   RSR*STSST*BTAST*DRSDR;
<a name="l01683"></a>01683     BPHI    =  RSR*BFAST*(DRSDR*DTSDT-DRSDT*DTSDR);
<a name="l01684"></a>01684                                                                    
<a name="l01685"></a>01685     S  = RHO/R;
<a name="l01686"></a>01686     C  = Z/R;
<a name="l01687"></a>01687     SF = Y/RHO;
<a name="l01688"></a>01688     CF = X/RHO;
<a name="l01689"></a>01689                                                                    
<a name="l01690"></a>01690     BE = BR*S+BTHETA*C;
<a name="l01691"></a>01691                                                                    
<a name="l01692"></a>01692     *BX = A[1]*(BE*CF-BPHI*SF);
<a name="l01693"></a>01693     *BY = A[1]*(BE*SF+BPHI*CF);
<a name="l01694"></a>01694     *BZ = A[1]*(BR*C-BTHETA*S);
<a name="l01695"></a>01695                                                                    
<a name="l01696"></a>01696     <span class="keywordflow">return</span>;
<a name="l01697"></a>01697 
<a name="l01698"></a>01698 }
<a name="l01699"></a>01699 
<a name="l01700"></a>01700 
<a name="l01701"></a><a class="code" href="_tsyg2004_8c.html#22701b7ad2e702887750fdec469f01fb">01701</a> <span class="keywordtype">double</span> <a class="code" href="_tsyg2004_8c.html#22701b7ad2e702887750fdec469f01fb">R_S</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> THETA) {
<a name="l01702"></a>01702 
<a name="l01703"></a>01703     <span class="keywordtype">double</span>  RS, R2, A11_2, A12_2, A13_2, A14_2, A15_2, A16_2, R2pA16_2, R2pA16_2_2;
<a name="l01704"></a>01704 
<a name="l01705"></a>01705     R2 = R*R;
<a name="l01706"></a>01706     A11_2 = A[11]*A[11];
<a name="l01707"></a>01707     A12_2 = A[12]*A[12];
<a name="l01708"></a>01708     A13_2 = A[13]*A[13];
<a name="l01709"></a>01709     A14_2 = A[14]*A[14];
<a name="l01710"></a>01710     A15_2 = A[15]*A[15];
<a name="l01711"></a>01711     A16_2 = A[16]*A[16];
<a name="l01712"></a>01712     R2pA16_2 = R2+A16_2; R2pA16_2_2 = R2pA16_2*R2pA16_2;
<a name="l01713"></a>01713     
<a name="l01714"></a>01714     RS = R+A[2]/R +A[3]*R/sqrt(R2+A11_2)+A[4]*R/(R2+A12_2)
<a name="l01715"></a>01715            +(A[5]+A[6]/R+A[7]*R/sqrt(R2+A13_2)+A[8]*R/(R2+A14_2))*cos(THETA)
<a name="l01716"></a>01716            +(A[9]*R/sqrt(R2+A15_2)+A[10]*R/R2pA16_2_2)*cos(2.0*THETA);
<a name="l01717"></a>01717 
<a name="l01718"></a>01718       <span class="keywordflow">return</span>( RS );
<a name="l01719"></a>01719 
<a name="l01720"></a>01720 }
<a name="l01721"></a><a class="code" href="_tsyg2004_8c.html#af80d04276fc0dce8abc24392512cf8e">01721</a> <span class="keywordtype">double</span> <a class="code" href="_tsyg2004_8c.html#af80d04276fc0dce8abc24392512cf8e">THETA_S</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> THETA) {
<a name="l01722"></a>01722 
<a name="l01723"></a>01723     <span class="keywordtype">double</span>  TS, R2, A27_2, A28_2, A29_2, A30_2;
<a name="l01724"></a>01724 
<a name="l01725"></a>01725     R2 = R*R;
<a name="l01726"></a>01726     A27_2 = A[27]*A[27];
<a name="l01727"></a>01727     A28_2 = A[28]*A[28];
<a name="l01728"></a>01728     A29_2 = A[29]*A[29];
<a name="l01729"></a>01729     A30_2 = A[30]*A[30];
<a name="l01730"></a>01730     
<a name="l01731"></a>01731     TS = THETA +(A[17]+A[18]/R+A[19]/R2
<a name="l01732"></a>01732             +A[20]*R/sqrt(R2+A27_2))*sin(THETA)
<a name="l01733"></a>01733             +(A[21]+A[22]*R/sqrt(R2+A28_2)
<a name="l01734"></a>01734             +A[23]*R/(R2+A29_2))*sin(2.0*THETA)
<a name="l01735"></a>01735             +(A[24]+A[25]/R+A[26]*R/(R2+A30_2))*sin(3.0*THETA);
<a name="l01736"></a>01736 
<a name="l01737"></a>01737       <span class="keywordflow">return</span>( TS );
<a name="l01738"></a>01738 }
<a name="l01739"></a>01739 
<a name="l01740"></a>01740 
<a name="l01741"></a>01741 
<a name="l01742"></a><a class="code" href="_tsyg2004_8c.html#8e93acc99263e229c4b81a6c4cd9f148">01742</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#8e93acc99263e229c4b81a6c4cd9f148">FIALCOS</a>( <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> THETA, <span class="keywordtype">double</span> PHI, <span class="keywordtype">double</span> *BTHETA, <span class="keywordtype">double</span> *BPHI, <span class="keywordtype">int</span> N, <span class="keywordtype">double</span> THETA0, <span class="keywordtype">double</span> DT) {
<a name="l01743"></a>01743 
<a name="l01744"></a>01744     <span class="comment">/* </span>
<a name="l01745"></a>01745 <span class="comment">     *  </span>
<a name="l01746"></a>01746 <span class="comment">     *  </span>
<a name="l01747"></a>01747 <span class="comment">     *    CONICAL MODEL OF BIRKELAND CURRENT FIELD; BASED ON THE OLD S/R FIALCO (OF 1990-91)</span>
<a name="l01748"></a>01748 <span class="comment">     *                                                                    </span>
<a name="l01749"></a>01749 <span class="comment">     *    BTN, AND BPN ARE THE ARRAYS OF BTHETA AND BPHI (BTN(i), BPN(i) CORRESPOND TO i-th MODE).</span>
<a name="l01750"></a>01750 <span class="comment">     *     ONLY FIRST  N  MODE AMPLITUDES ARE COMPUTED (N&lt;=10).</span>
<a name="l01751"></a>01751 <span class="comment">     *      THETA0 IS THE ANGULAR HALF-WIDTH OF THE CONE, DT IS THE ANGULAR H.-W. OF THE CURRENT LAYER</span>
<a name="l01752"></a>01752 <span class="comment">     *                                                                    </span>
<a name="l01753"></a>01753 <span class="comment">     *     NOTE:  BR=0  (BECAUSE ONLY RADIAL CURRENTS ARE PRESENT IN THIS MODEL)</span>
<a name="l01754"></a>01754 <span class="comment">     */</span>  
<a name="l01755"></a>01755 
<a name="l01756"></a>01756     <span class="keywordtype">int</span>     <a class="code" href="quicksort_8c.html#52037c938e3c1b126c6277da5ca689d0">M</a>;
<a name="l01757"></a>01757     <span class="keywordtype">double</span>  SINTE, RO, COSTE, SINFI, COSFI, TG, CTG, TETANP, TETANM, TGP=0.0, TGM=0.0, TGM2=0.0, TGP2=0.0;
<a name="l01758"></a>01758     <span class="keywordtype">double</span>  COSM1, SINM1, TM, TGM2M, TGP2M, T, FC, FC1, TGM2M1, TG21, DTT, DTT0;
<a name="l01759"></a>01759     <span class="keywordtype">double</span>  BTN[10], BPN[10], CCOS[10], SSIN[10];
<a name="l01760"></a>01760 
<a name="l01761"></a>01761     SINTE = sin(THETA);
<a name="l01762"></a>01762     RO    = R*SINTE;
<a name="l01763"></a>01763     COSTE = cos(THETA);
<a name="l01764"></a>01764     SINFI = sin(PHI);
<a name="l01765"></a>01765     COSFI = cos(PHI);
<a name="l01766"></a>01766     TG    = SINTE/(1.0+COSTE);      <span class="comment">//  TAN(THETA/2)</span>
<a name="l01767"></a>01767     CTG   = SINTE/(1.0-COSTE);      <span class="comment">//  CTG(THETA/2)</span>
<a name="l01768"></a>01768  
<a name="l01769"></a>01769  
<a name="l01770"></a>01770     TETANP = THETA0+DT;
<a name="l01771"></a>01771     TETANM = THETA0-DT;
<a name="l01772"></a>01772 
<a name="l01773"></a>01773     <span class="keywordflow">if</span> (THETA &gt;= TETANM) {
<a name="l01774"></a>01774         TGP  = tan(TETANP*0.5);
<a name="l01775"></a>01775         TGM  = tan(TETANM*0.5);
<a name="l01776"></a>01776         TGM2 = TGM*TGM;
<a name="l01777"></a>01777         TGP2 = TGP*TGP;
<a name="l01778"></a>01778     }
<a name="l01779"></a>01779                                                                    
<a name="l01780"></a>01780     COSM1 = 1.0;
<a name="l01781"></a>01781     SINM1 = 0.0;
<a name="l01782"></a>01782     TM    = 1.0;
<a name="l01783"></a>01783     TGM2M = 1.0;
<a name="l01784"></a>01784     TGP2M = 1.0;
<a name="l01785"></a>01785 
<a name="l01786"></a>01786     <span class="keywordflow">for</span> ( M=1; M&lt;= N; M++ ) {
<a name="l01787"></a>01787 
<a name="l01788"></a>01788     TM *= TG;
<a name="l01789"></a>01789     CCOS[M] = COSM1*COSFI-SINM1*SINFI;
<a name="l01790"></a>01790     SSIN[M] = SINM1*COSFI+COSM1*SINFI;
<a name="l01791"></a>01791     COSM1   = CCOS[M];
<a name="l01792"></a>01792     SINM1   = SSIN[M];
<a name="l01793"></a>01793     <span class="keywordflow">if</span> (THETA &lt; TETANM) {
<a name="l01794"></a>01794         T    = TM;
<a name="l01795"></a>01795         DTT  = 0.5*M*TM*(TG+CTG);
<a name="l01796"></a>01796         DTT0 = 0.0;
<a name="l01797"></a>01797     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (THETA &lt; TETANP) {
<a name="l01798"></a>01798         TGM2M  = TGM2M*TGM2;
<a name="l01799"></a>01799         FC     = 1.0/(TGP-TGM);
<a name="l01800"></a>01800         FC1    = 1.0/(2*M+1);
<a name="l01801"></a>01801         TGM2M1 = TGM2M*TGM;
<a name="l01802"></a>01802         TG21   = 1.0+TG*TG;
<a name="l01803"></a>01803         T      = FC*(TM*(TGP-TG)+FC1*(TM*TG-TGM2M1/TM));
<a name="l01804"></a>01804         DTT    = 0.5*M*FC*TG21*(TM/TG*(TGP-TG)-FC1*(TM-TGM2M1/(TM*TG)));
<a name="l01805"></a>01805         DTT0   = 0.5*FC*((TGP+TGM)*(TM*TG-FC1*(TM*TG-TGM2M1/TM))+
<a name="l01806"></a>01806                 TM*(1.0-TGP*TGM)-(1.0+TGM2)*TGM2M/TM);
<a name="l01807"></a>01807     } <span class="keywordflow">else</span> {
<a name="l01808"></a>01808         TGP2M = TGP2M*TGP2;
<a name="l01809"></a>01809         TGM2M = TGM2M*TGM2;
<a name="l01810"></a>01810         FC    = 1.0/(TGP-TGM);
<a name="l01811"></a>01811         FC1   = 1.0/(2*M+1);
<a name="l01812"></a>01812         T     = FC*FC1*(TGP2M*TGP-TGM2M*TGM)/TM;
<a name="l01813"></a>01813         DTT   = -T*M*0.50*(TG+CTG);
<a name="l01814"></a>01814     }
<a name="l01815"></a>01815 
<a name="l01816"></a>01816     BTN[M] = M*T*CCOS[M]/RO;
<a name="l01817"></a>01817     BPN[M] = -DTT*SSIN[M]/R;
<a name="l01818"></a>01818 
<a name="l01819"></a>01819     }
<a name="l01820"></a>01820                                                                    
<a name="l01821"></a>01821     *BTHETA = BTN[N]*800.0;
<a name="l01822"></a>01822     *BPHI   = BPN[N]*800.0;
<a name="l01823"></a>01823 
<a name="l01824"></a>01824 }
<a name="l01825"></a>01825                                                                    
<a name="l01826"></a>01826 
<a name="l01827"></a>01827 
<a name="l01828"></a><a class="code" href="_tsyg2004_8c.html#723d4ced4ac10c32344d63bda6126fdf">01828</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#723d4ced4ac10c32344d63bda6126fdf">BIRK_SHL</a>( <span class="keywordtype">int</span> J, <span class="keywordtype">int</span> PSChanged, <span class="keywordtype">int</span> XChanged, <span class="keywordtype">int</span> YChanged, <span class="keywordtype">int</span> ZChanged, <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X_SC, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ ) {
<a name="l01829"></a>01829 
<a name="l01830"></a>01830     <span class="keywordtype">int</span>     L, <a class="code" href="quicksort_8c.html#52037c938e3c1b126c6277da5ca689d0">M</a>, I, N, NN, K;
<a name="l01831"></a>01831     <span class="keywordtype">double</span>  GX, GY, GZ, FX, FY, FZ, HX, HY, HZ, HXR, HZR;
<a name="l01832"></a>01832 
<a name="l01833"></a>01833 <span class="comment">// not thread safe?</span>
<a name="l01834"></a>01834 <span class="comment">// All the caching stuff needs to be in user-defined memory blocks so that this function is re-entrant.</span>
<a name="l01835"></a>01835     <span class="keyword">static</span> <span class="keywordtype">int</span>      DoneJ[4] = { 0, 0, 0, 0 };
<a name="l01836"></a>01836     <span class="keyword">static</span> <span class="keywordtype">double</span>   CPS, SPS, S3PS, PST1[4], PST2[4], ST1[4], CT1[4], ST2[4], CT2[4], X1[4], Z1[4], X2[4], Z2[4];
<a name="l01837"></a>01837     <span class="keyword">static</span> <span class="keywordtype">double</span>   P[4][4] = { {-9e99, -9e99, -9e99, -9e99}, {-9e99, -9e99, -9e99, -9e99}, 
<a name="l01838"></a>01838                       {-9e99, -9e99, -9e99, -9e99}, {-9e99, -9e99, -9e99, -9e99} };
<a name="l01839"></a>01839     <span class="keyword">static</span> <span class="keywordtype">double</span>   ooP[4][4], ooP2[4][4];
<a name="l01840"></a>01840     <span class="keyword">static</span> <span class="keywordtype">double</span>   Q[4][4], ooQ[4][4], ooQ2[4][4];
<a name="l01841"></a>01841     <span class="keyword">static</span> <span class="keywordtype">double</span>   R[4][4], ooR[4][4], ooR2[4][4];
<a name="l01842"></a>01842     <span class="keyword">static</span> <span class="keywordtype">double</span>   S[4][4], ooS[4][4], ooS2[4][4];
<a name="l01843"></a>01843     <span class="keyword">static</span> <span class="keywordtype">double</span>   YooP[4][4], YooQ[4][4], CYPI[4][4], CYQI[4][4], SYPI[4][4], SYQI[4][4];
<a name="l01844"></a>01844     <span class="keyword">static</span> <span class="keywordtype">double</span>   Z1ooR[4][4], Z2ooS[4][4], SZRK[4][4], CZSK[4][4], CZRK[4][4], SZSK[4][4];
<a name="l01845"></a>01845     <span class="keyword">static</span> <span class="keywordtype">double</span>   SQPR[4][4][4], SQQS[4][4][4], EPR[4][4][4], EQS[4][4][4];
<a name="l01846"></a>01846 
<a name="l01847"></a>01847     
<a name="l01848"></a>01848 
<a name="l01849"></a>01849 
<a name="l01850"></a>01850 
<a name="l01851"></a>01851     <span class="comment">/*</span>
<a name="l01852"></a>01852 <span class="comment">     *  There are 4 different sets of coefficients that come to us. We added an argument to the</span>
<a name="l01853"></a>01853 <span class="comment">     *  calling routine so that we know which set we are dealing with. Then many things dont need to</span>
<a name="l01854"></a>01854 <span class="comment">     *  be recomputed. Probably dont need to cache all quantities here -- i.e. could prob optimize memory</span>
<a name="l01855"></a>01855 <span class="comment">     *  usage as well...</span>
<a name="l01856"></a>01856 <span class="comment">     */</span>
<a name="l01857"></a>01857     <span class="keywordflow">for</span> ( I=1;  I&lt;=3; I++ ) {
<a name="l01858"></a>01858         <span class="keywordflow">if</span> ( !DoneJ[J] ) {
<a name="l01859"></a>01859 
<a name="l01860"></a>01860         P[J][I] = A[72+I]; ooP[J][I] = 1.0/P[J][I]; ooP2[J][I] = ooP[J][I]*ooP[J][I];
<a name="l01861"></a>01861         Q[J][I] = A[78+I]; ooQ[J][I] = 1.0/Q[J][I]; ooQ2[J][I] = ooQ[J][I]*ooQ[J][I];
<a name="l01862"></a>01862     
<a name="l01863"></a>01863         R[J][I] = A[75+I]; ooR[J][I] = 1.0/R[J][I]; ooR2[J][I] = ooR[J][I]*ooR[J][I];
<a name="l01864"></a>01864         S[J][I] = A[81+I]; ooS[J][I] = 1.0/S[J][I]; ooS2[J][I] = ooS[J][I]*ooS[J][I];
<a name="l01865"></a>01865     }
<a name="l01866"></a>01866     }
<a name="l01867"></a>01867 
<a name="l01868"></a>01868 
<a name="l01869"></a>01869     <span class="comment">/*</span>
<a name="l01870"></a>01870 <span class="comment">     *  if PS has changed we need to recompute things</span>
<a name="l01871"></a>01871 <span class="comment">     */</span>
<a name="l01872"></a>01872     <span class="keywordflow">if</span> ( PSChanged || !DoneJ[J] ) {
<a name="l01873"></a>01873         CPS  = <a class="code" href="_tsyg2004_8c.html#98e0e08bb8a65f90813e5adb482aeb2c">cos_psi</a>; 
<a name="l01874"></a>01874     SPS  = <a class="code" href="_tsyg2004_8c.html#5b35fcda1a15310fa7b7e3e242431de3">sin_psi</a>;
<a name="l01875"></a>01875         S3PS = 2.0*CPS;
<a name="l01876"></a>01876         PST1[J] = PS*A[85];
<a name="l01877"></a>01877         PST2[J] = PS*A[86];
<a name="l01878"></a>01878         ST1[J] = sin(PST1[J]);
<a name="l01879"></a>01879         CT1[J] = cos(PST1[J]);
<a name="l01880"></a>01880         ST2[J] = sin(PST2[J]);
<a name="l01881"></a>01881         CT2[J] = cos(PST2[J]);
<a name="l01882"></a>01882     }
<a name="l01883"></a>01883 
<a name="l01884"></a>01884 
<a name="l01885"></a>01885     <span class="comment">/*</span>
<a name="l01886"></a>01886 <span class="comment">     *  if X or Z or PS have changed we need to recompute things</span>
<a name="l01887"></a>01887 <span class="comment">     */</span>
<a name="l01888"></a>01888     <span class="keywordflow">if</span> ( XChanged || ZChanged || PSChanged || !DoneJ[J] ) {
<a name="l01889"></a>01889         X1[J] = X*CT1[J] - Z*ST1[J];
<a name="l01890"></a>01890         Z1[J] = X*ST1[J] + Z*CT1[J];
<a name="l01891"></a>01891         X2[J] = X*CT2[J] - Z*ST2[J];
<a name="l01892"></a>01892         Z2[J] = X*ST2[J] + Z*CT2[J];
<a name="l01893"></a>01893     }
<a name="l01894"></a>01894 
<a name="l01895"></a>01895 
<a name="l01896"></a>01896     <span class="comment">/*</span>
<a name="l01897"></a>01897 <span class="comment">     *  cache the trig stuff. This doesnt depend on PS</span>
<a name="l01898"></a>01898 <span class="comment">     */</span>
<a name="l01899"></a>01899     <span class="keywordflow">if</span> ( YChanged || !DoneJ[J] ) {
<a name="l01900"></a>01900     <span class="keywordflow">for</span> (I=1; I&lt;=3; I++ ){
<a name="l01901"></a>01901         YooP[J][I] = Y*ooP[J][I]; 
<a name="l01902"></a>01902         YooQ[J][I] = Y*ooQ[J][I];
<a name="l01903"></a>01903         CYPI[J][I] = cos(YooP[J][I]);
<a name="l01904"></a>01904         CYQI[J][I] = cos(YooQ[J][I]);
<a name="l01905"></a>01905         SYPI[J][I] = sin(YooP[J][I]);
<a name="l01906"></a>01906         SYQI[J][I] = sin(YooQ[J][I]);
<a name="l01907"></a>01907     }
<a name="l01908"></a>01908     }
<a name="l01909"></a>01909 
<a name="l01910"></a>01910     <span class="keywordflow">if</span> ( XChanged || ZChanged || PSChanged || !DoneJ[J] ) {
<a name="l01911"></a>01911         <span class="keywordflow">for</span> (K=1; K&lt;=3; K++ ){
<a name="l01912"></a>01912         Z1ooR[J][K] = Z1[J]*ooR[J][K];
<a name="l01913"></a>01913         Z2ooS[J][K] = Z2[J]*ooS[J][K];
<a name="l01914"></a>01914         SZRK[J][K] = sin(Z1ooR[J][K]);
<a name="l01915"></a>01915         CZSK[J][K] = cos(Z2ooS[J][K]);
<a name="l01916"></a>01916         CZRK[J][K] = cos(Z1ooR[J][K]);
<a name="l01917"></a>01917         SZSK[J][K] = sin(Z2ooS[J][K]);
<a name="l01918"></a>01918     }
<a name="l01919"></a>01919     }
<a name="l01920"></a>01920 
<a name="l01921"></a>01921     <span class="keywordflow">if</span> ( XChanged || YChanged || ZChanged || PSChanged || !DoneJ[J] ) {
<a name="l01922"></a>01922         <span class="keywordflow">for</span> (I=1; I&lt;=3; I++ ){
<a name="l01923"></a>01923             <span class="keywordflow">for</span> (K=1; K&lt;=3; K++ ){
<a name="l01924"></a>01924             SQPR[J][I][K] = sqrt(ooP2[J][I] + ooR2[J][K]);
<a name="l01925"></a>01925             SQQS[J][I][K] = sqrt(ooQ2[J][I] + ooS2[J][K]);
<a name="l01926"></a>01926             EPR[J][I][K]  = exp(X1[J]*SQPR[J][I][K]);
<a name="l01927"></a>01927             EQS[J][I][K]  = exp(X2[J]*SQQS[J][I][K]);
<a name="l01928"></a>01928         }
<a name="l01929"></a>01929     }
<a name="l01930"></a>01930     }
<a name="l01931"></a>01931 
<a name="l01932"></a>01932 
<a name="l01933"></a>01933     <span class="comment">/*</span>
<a name="l01934"></a>01934 <span class="comment">     *  Flag that we've been through once already with this value of J</span>
<a name="l01935"></a>01935 <span class="comment">     */</span>
<a name="l01936"></a>01936     DoneJ[J] = <a class="code" href="_lgm___c_trans_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01937"></a>01937 
<a name="l01938"></a>01938 
<a name="l01939"></a>01939 
<a name="l01940"></a>01940 
<a name="l01941"></a>01941 
<a name="l01942"></a>01942 
<a name="l01943"></a>01943     L  = 0;
<a name="l01944"></a>01944     GX = 0.0;
<a name="l01945"></a>01945     GY = 0.0;
<a name="l01946"></a>01946     GZ = 0.0;
<a name="l01947"></a>01947 
<a name="l01948"></a>01948 
<a name="l01949"></a>01949     <span class="keywordflow">for</span> ( M=1;  M&lt;=2; M++ ) {   <span class="comment">//  M=1 IS FOR THE 1ST SUM ("PERP." SYMMETRY)</span>
<a name="l01950"></a>01950                 <span class="comment">//  AND M=2 IS FOR THE SECOND SUM ("PARALL." SYMMETRY)</span>
<a name="l01951"></a>01951 
<a name="l01952"></a>01952     <span class="keywordflow">for</span> ( I=1;  I&lt;=3; I++ ) {
<a name="l01953"></a>01953 
<a name="l01954"></a>01954         <span class="keywordflow">for</span> ( K=1; K&lt;= 3; K++ ) {
<a name="l01955"></a>01955 
<a name="l01956"></a>01956         <span class="keywordflow">for</span> (N=1; N&lt;=2; N++ ) {     <span class="comment">// N=1 IS FOR THE FIRST PART OF EACH COEFFICIENT</span>
<a name="l01957"></a>01957                         <span class="comment">// AND N=2 IS FOR THE SECOND ONE</span>
<a name="l01958"></a>01958                                                                    
<a name="l01959"></a>01959             <span class="keywordflow">for</span> (NN=1; NN&lt;=2; NN++ ) {      <span class="comment">// NN = 1,2 FURTHER SPLITS THE COEFFICIENTS INTO 2 PARTS,</span>
<a name="l01960"></a>01960                             <span class="comment">// TO TAKE INTO ACCOUNT THE SCALE FACTOR DEPENDENCE</span>
<a name="l01961"></a>01961             <span class="keywordflow">if</span> (M == 1) {
<a name="l01962"></a>01962 
<a name="l01963"></a>01963                 FX = -SQPR[J][I][K]*EPR[J][I][K]*CYPI[J][I]*SZRK[J][K];
<a name="l01964"></a>01964                 FY = EPR[J][I][K]*SYPI[J][I]*SZRK[J][K]*ooP[J][I];
<a name="l01965"></a>01965                 FZ = -EPR[J][I][K]*CYPI[J][I]*CZRK[J][K]*ooR[J][K];
<a name="l01966"></a>01966 
<a name="l01967"></a>01967                 <span class="keywordflow">if</span> (N == 1) {
<a name="l01968"></a>01968                 <span class="keywordflow">if</span> (NN == 1) {
<a name="l01969"></a>01969                     HX = FX;
<a name="l01970"></a>01970                     HY = FY;
<a name="l01971"></a>01971                     HZ = FZ;
<a name="l01972"></a>01972                 } <span class="keywordflow">else</span> {
<a name="l01973"></a>01973                     HX = FX*X_SC;
<a name="l01974"></a>01974                     HY = FY*X_SC;
<a name="l01975"></a>01975                     HZ = FZ*X_SC;
<a name="l01976"></a>01976                 }
<a name="l01977"></a>01977                 } <span class="keywordflow">else</span> {
<a name="l01978"></a>01978                 <span class="keywordflow">if</span> (NN == 1) {
<a name="l01979"></a>01979                     HX = FX*CPS;
<a name="l01980"></a>01980                     HY = FY*CPS;
<a name="l01981"></a>01981                     HZ = FZ*CPS;
<a name="l01982"></a>01982                 } <span class="keywordflow">else</span> {
<a name="l01983"></a>01983                     HX = FX*CPS*X_SC;
<a name="l01984"></a>01984                     HY = FY*CPS*X_SC;
<a name="l01985"></a>01985                     HZ = FZ*CPS*X_SC;
<a name="l01986"></a>01986                 }
<a name="l01987"></a>01987                 }
<a name="l01988"></a>01988 
<a name="l01989"></a>01989             } <span class="keywordflow">else</span> {    <span class="comment">//   M.EQ.2</span>
<a name="l01990"></a>01990 
<a name="l01991"></a>01991                 FX = -SPS*SQQS[J][I][K]*EQS[J][I][K]*CYQI[J][I]*CZSK[J][K];
<a name="l01992"></a>01992                 FY = SPS*ooQ[J][I]*EQS[J][I][K]*SYQI[J][I]*CZSK[J][K];
<a name="l01993"></a>01993                 FZ = SPS*ooS[J][K]*EQS[J][I][K]*CYQI[J][I]*SZSK[J][K];
<a name="l01994"></a>01994 
<a name="l01995"></a>01995                 <span class="keywordflow">if</span> (N == 1) {
<a name="l01996"></a>01996                 <span class="keywordflow">if</span> (NN == 1) {
<a name="l01997"></a>01997                     HX = FX;
<a name="l01998"></a>01998                     HY = FY;
<a name="l01999"></a>01999                     HZ = FZ;
<a name="l02000"></a>02000                 } <span class="keywordflow">else</span> {
<a name="l02001"></a>02001                     HX = FX*X_SC;
<a name="l02002"></a>02002                     HY = FY*X_SC;
<a name="l02003"></a>02003                     HZ = FZ*X_SC;
<a name="l02004"></a>02004                 }
<a name="l02005"></a>02005                 } <span class="keywordflow">else</span> {
<a name="l02006"></a>02006                 <span class="keywordflow">if</span> (NN == 1) {
<a name="l02007"></a>02007                     HX = FX*S3PS;
<a name="l02008"></a>02008                     HY = FY*S3PS;
<a name="l02009"></a>02009                     HZ = FZ*S3PS;
<a name="l02010"></a>02010                 } <span class="keywordflow">else</span> {
<a name="l02011"></a>02011                     HX = FX*S3PS*X_SC;
<a name="l02012"></a>02012                     HY = FY*S3PS*X_SC;
<a name="l02013"></a>02013                     HZ = FZ*S3PS*X_SC;
<a name="l02014"></a>02014                 }
<a name="l02015"></a>02015                 }
<a name="l02016"></a>02016 
<a name="l02017"></a>02017             }
<a name="l02018"></a>02018 
<a name="l02019"></a>02019             ++L;
<a name="l02020"></a>02020 
<a name="l02021"></a>02021             <span class="keywordflow">if</span> (M == 1) {
<a name="l02022"></a>02022                 HXR =  HX*CT1[J] + HZ*ST1[J];
<a name="l02023"></a>02023                 HZR = -HX*ST1[J] + HZ*CT1[J];
<a name="l02024"></a>02024             } <span class="keywordflow">else</span> {
<a name="l02025"></a>02025                 HXR =  HX*CT2[J] + HZ*ST2[J];
<a name="l02026"></a>02026                 HZR = -HX*ST2[J] + HZ*CT2[J];
<a name="l02027"></a>02027             }
<a name="l02028"></a>02028                                                                    
<a name="l02029"></a>02029             GX = GX + HXR*A[L];
<a name="l02030"></a>02030             GY = GY + HY *A[L];
<a name="l02031"></a>02031             GZ = GZ + HZR*A[L];
<a name="l02032"></a>02032 
<a name="l02033"></a>02033                                                                    
<a name="l02034"></a>02034             }
<a name="l02035"></a>02035         }
<a name="l02036"></a>02036         }
<a name="l02037"></a>02037     }
<a name="l02038"></a>02038     }
<a name="l02039"></a>02039                                                                    
<a name="l02040"></a>02040     *BX = GX;
<a name="l02041"></a>02041     *BY = GY;
<a name="l02042"></a>02042     *BZ = GZ;
<a name="l02043"></a>02043 
<a name="l02044"></a>02044 
<a name="l02045"></a>02045     <span class="keywordflow">return</span>;
<a name="l02046"></a>02046 
<a name="l02047"></a>02047 }
<a name="l02048"></a>02048 
<a name="l02049"></a>02049 
<a name="l02050"></a>02050 
<a name="l02051"></a><a class="code" href="_tsyg2004_8c.html#2a492ba836369d99dfb597c1675f6a33">02051</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#2a492ba836369d99dfb597c1675f6a33">FULL_RC</a>( <span class="keywordtype">int</span> IOPR, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, 
<a name="l02052"></a>02052     <span class="keywordtype">double</span> *BXSRC, <span class="keywordtype">double</span> *BYSRC, <span class="keywordtype">double</span> *BZSRC, <span class="keywordtype">double</span> *BXPRC, <span class="keywordtype">double</span> *BYPRC,  <span class="keywordtype">double</span> *BZPRC) {
<a name="l02053"></a>02053 
<a name="l02054"></a>02054     <span class="comment">/*  </span>
<a name="l02055"></a>02055 <span class="comment">     *</span>
<a name="l02056"></a>02056 <span class="comment">     *   CALCULATES GSM FIELD COMPONENTS OF THE SYMMETRIC (SRC) AND PARTIAL (PRC) COMPONENTS OF THE RING CURRENT</span>
<a name="l02057"></a>02057 <span class="comment">     *   SRC  PROVIDES A DEPRESSION OF -28 nT AT EARTH</span>
<a name="l02058"></a>02058 <span class="comment">     *   PRC  CORRESPONDS TO THE PRESSURE DIFFERENCE OF 2 nPa BETWEEN MIDNIGHT AND NOON RING CURRENT</span>
<a name="l02059"></a>02059 <span class="comment">     *             PARTICLE PRESSURE AND YIELDS A DEPRESSION OF -17 nT AT X=-6Re</span>
<a name="l02060"></a>02060 <span class="comment">     *</span>
<a name="l02061"></a>02061 <span class="comment">     *   SC_SY AND SC_PR ARE SCALING FACTORS FOR THE SYMMETRIC AND PARTIAL COMPONENTS:</span>
<a name="l02062"></a>02062 <span class="comment">     *          VALUES LARGER THAN 1 RESULT IN SPATIALLY LARGER CURRENTS</span>
<a name="l02063"></a>02063 <span class="comment">     *</span>
<a name="l02064"></a>02064 <span class="comment">     *   PHI IS THE ROTATION ANGLE IN RADIANS OF THE PARTIAL RING CURRENT (MEASURED FROM MIDNIGHT TOWARD DUSK)</span>
<a name="l02065"></a>02065 <span class="comment">     *</span>
<a name="l02066"></a>02066 <span class="comment">     *     IOPR -  A RING CURRENT CALCULATION FLAG (FOR LEAST-SQUARES FITTING ONLY):</span>
<a name="l02067"></a>02067 <span class="comment">     *             IOPR=0 - BOTH SRC AND PRC FIELDS ARE CALCULATED</span>
<a name="l02068"></a>02068 <span class="comment">     *             IOPR=1 - SRC ONLY</span>
<a name="l02069"></a>02069 <span class="comment">     *             IOPR=2 - PRC ONLY</span>
<a name="l02070"></a>02070 <span class="comment">     */</span>
<a name="l02071"></a>02071 
<a name="l02072"></a>02072     <span class="keyword">static</span> <span class="keywordtype">double</span> C_SY[] = { -9e99, 1675.694858,1780.006388,-961.6082149,-1668.914259,
<a name="l02073"></a>02073                     -27.40437029,-107.4169670,27.76189943,92.89740503,-43.92949274,
<a name="l02074"></a>02074                     -403.6444072,6.167161865,298.2779761,-1680.779044,-1780.933039,
<a name="l02075"></a>02075                     964.1861088,1670.988659,27.48864650,107.7809519,-27.84600972,
<a name="l02076"></a>02076                     -93.20691865,44.28496784,404.4537249,-6.281958730,-298.6050952,
<a name="l02077"></a>02077                     -7.971914848,2.017383761,-1.492230168,-1.957411655,-.08525523181,
<a name="l02078"></a>02078                     -.3811813235,.08446716725,.3215044399,-.7141912767,-.9086294596,
<a name="l02079"></a>02079                     .2966677742,-.04736679933,-11.38731325,.1719795189,1.356233066,
<a name="l02080"></a>02080                     .8613438429,-.09143823092,-.2593979098,.04244838338,.06318383319,
<a name="l02081"></a>02081                     -.5861372726,-.03368780733,-.07104470269,-.06909052953,
<a name="l02082"></a>02082                     -60.18659631,-32.87563877,11.76450433,5.891673644,2.562360333,
<a name="l02083"></a>02083                     6.215377232,-1.273945165,-1.864704763,-5.394837143,-8.799382627,
<a name="l02084"></a>02084                     3.743066561,-.7649164511,57.09210569,32.61236511,-11.28688017,
<a name="l02085"></a>02085                     -5.849523392,-2.470635922,-5.961417272,1.230031099,1.793192595,
<a name="l02086"></a>02086                     5.383736074,8.369895153,-3.611544412,.7898988697,7.970609948,
<a name="l02087"></a>02087                     7.981216562,35.16822497,12.45651654,1.689755359,3.678712366,
<a name="l02088"></a>02088                     23.66117284,6.987136092,6.886678677,20.91245928,1.650064156,
<a name="l02089"></a>02089                     3.474068566,.3474715765,.6564043111 };
<a name="l02090"></a>02090                                                                    
<a name="l02091"></a>02091     <span class="keyword">static</span> <span class="keywordtype">double</span> C_PR[] = { -9e99, -64820.58481,-63965.62048,66267.93413,135049.7504,
<a name="l02092"></a>02092                     -36.56316878,124.6614669,56.75637955,-87.56841077,5848.631425,
<a name="l02093"></a>02093                     4981.097722,-6233.712207,-10986.40188,68716.52057,65682.69473,
<a name="l02094"></a>02094                     -69673.32198,-138829.3568,43.45817708,-117.9565488,-62.14836263,
<a name="l02095"></a>02095                     79.83651604,-6211.451069,-5151.633113,6544.481271,11353.03491,
<a name="l02096"></a>02096                     23.72352603,-256.4846331,25.77629189,145.2377187,-4.472639098,
<a name="l02097"></a>02097                     -3.554312754,2.936973114,2.682302576,2.728979958,26.43396781,
<a name="l02098"></a>02098                     -9.312348296,-29.65427726,-247.5855336,-206.9111326,74.25277664,
<a name="l02099"></a>02099                     106.4069993,15.45391072,16.35943569,-5.965177750,-6.079451700,
<a name="l02100"></a>02100                     115.6748385,-35.27377307,-32.28763497,-32.53122151,93.74409310,
<a name="l02101"></a>02101                     84.25677504,-29.23010465,-43.79485175,-6.434679514,-6.620247951,
<a name="l02102"></a>02102                     2.443524317,2.266538956,-43.82903825,6.904117876,12.24289401,
<a name="l02103"></a>02103                     17.62014361,152.3078796,124.5505289,-44.58690290,-63.02382410,
<a name="l02104"></a>02104                     -8.999368955,-9.693774119,3.510930306,3.770949738,-77.96705716,
<a name="l02105"></a>02105                     22.07730961,20.46491655,18.67728847,9.451290614,9.313661792,
<a name="l02106"></a>02106                     644.7620970,418.2515954,7.183754387,35.62128817,19.43180682,
<a name="l02107"></a>02107                     39.57218411,15.69384715,7.123215241,2.300635346,21.90881131,
<a name="l02108"></a>02108                     -.01775839370,.3996346710 };
<a name="l02109"></a>02109 
<a name="l02110"></a>02110     <span class="keywordtype">double</span>  HXSRC, HYSRC, HZSRC, HXPRC, HYPRC, HZPRC, X_SC, FSX, FSY, FSZ;
<a name="l02111"></a>02111     <span class="keywordtype">double</span>  FPX, FPY, FPZ;
<a name="l02112"></a>02112 
<a name="l02113"></a>02113     <a class="code" href="_tsyg2004_8c.html#9d8e16b4209da2c6896cb9fb1531f2fa">SRC_PRC</a>( IOPR, CB_RCPAR.<a class="code" href="struct___c_b___r_c_p_a_r.html#a409bcc6077e57d83a88020286993cce">SC_SY</a>, CB_RCPAR.<a class="code" href="struct___c_b___r_c_p_a_r.html#4973a953d8c39d5be8e952d041b6adf4">SC_AS</a>, CB_RCPAR.<a class="code" href="struct___c_b___r_c_p_a_r.html#38d8f926202c5208f4ea151b52bfe3ef">PHI</a>, PS, X, Y, Z, &amp;HXSRC, &amp;HYSRC, &amp;HZSRC, &amp;HXPRC, &amp;HYPRC, &amp;HZPRC );
<a name="l02114"></a>02114                                                                    
<a name="l02115"></a>02115     X_SC = CB_RCPAR.<a class="code" href="struct___c_b___r_c_p_a_r.html#a409bcc6077e57d83a88020286993cce">SC_SY</a>-1.0;
<a name="l02116"></a>02116     <span class="keywordflow">if</span> ( (IOPR == 0) || (IOPR == 1) ) {
<a name="l02117"></a>02117     <a class="code" href="_tsyg2004_8c.html#ae1fabae2232fcfa073907bc921dbf66">RC_SHIELD</a>( C_SY, PS, X_SC, X, Y, Z, &amp;FSX, &amp;FSY, &amp;FSZ );
<a name="l02118"></a>02118     } <span class="keywordflow">else</span> {
<a name="l02119"></a>02119     FSX = 0.0;
<a name="l02120"></a>02120     FSY = 0.0;
<a name="l02121"></a>02121     FSZ = 0.0;
<a name="l02122"></a>02122     }
<a name="l02123"></a>02123                                                                    
<a name="l02124"></a>02124     X_SC = CB_RCPAR.<a class="code" href="struct___c_b___r_c_p_a_r.html#4973a953d8c39d5be8e952d041b6adf4">SC_AS</a>-1.0;
<a name="l02125"></a>02125     <span class="keywordflow">if</span> ( (IOPR == 0) || (IOPR == 2) ) {
<a name="l02126"></a>02126     <a class="code" href="_tsyg2004_8c.html#ae1fabae2232fcfa073907bc921dbf66">RC_SHIELD</a>( C_PR, PS, X_SC, X, Y, Z, &amp;FPX, &amp;FPY, &amp;FPZ);
<a name="l02127"></a>02127     } <span class="keywordflow">else</span> {
<a name="l02128"></a>02128     FPX = 0.0;
<a name="l02129"></a>02129     FPY = 0.0;
<a name="l02130"></a>02130     FPZ = 0.0;
<a name="l02131"></a>02131     }
<a name="l02132"></a>02132                                                                    
<a name="l02133"></a>02133     *BXSRC = HXSRC + FSX;
<a name="l02134"></a>02134     *BYSRC = HYSRC + FSY;
<a name="l02135"></a>02135     *BZSRC = HZSRC + FSZ;
<a name="l02136"></a>02136 
<a name="l02137"></a>02137     *BXPRC = HXPRC + FPX;
<a name="l02138"></a>02138     *BYPRC = HYPRC + FPY;
<a name="l02139"></a>02139     *BZPRC = HZPRC + FPZ;
<a name="l02140"></a>02140 
<a name="l02141"></a>02141     <span class="keywordflow">return</span>;
<a name="l02142"></a>02142 }
<a name="l02143"></a>02143 
<a name="l02144"></a>02144 
<a name="l02145"></a>02145 
<a name="l02146"></a><a class="code" href="_tsyg2004_8c.html#9d8e16b4209da2c6896cb9fb1531f2fa">02146</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#9d8e16b4209da2c6896cb9fb1531f2fa">SRC_PRC</a>( <span class="keywordtype">int</span> IOPR, <span class="keywordtype">double</span> SC_SY, <span class="keywordtype">double</span> SC_PR, <span class="keywordtype">double</span> PHI, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, 
<a name="l02147"></a>02147         <span class="keywordtype">double</span> *BXSRC, <span class="keywordtype">double</span> *BYSRC, <span class="keywordtype">double</span> *BZSRC, <span class="keywordtype">double</span> *BXPRC, <span class="keywordtype">double</span> *BYPRC, <span class="keywordtype">double</span> *BZPRC) {
<a name="l02148"></a>02148     <span class="comment">/*</span>
<a name="l02149"></a>02149 <span class="comment">     *   RETURNS FIELD COMPONENTS FROM A MODEL RING CURRENT, INCLUDING ITS SYMMETRIC PART</span>
<a name="l02150"></a>02150 <span class="comment">     *     AND A PARTIAL RING CURRENT, CLOSED VIA BIRKELAND CURRENTS. BASED ON RESULTS, DESCRIBED</span>
<a name="l02151"></a>02151 <span class="comment">     *     IN A PAPER "MODELING THE INNER MAGNETOSPHERE: ASYMMETRIC RING CURRENT AND REGION 2</span>
<a name="l02152"></a>02152 <span class="comment">     *     BIRKELAND CURRENTS REVISITED" (JGR, DEC.2000).</span>
<a name="l02153"></a>02153 <span class="comment">     *</span>
<a name="l02154"></a>02154 <span class="comment">     *     IOPR -  A RING CURRENT CALCULATION FLAG (FOR LEAST-SQUARES FITTING ONLY):</span>
<a name="l02155"></a>02155 <span class="comment">     *             IOPR=0 - BOTH SRC AND PRC FIELDS ARE CALCULATED</span>
<a name="l02156"></a>02156 <span class="comment">     *             IOPR=1 - SRC ONLY</span>
<a name="l02157"></a>02157 <span class="comment">     *             IOPR=2 - PRC ONLY</span>
<a name="l02158"></a>02158 <span class="comment">     *</span>
<a name="l02159"></a>02159 <span class="comment">     *     SC_SY &amp;  SC_PR ARE SCALE FACTORS FOR THE ABOVE COMPONENTS;  TAKING SC&lt;1 OR SC&gt;1 MAKES THE CURRENTS</span>
<a name="l02160"></a>02160 <span class="comment">     *                      SHRINK OR EXPAND, RESPECTIVELY.</span>
<a name="l02161"></a>02161 <span class="comment">     *</span>
<a name="l02162"></a>02162 <span class="comment">     *   PHI IS THE ROTATION ANGLE (RADIANS) OF THE PARTIAL RING CURRENT (MEASURED FROM MIDNIGHT TOWARD DUSK)</span>
<a name="l02163"></a>02163 <span class="comment">     *</span>
<a name="l02164"></a>02164 <span class="comment">     *</span>
<a name="l02165"></a>02165 <span class="comment">     *   1.  TRANSFORM TO TILTED COORDINATES (i.e., SM coordinates):</span>
<a name="l02166"></a>02166 <span class="comment">     */</span>
<a name="l02167"></a>02167 
<a name="l02168"></a>02168     <span class="keywordtype">double</span>  CPS, SPS, XT, XTS, ooSC_SY, YTS, ZTS, ZT, ooSC_PR, XTA, YTA, ZTA, BXS, BYS, BZS;
<a name="l02169"></a>02169     <span class="keywordtype">double</span>  BXA_S, BYA_S, BZA_S, CP, SP, XR, YR, BXA_QR, BYA_QR, BZA_Q, BXA_Q, BYA_Q, BXP, BYP, BZP;
<a name="l02170"></a>02170 
<a name="l02171"></a>02171 
<a name="l02172"></a>02172     <span class="comment">//CPS = cos(PS); SPS = sin(PS);</span>
<a name="l02173"></a>02173     CPS = <a class="code" href="_tsyg2004_8c.html#98e0e08bb8a65f90813e5adb482aeb2c">cos_psi</a>; SPS = <a class="code" href="_tsyg2004_8c.html#5b35fcda1a15310fa7b7e3e242431de3">sin_psi</a>;
<a name="l02174"></a>02174                                                                      
<a name="l02175"></a>02175     XT = X*CPS - Z*SPS;
<a name="l02176"></a>02176     ZT = Z*CPS + X*SPS;
<a name="l02177"></a>02177 
<a name="l02178"></a>02178 
<a name="l02179"></a>02179     <span class="comment">/* </span>
<a name="l02180"></a>02180 <span class="comment">     *     2.  SCALE THE COORDINATES FOR THE SYMMETRIC AND PARTIAL RC COMPONENTS:</span>
<a name="l02181"></a>02181 <span class="comment">     */</span>
<a name="l02182"></a>02182     ooSC_SY = 1.0/SC_SY;
<a name="l02183"></a>02183     XTS = XT*ooSC_SY;    <span class="comment">//  SYMMETRIC</span>
<a name="l02184"></a>02184     YTS = Y *ooSC_SY;
<a name="l02185"></a>02185     ZTS = ZT*ooSC_SY;
<a name="l02186"></a>02186 
<a name="l02187"></a>02187     ooSC_PR = 1.0/SC_PR;
<a name="l02188"></a>02188     XTA = XT*ooSC_PR;    <span class="comment">//  PARTIAL</span>
<a name="l02189"></a>02189     YTA = Y *ooSC_PR;
<a name="l02190"></a>02190     ZTA = ZT*ooSC_PR;
<a name="l02191"></a>02191 
<a name="l02192"></a>02192 
<a name="l02193"></a>02193     <span class="comment">/* </span>
<a name="l02194"></a>02194 <span class="comment">     *     3.  CALCULATE COMPONENTS OF THE TOTAL FIELD IN THE TILTED (SOLAR-MAGNETIC) COORDINATE SYSTEM:</span>
<a name="l02195"></a>02195 <span class="comment">     *  </span>
<a name="l02196"></a>02196 <span class="comment">     *  </span>
<a name="l02197"></a>02197 <span class="comment">     *      3a. SYMMETRIC FIELD:</span>
<a name="l02198"></a>02198 <span class="comment">     */</span>
<a name="l02199"></a>02199     <span class="keywordflow">if</span> (IOPR &lt;= 1)          <a class="code" href="_tsyg2004_8c.html#16ec50640c104c5c2a57ef6a51b21f01">RC_SYMM</a>( XTS, YTS, ZTS, &amp;BXS, &amp;BYS, &amp;BZS);
<a name="l02200"></a>02200     <span class="keywordflow">if</span> ( (IOPR == 0) || (IOPR == 2) )   <a class="code" href="_tsyg2004_8c.html#a49661b45ed199138df07d1806ad7240">PRC_SYMM</a>( XTA, YTA, ZTA, &amp;BXA_S, &amp;BYA_S, &amp;BZA_S);
<a name="l02201"></a>02201                                                                      
<a name="l02202"></a>02202     <span class="comment">/*     3b. ROTATE THE SCALED SM COORDINATES BY PHI AROUND ZSM AXIS AND CALCULATE QUADRUPOLE PRC FIELD</span>
<a name="l02203"></a>02203 <span class="comment">     *         IN THOSE COORDS:</span>
<a name="l02204"></a>02204 <span class="comment">     */</span>
<a name="l02205"></a>02205     CP = cos(PHI);
<a name="l02206"></a>02206     SP = sin(PHI);
<a name="l02207"></a>02207     XR = XTA*CP - YTA*SP;
<a name="l02208"></a>02208     YR = XTA*SP + YTA*CP;
<a name="l02209"></a>02209 
<a name="l02210"></a>02210     <span class="keywordflow">if</span> ( (IOPR == 0) || (IOPR == 2) )  <a class="code" href="_tsyg2004_8c.html#7d3132f7a6ed31b467740063133da1fe">PRC_QUAD</a>( XR, YR, ZTA, &amp;BXA_QR, &amp;BYA_QR, &amp;BZA_Q);
<a name="l02211"></a>02211                                                                      
<a name="l02212"></a>02212     <span class="comment">/*     3c. TRANSFORM THE QUADRUPOLE FIELD COMPONENTS BACK TO THE SM COORDS:</span>
<a name="l02213"></a>02213 <span class="comment">     */</span>
<a name="l02214"></a>02214     BXA_Q =  BXA_QR*CP + BYA_QR*SP;
<a name="l02215"></a>02215     BYA_Q = -BXA_QR*SP + BYA_QR*CP;
<a name="l02216"></a>02216                                                                      
<a name="l02217"></a>02217     <span class="comment">/*     3d. FIND THE TOTAL FIELD OF PRC (SYMM.+QUADR.) IN THE SM COORDS:</span>
<a name="l02218"></a>02218 <span class="comment">     */</span>
<a name="l02219"></a>02219     BXP = BXA_S + BXA_Q;
<a name="l02220"></a>02220     BYP = BYA_S + BYA_Q;
<a name="l02221"></a>02221     BZP = BZA_S + BZA_Q;
<a name="l02222"></a>02222 
<a name="l02223"></a>02223 
<a name="l02224"></a>02224 
<a name="l02225"></a>02225     <span class="comment">/* </span>
<a name="l02226"></a>02226 <span class="comment">     *     4.  TRANSFORM THE FIELDS OF BOTH PARTS OF THE RING CURRENT BACK TO THE GSM SYSTEM:</span>
<a name="l02227"></a>02227 <span class="comment">     */</span>
<a name="l02228"></a>02228     *BXSRC = BXS*CPS+BZS*SPS;   <span class="comment">//     SYMMETRIC RC</span>
<a name="l02229"></a>02229     *BYSRC = BYS;
<a name="l02230"></a>02230     *BZSRC = BZS*CPS-BXS*SPS;
<a name="l02231"></a>02231 
<a name="l02232"></a>02232     *BXPRC = BXP*CPS+BZP*SPS;   <span class="comment">//     PARTIAL RC</span>
<a name="l02233"></a>02233     *BYPRC = BYP;
<a name="l02234"></a>02234     *BZPRC = BZP*CPS-BXP*SPS;
<a name="l02235"></a>02235 
<a name="l02236"></a>02236     <span class="keywordflow">return</span>;
<a name="l02237"></a>02237 
<a name="l02238"></a>02238 }
<a name="l02239"></a>02239 
<a name="l02240"></a>02240 
<a name="l02241"></a>02241 
<a name="l02242"></a><a class="code" href="_tsyg2004_8c.html#16ec50640c104c5c2a57ef6a51b21f01">02242</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#16ec50640c104c5c2a57ef6a51b21f01">RC_SYMM</a>( <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ){
<a name="l02243"></a>02243 
<a name="l02244"></a>02244     <span class="keywordtype">double</span>  DS=1e-2, DC=0.99994999875, D=1e-4, DRD=5e3;     <span class="comment">//  DS=SIN(THETA) AT THE BOUNDARY OF THE LINEARITY</span>
<a name="l02245"></a>02245                                 <span class="comment">//  REGION; DC = SQRT(1-DS**2);  DRD=1/(2*D)</span>
<a name="l02246"></a>02246 
<a name="l02247"></a>02247     <span class="keywordtype">double</span>  RHO2, R2, R, ooR, RP, RM, SINT, COST, A, DARDR, FXY, THETA;
<a name="l02248"></a>02248     <span class="keywordtype">double</span>  TP, TM, SINTP, SINTM, COSTP, COSTM, BR, BT;
<a name="l02249"></a>02249 
<a name="l02250"></a>02250     RHO2 = X*X+Y*Y;
<a name="l02251"></a>02251     R2   = RHO2+Z*Z;
<a name="l02252"></a>02252     R    = sqrt(R2);
<a name="l02253"></a>02253     ooR  = 1.0/R;
<a name="l02254"></a>02254     RP   = R+D;
<a name="l02255"></a>02255     RM   = R-D;
<a name="l02256"></a>02256     SINT = sqrt(RHO2)*ooR;
<a name="l02257"></a>02257     COST = Z*ooR;
<a name="l02258"></a>02258     
<a name="l02259"></a>02259     <span class="keywordflow">if</span> ( SINT &lt; DS ) {      <span class="comment">// TOO CLOSE TO THE Z-AXIS; USING A LINEAR APPROXIMATION A_PHI~SINT,</span>
<a name="l02260"></a>02260                 <span class="comment">// TO AVOID THE SINGULARITY PROBLEM</span>
<a name="l02261"></a>02261     A = <a class="code" href="_tsyg2004_8c.html#55f2b5b45100a3e191f3423e007d7174">AP</a>(R,DS,DC)/DS;
<a name="l02262"></a>02262     DARDR = (RP*<a class="code" href="_tsyg2004_8c.html#55f2b5b45100a3e191f3423e007d7174">AP</a>(RP,DS,DC)-RM*<a class="code" href="_tsyg2004_8c.html#55f2b5b45100a3e191f3423e007d7174">AP</a>(RM,DS,DC))*DRD;
<a name="l02263"></a>02263     FXY   = Z*(2.0*A-DARDR)/(R*R2);
<a name="l02264"></a>02264     *BX    = FXY*X;
<a name="l02265"></a>02265     *BY    = FXY*Y;
<a name="l02266"></a>02266     *BZ    = (2.0*A*COST*COST+DARDR*SINT*SINT)*ooR;
<a name="l02267"></a>02267                                                                      
<a name="l02268"></a>02268     } <span class="keywordflow">else</span> {
<a name="l02269"></a>02269                                                                      
<a name="l02270"></a>02270     THETA = atan2(SINT,COST);
<a name="l02271"></a>02271     TP    = THETA+D;
<a name="l02272"></a>02272     TM    = THETA-D;
<a name="l02273"></a>02273     SINTP = sin(TP);
<a name="l02274"></a>02274     SINTM = sin(TM);
<a name="l02275"></a>02275     COSTP = cos(TP);
<a name="l02276"></a>02276     COSTM = cos(TM);
<a name="l02277"></a>02277     BR    = (SINTP*<a class="code" href="_tsyg2004_8c.html#55f2b5b45100a3e191f3423e007d7174">AP</a>(R,SINTP,COSTP)-SINTM*<a class="code" href="_tsyg2004_8c.html#55f2b5b45100a3e191f3423e007d7174">AP</a>(R,SINTM,COSTM))/(R*SINT)*DRD;
<a name="l02278"></a>02278     BT    = (RM*<a class="code" href="_tsyg2004_8c.html#55f2b5b45100a3e191f3423e007d7174">AP</a>(RM,SINT,COST)-RP*<a class="code" href="_tsyg2004_8c.html#55f2b5b45100a3e191f3423e007d7174">AP</a>(RP,SINT,COST))/R*DRD;
<a name="l02279"></a>02279     FXY   = (BR+BT*COST/SINT)/R;
<a name="l02280"></a>02280     *BX    = FXY*X;
<a name="l02281"></a>02281     *BY    = FXY*Y;
<a name="l02282"></a>02282     *BZ    = BR*COST-BT*SINT;
<a name="l02283"></a>02283 
<a name="l02284"></a>02284     }
<a name="l02285"></a>02285                                                                      
<a name="l02286"></a>02286     <span class="keywordflow">return</span>;
<a name="l02287"></a>02287 
<a name="l02288"></a>02288 }
<a name="l02289"></a>02289 
<a name="l02290"></a>02290 
<a name="l02291"></a>02291 
<a name="l02292"></a><a class="code" href="_tsyg2004_8c.html#55f2b5b45100a3e191f3423e007d7174">02292</a> <span class="keywordtype">double</span>  <a class="code" href="_tsyg2004_8c.html#55f2b5b45100a3e191f3423e007d7174">AP</a>( <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> SINT, <span class="keywordtype">double</span> COST) {
<a name="l02293"></a>02293 
<a name="l02294"></a>02294     <span class="comment">/*  </span>
<a name="l02295"></a>02295 <span class="comment">     *        Calculates azimuthal component of the vector potential of the symmetric</span>
<a name="l02296"></a>02296 <span class="comment">     *    part of the model ring current.</span>
<a name="l02297"></a>02297 <span class="comment">     */</span>  
<a name="l02298"></a>02298     <span class="keywordtype">int</span>     PROX;   <span class="comment">// INDICATES WHETHER WE ARE TOO CLOSE TO THE AXIS OF SYMMETRY, WHERE THE INVERSION</span>
<a name="l02299"></a>02299             <span class="comment">//                  OF DIPOLAR COORDINATES BECOMES INACCURATE</span>
<a name="l02300"></a>02300 
<a name="l02301"></a>02301     <span class="keywordtype">double</span>  A1=-563.3722359,A2=425.0891691,RRC1=4.150588549,DD1=2.266150226;
<a name="l02302"></a>02302     <span class="keywordtype">double</span>  RRC2=3.334503403,DD2=3.079071195,P1=.02602428295,R1=8.937790598,DR1=3.327934895;
<a name="l02303"></a>02303     <span class="keywordtype">double</span>  DLA1=4487061833,P2=.09125832351,R2=6.243029867,DR2=1.750145910,DLA2=.4181957162;
<a name="l02304"></a>02304     <span class="keywordtype">double</span>  P3=.06106691992,R3=2.079908581,DR3=.6828548533;
<a name="l02305"></a>02305     <span class="keywordtype">double</span>  ooR, ooR2, SINT1, COST1, ALPHA, GAMMA, RR1oDR1, RR1oDR1_2, RR2oDR2, RR2oDR2_2;
<a name="l02306"></a>02306     <span class="keywordtype">double</span>  RR3oDR3, RR3oDR3_2, COST1oDLA1, COST1oDLA1_2, COST1oDLA2, COST1oDLA2_2, ARG1;
<a name="l02307"></a>02307     <span class="keywordtype">double</span>  ARG2, ARG3, DEXP1, DEXP2, DEXP3, ALPHA_S, ALPHA_S2, GAMMA_S, GAMMAS2, ALSQH2;
<a name="l02308"></a>02308     <span class="keywordtype">double</span>  ALSQH, F, Q, C, G, RS, COSTS, SINTS, RHOS, RHOS2, ZS, RRC1pRHOS, RRC1pRHOS2;
<a name="l02309"></a>02309     <span class="keywordtype">double</span>  P, XK2, XK, XKRHO12, XK2S, DL, ELK, ELE, APHI1, RRC2pRHOS, RRC2pRHOS2, APHI2, Result;
<a name="l02310"></a>02310 
<a name="l02311"></a>02311     ooR = 1.0/R;
<a name="l02312"></a>02312     ooR2 = ooR*ooR;
<a name="l02313"></a>02313 
<a name="l02314"></a>02314     PROX  = <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02315"></a>02315     SINT1 = SINT;
<a name="l02316"></a>02316     COST1 = COST;
<a name="l02317"></a>02317     <span class="keywordflow">if</span> (SINT1 &lt; 1e-2) {         <span class="comment">// TOO CLOSE TO Z-AXIS;  USE LINEAR INTERPOLATION BETWEEN SINT=0 &amp; SINT=0.01</span>
<a name="l02318"></a>02318     SINT1 = 1e-2;
<a name="l02319"></a>02319     COST1 = .99994999875;
<a name="l02320"></a>02320     PROX  = <a class="code" href="_lgm___c_trans_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02321"></a>02321     }
<a name="l02322"></a>02322                                                                                                                                               
<a name="l02323"></a>02323     ALPHA = SINT1*SINT1*ooR;        <span class="comment">// R,THETA -&gt; ALPHA,GAMMA</span>
<a name="l02324"></a>02324     GAMMA = COST1*ooR2;
<a name="l02325"></a>02325 
<a name="l02326"></a>02326                                                                                                                                               
<a name="l02327"></a>02327     RR1oDR1 = ((R-R1)/DR1); RR1oDR1_2 = RR1oDR1*RR1oDR1;
<a name="l02328"></a>02328     RR2oDR2 = ((R-R2)/DR2); RR2oDR2_2 = RR2oDR2*RR2oDR2;
<a name="l02329"></a>02329     RR3oDR3 = ((R-R3)/DR3); RR3oDR3_2 = RR3oDR3*RR3oDR3;
<a name="l02330"></a>02330     COST1oDLA1 = COST1/DLA1; COST1oDLA1_2 = COST1oDLA1*COST1oDLA1;
<a name="l02331"></a>02331     COST1oDLA2 = COST1/DLA2; COST1oDLA2_2 = COST1oDLA2*COST1oDLA2;
<a name="l02332"></a>02332     ARG1 = -RR1oDR1_2-COST1oDLA1_2;
<a name="l02333"></a>02333     ARG2 = -RR2oDR2_2-COST1oDLA2_2;
<a name="l02334"></a>02334     ARG3 = -RR3oDR3_2;
<a name="l02335"></a>02335     
<a name="l02336"></a>02336     DEXP1 = (ARG1 &lt; -500.0) ? 0.0 : exp(ARG1); <span class="comment">// TO PREVENT "FLOATING UNDERFLOW" CRASHES</span>
<a name="l02337"></a>02337     DEXP2 = (ARG2 &lt; -500.0) ? 0.0 : exp(ARG2);
<a name="l02338"></a>02338     DEXP3 = (ARG3 &lt; -500.0) ? 0.0 : exp(ARG3);
<a name="l02339"></a>02339                                                                                                                                               
<a name="l02340"></a>02340     ALPHA_S = ALPHA*(1.0+P1*DEXP1+P2*DEXP2+P3*DEXP3);   <span class="comment">// ALPHA -&gt; ALPHA_S  (DEFORMED)</span>
<a name="l02341"></a>02341     ALPHA_S2 = ALPHA_S*ALPHA_S;
<a name="l02342"></a>02342                                                                                                                                               
<a name="l02343"></a>02343 
<a name="l02344"></a>02344     GAMMA_S = GAMMA;
<a name="l02345"></a>02345     GAMMAS2 = GAMMA_S*GAMMA_S;
<a name="l02346"></a>02346 
<a name="l02347"></a>02347 
<a name="l02348"></a>02348 
<a name="l02349"></a>02349                                                                                                                                               
<a name="l02350"></a>02350                                                                                                                                               
<a name="l02351"></a>02351     ALSQH = 0.5*ALPHA_S2;       <span class="comment">//  ALPHA_S,GAMMA_S -&gt; RS,SINTS,COSTS</span>
<a name="l02352"></a>02352     ALSQH2 = ALSQH*ALSQH;
<a name="l02353"></a>02353     F = 64.0/27.0*GAMMAS2 + ALSQH2;
<a name="l02354"></a>02354     Q = pow( sqrt(F)+ALSQH, 1.0/3.0 );
<a name="l02355"></a>02355     C = Q-4.0*pow( GAMMAS2, 1.0/3.0 )/(3.0*Q);
<a name="l02356"></a>02356 
<a name="l02357"></a>02357 
<a name="l02358"></a>02358 
<a name="l02359"></a>02359     <span class="keywordflow">if</span> (C &lt; 0.0) C = 0.0;
<a name="l02360"></a>02360 
<a name="l02361"></a>02361     G  = sqrt(C*C+4.0*pow( GAMMAS2, 1.0/3.0 ));
<a name="l02362"></a>02362     RS = 4.0/((sqrt(2.0*G-C)+sqrt(C))*(G+C));
<a name="l02363"></a>02363     COSTS = GAMMA_S*RS*RS;
<a name="l02364"></a>02364     SINTS = sqrt(1.0-COSTS*COSTS);
<a name="l02365"></a>02365     RHOS  = RS*SINTS;
<a name="l02366"></a>02366     RHOS2 = RHOS*RHOS;
<a name="l02367"></a>02367     ZS    = RS*COSTS;
<a name="l02368"></a>02368 
<a name="l02369"></a>02369 
<a name="l02370"></a>02370     <span class="comment">/*</span>
<a name="l02371"></a>02371 <span class="comment">     *    1st loop:</span>
<a name="l02372"></a>02372 <span class="comment">     */</span>  
<a name="l02373"></a>02373                                                                                                                                               
<a name="l02374"></a>02374     RRC1pRHOS = RRC1+RHOS; RRC1pRHOS2 = RRC1pRHOS*RRC1pRHOS;
<a name="l02375"></a>02375     P   = RRC1pRHOS2+ZS*ZS+DD1*DD1;
<a name="l02376"></a>02376     XK2 = 4.0*RRC1*RHOS/P;
<a name="l02377"></a>02377     XK  = sqrt(XK2);
<a name="l02378"></a>02378     XKRHO12 = XK*sqrt(RHOS);
<a name="l02379"></a>02379  
<a name="l02380"></a>02380     XK2S = 1.0-XK2;
<a name="l02381"></a>02381     DL   = log(1.0/XK2S);  <span class="comment">//CHECK was DLOG in FORTRAN - MGH</span>
<a name="l02382"></a>02382     ELK  = 1.38629436112+XK2S*(0.09666344259+XK2S*(0.03590092383+
<a name="l02383"></a>02383         XK2S*(0.03742563713+XK2S*0.01451196212))) +DL*
<a name="l02384"></a>02384         (0.5+XK2S*(0.12498593597+XK2S*(0.06880248576+
<a name="l02385"></a>02385         XK2S*(0.03328355346+XK2S*0.00441787012))));
<a name="l02386"></a>02386     ELE  = 1.0+XK2S*(0.44325141463+XK2S*(0.0626060122+XK2S*
<a name="l02387"></a>02387         (0.04757383546+XK2S*0.01736506451))) +DL*
<a name="l02388"></a>02388         XK2S*(0.2499836831+XK2S*(0.09200180037+XK2S*
<a name="l02389"></a>02389         (0.04069697526+XK2S*0.00526449639)));
<a name="l02390"></a>02390  
<a name="l02391"></a>02391     APHI1 = ((1.0-XK2*0.5)*ELK-ELE)/XKRHO12;
<a name="l02392"></a>02392 
<a name="l02393"></a>02393 
<a name="l02394"></a>02394 
<a name="l02395"></a>02395     <span class="comment">/*</span>
<a name="l02396"></a>02396 <span class="comment">     *    2nd loop:</span>
<a name="l02397"></a>02397 <span class="comment">     */</span>  
<a name="l02398"></a>02398                                                                                                                                               
<a name="l02399"></a>02399     RRC2pRHOS = RRC2+RHOS; RRC2pRHOS2 = RRC2pRHOS*RRC2pRHOS;
<a name="l02400"></a>02400     P   = RRC2pRHOS2+ZS*ZS+DD2*DD2;
<a name="l02401"></a>02401     XK2 = 4.0*RRC2*RHOS/P;
<a name="l02402"></a>02402     XK  = sqrt(XK2);
<a name="l02403"></a>02403     XKRHO12 = XK*sqrt(RHOS);
<a name="l02404"></a>02404  
<a name="l02405"></a>02405     XK2S = 1.0-XK2;
<a name="l02406"></a>02406     DL   = log(1.0/XK2S);   <span class="comment">//CHECK was DLOG in FORTRAN - MGH</span>
<a name="l02407"></a>02407     ELK  = 1.38629436112+XK2S*(0.09666344259+XK2S*(0.03590092383+
<a name="l02408"></a>02408         XK2S*(0.03742563713+XK2S*0.01451196212))) +DL*
<a name="l02409"></a>02409         (0.5+XK2S*(0.12498593597+XK2S*(0.06880248576+
<a name="l02410"></a>02410         XK2S*(0.03328355346+XK2S*0.00441787012))));
<a name="l02411"></a>02411     ELE  = 1.0+XK2S*(0.44325141463+XK2S*(0.0626060122+XK2S*
<a name="l02412"></a>02412         (0.04757383546+XK2S*0.01736506451))) +DL*
<a name="l02413"></a>02413         XK2S*(0.2499836831+XK2S*(0.09200180037+XK2S*
<a name="l02414"></a>02414         (0.04069697526+XK2S*0.00526449639)));
<a name="l02415"></a>02415  
<a name="l02416"></a>02416     APHI2 = ((1.0-XK2*0.5)*ELK-ELE)/XKRHO12;
<a name="l02417"></a>02417                                                                                                                                               
<a name="l02418"></a>02418     Result = A1*APHI1+A2*APHI2;
<a name="l02419"></a>02419     <span class="keywordflow">if</span> (PROX) Result *= SINT/SINT1;     <span class="comment">// LINEAR INTERPOLATION, IF TOO CLOSE TO THE Z-AXIS</span>
<a name="l02420"></a>02420  
<a name="l02421"></a>02421 
<a name="l02422"></a>02422     <span class="keywordflow">return</span>( Result ) ;
<a name="l02423"></a>02423 
<a name="l02424"></a>02424 
<a name="l02425"></a>02425 }
<a name="l02426"></a>02426 
<a name="l02427"></a>02427 
<a name="l02428"></a><a class="code" href="_tsyg2004_8c.html#a49661b45ed199138df07d1806ad7240">02428</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#a49661b45ed199138df07d1806ad7240">PRC_SYMM</a>( <span class="keywordtype">double</span> X,<span class="keywordtype">double</span> Y,<span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ ) {
<a name="l02429"></a>02429 
<a name="l02430"></a>02430     <span class="keywordtype">double</span>  DS=1e-2, DC=0.99994999875, D=1e-4, DRD=5e3; <span class="comment">// DS=SIN(THETA) AT THE BOUNDARY OF THE LINEARITY</span>
<a name="l02431"></a>02431                                 <span class="comment">//         REGION; DC=SQRT(1-DS**2);  DRD=1/(2*D)</span>
<a name="l02432"></a>02432     <span class="keywordtype">double</span>  RHO2, R2, R, ooR, RP, RM, SINT, COST, A, DARDR, FXY, THETA;
<a name="l02433"></a>02433     <span class="keywordtype">double</span>  TP, TM, SINTP, SINTM, COSTP, COSTM, BR, BT;
<a name="l02434"></a>02434 
<a name="l02435"></a>02435     RHO2 = X*X+Y*Y;
<a name="l02436"></a>02436     R2   = RHO2+Z*Z;
<a name="l02437"></a>02437     R    = sqrt(R2); ooR = 1.0/R;
<a name="l02438"></a>02438     RP   = R+D;
<a name="l02439"></a>02439     RM   = R-D;
<a name="l02440"></a>02440     SINT = sqrt(RHO2)*ooR;
<a name="l02441"></a>02441     COST = Z*ooR;
<a name="l02442"></a>02442                                                                                                                                               
<a name="l02443"></a>02443     <span class="keywordflow">if</span> (SINT &lt; DS) {    <span class="comment">//  TOO CLOSE TO THE Z-AXIS; USING A LINEAR APPROXIMATION A_PHI~SINT,</span>
<a name="l02444"></a>02444             <span class="comment">//  TO AVOID THE SINGULARITY PROBLEM</span>
<a name="l02445"></a>02445     A     = <a class="code" href="_tsyg2004_8c.html#184ae8e5e4f65974829d3ff56683be12">APPRC</a>(R,DS,DC)/DS;
<a name="l02446"></a>02446     DARDR = (RP*<a class="code" href="_tsyg2004_8c.html#184ae8e5e4f65974829d3ff56683be12">APPRC</a>(RP,DS,DC)-RM*<a class="code" href="_tsyg2004_8c.html#184ae8e5e4f65974829d3ff56683be12">APPRC</a>(RM,DS,DC))*DRD;
<a name="l02447"></a>02447     FXY   = Z*(2.0*A-DARDR)/(R*R2);
<a name="l02448"></a>02448     *BX    = FXY*X;
<a name="l02449"></a>02449     *BY    = FXY*Y;
<a name="l02450"></a>02450     *BZ    = (2.0*A*COST*COST+DARDR*SINT*SINT)*ooR;
<a name="l02451"></a>02451                                                                                                                                               
<a name="l02452"></a>02452     } <span class="keywordflow">else</span> {
<a name="l02453"></a>02453                                                                                                                                               
<a name="l02454"></a>02454     THETA = atan2(SINT,COST);
<a name="l02455"></a>02455     TP    = THETA+D;
<a name="l02456"></a>02456     TM    = THETA-D;
<a name="l02457"></a>02457     SINTP = sin(TP);
<a name="l02458"></a>02458     SINTM = sin(TM);
<a name="l02459"></a>02459     COSTP = cos(TP);
<a name="l02460"></a>02460     COSTM = cos(TM);
<a name="l02461"></a>02461     BR    = (SINTP*<a class="code" href="_tsyg2004_8c.html#184ae8e5e4f65974829d3ff56683be12">APPRC</a>(R,SINTP,COSTP)-SINTM*<a class="code" href="_tsyg2004_8c.html#184ae8e5e4f65974829d3ff56683be12">APPRC</a>(R,SINTM,COSTM))/(R*SINT)*DRD;
<a name="l02462"></a>02462     BT    = (RM*<a class="code" href="_tsyg2004_8c.html#184ae8e5e4f65974829d3ff56683be12">APPRC</a>(RM,SINT,COST)-RP*<a class="code" href="_tsyg2004_8c.html#184ae8e5e4f65974829d3ff56683be12">APPRC</a>(RP,SINT,COST))*ooR*DRD;
<a name="l02463"></a>02463     FXY   = (BR+BT*COST/SINT)*ooR;
<a name="l02464"></a>02464     *BX    = FXY*X;
<a name="l02465"></a>02465     *BY    = FXY*Y;
<a name="l02466"></a>02466     *BZ    = BR*COST-BT*SINT;
<a name="l02467"></a>02467                                                                                                                                               
<a name="l02468"></a>02468     }
<a name="l02469"></a>02469                                                                                                                                               
<a name="l02470"></a>02470     <span class="keywordflow">return</span>;
<a name="l02471"></a>02471 
<a name="l02472"></a>02472 }
<a name="l02473"></a>02473 
<a name="l02474"></a>02474 
<a name="l02475"></a>02475 
<a name="l02476"></a><a class="code" href="_tsyg2004_8c.html#184ae8e5e4f65974829d3ff56683be12">02476</a> <span class="keywordtype">double</span>  <a class="code" href="_tsyg2004_8c.html#184ae8e5e4f65974829d3ff56683be12">APPRC</a>( <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> SINT, <span class="keywordtype">double</span> COST) {
<a name="l02477"></a>02477 
<a name="l02478"></a>02478     <span class="comment">/*  </span>
<a name="l02479"></a>02479 <span class="comment">     *        Calculates azimuthal component of the vector potential of the symmetric</span>
<a name="l02480"></a>02480 <span class="comment">     *    part of the model PARTIAL ring current.</span>
<a name="l02481"></a>02481 <span class="comment">     */</span>  
<a name="l02482"></a>02482     <span class="keywordtype">int</span>     PROX;
<a name="l02483"></a>02483 
<a name="l02484"></a>02484 
<a name="l02485"></a>02485 
<a name="l02486"></a>02486     <span class="keywordtype">double</span> A1=-80.11202281, A2=12.58246758, RRC1=6.560486035, DD1=1.930711037, RRC2=3.827208119;
<a name="l02487"></a>02487     <span class="keywordtype">double</span> DD2=.7789990504, P1=.3058309043, ALPHA1=.1817139853, DAL1=.1257532909, BETA1=3.422509402;
<a name="l02488"></a>02488     <span class="keywordtype">double</span> DG1=.04742939676, P2=-4.800458958, ALPHA2=-.02845643596, DAL2=.2188114228, BETA2=2.545944574;
<a name="l02489"></a>02489     <span class="keywordtype">double</span> DG2=.00813272793, BETA3=.35868244, P3=103.1601001, ALPHA3=-.00764731187, DAL3=.1046487459;
<a name="l02490"></a>02490     <span class="keywordtype">double</span> BETA4=2.958863546, DG3=.01172314188, BETA5=.4382872938, Q0=.01134908150, Q1=14.51339943;
<a name="l02491"></a>02491     <span class="keywordtype">double</span> ALPHA4=.2647095287, DAL4=.07091230197, DG4=.01512963586, Q2=6.861329631, ALPHA5=.1677400816;
<a name="l02492"></a>02492     <span class="keywordtype">double</span> DAL5=.04433648846, DG5=.05553741389, BETA6=.7665599464, BETA7=.7277854652;
<a name="l02493"></a>02493                                                                                                                                    
<a name="l02494"></a>02494 
<a name="l02495"></a>02495 
<a name="l02496"></a>02496     <span class="keywordtype">double</span> SINT1, COST1, ALPHA, GAMMA, GAMMAoDG1, GAMMAoDG12, ARG1;
<a name="l02497"></a>02497     <span class="keywordtype">double</span> ALPHAmALPHA4oDAL4, ALPHAmALPHA4oDAL42, GAMMAoDG4, GAMMAoDG42;
<a name="l02498"></a>02498     <span class="keywordtype">double</span> ARG2, DEXP1, DEXP2, ALPHAmALPHA1oDAL1, ALPHAmALPHA1oDAL12, ALPHAmALPHA2oDAL2;
<a name="l02499"></a>02499     <span class="keywordtype">double</span> ALPHAmALPHA2oDAL22, ALPHAmALPHA3oDAL3, ALPHAmALPHA3oDAL32, ALPHAmALPHA3, ALPHAmALPHA32;
<a name="l02500"></a>02500     <span class="keywordtype">double</span> GAMMAoDG2, GAMMAoDG22, GAMMAoDG3, GAMMAoDG32, ALPHA_S, GAMMAoDG5, GAMMAoDG52;
<a name="l02501"></a>02501     <span class="keywordtype">double</span> ALPHApALPHA5oDAL5, ALPHApALPHA5oDAL52, GAMMA_S, GAMMAS2, ALSQH, F, Q, C, G, RS;
<a name="l02502"></a>02502     <span class="keywordtype">double</span> COSTS, SINTS, RHOS, RHOS2, ZS, RRC1pRHOS, RRC1pRHOS2, P, XK2, XK, XKRHO12, XK2S, DL;
<a name="l02503"></a>02503     <span class="keywordtype">double</span> ELK, ELE, APHI1, RRC2pRHOS, RRC2pRHOS2, APHI2, Result;
<a name="l02504"></a>02504 
<a name="l02505"></a>02505 
<a name="l02506"></a>02506                                                                                                                                               
<a name="l02507"></a>02507     PROX  = <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02508"></a>02508     SINT1 = SINT;
<a name="l02509"></a>02509     COST1 = COST;
<a name="l02510"></a>02510     <span class="keywordflow">if</span> (SINT1 &lt; 1e-2) {     <span class="comment">// TOO CLOSE TO Z-AXIS;  USE LINEAR INTERPOLATION BETWEEN SINT=0 &amp; SINT=0.01</span>
<a name="l02511"></a>02511     SINT1 = 1e-2;
<a name="l02512"></a>02512     COST1 = .99994999875;
<a name="l02513"></a>02513     PROX  = <a class="code" href="_lgm___c_trans_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02514"></a>02514     }
<a name="l02515"></a>02515                                                                                                                                               
<a name="l02516"></a>02516     ALPHA = SINT1*SINT1/R;  <span class="comment">// R,THETA -&gt; ALPHA,GAMMA</span>
<a name="l02517"></a>02517     GAMMA = COST1/(R*R);
<a name="l02518"></a>02518                                                                                                                                               
<a name="l02519"></a>02519     GAMMAoDG1 = GAMMA/DG1; GAMMAoDG12 = GAMMAoDG1*GAMMAoDG1;
<a name="l02520"></a>02520     ARG1 = -GAMMAoDG12;
<a name="l02521"></a>02521     ALPHAmALPHA4oDAL4 = (ALPHA-ALPHA4)/DAL4; ALPHAmALPHA4oDAL42 = ALPHAmALPHA4oDAL4*ALPHAmALPHA4oDAL4;
<a name="l02522"></a>02522     GAMMAoDG4 = GAMMA/DG4; GAMMAoDG42 = GAMMAoDG4*GAMMAoDG4;
<a name="l02523"></a>02523     ARG2 = -ALPHAmALPHA4oDAL42-GAMMAoDG42;
<a name="l02524"></a>02524 
<a name="l02525"></a>02525 
<a name="l02526"></a>02526     DEXP1 = (ARG1 &lt; -500.0) ? 0.0 : exp(ARG1);  <span class="comment">// TO PREVENT "FLOATING UNDERFLOW" CRASHES</span>
<a name="l02527"></a>02527     DEXP2 = (ARG2 &lt; -500.0) ? 0.0 : exp(ARG2);  <span class="comment">// TO PREVENT "FLOATING UNDERFLOW" CRASHES</span>
<a name="l02528"></a>02528                                                                                                                                               
<a name="l02529"></a>02529 
<a name="l02530"></a>02530                                                                                                                                               
<a name="l02531"></a>02531     ALPHAmALPHA1oDAL1 = (ALPHA-ALPHA1)/DAL1; ALPHAmALPHA1oDAL12 = ALPHAmALPHA1oDAL1*ALPHAmALPHA1oDAL1;
<a name="l02532"></a>02532     ALPHAmALPHA2oDAL2 = (ALPHA-ALPHA2)/DAL2; ALPHAmALPHA2oDAL22 = ALPHAmALPHA2oDAL2*ALPHAmALPHA2oDAL2;
<a name="l02533"></a>02533     ALPHAmALPHA3oDAL3 = (ALPHA-ALPHA3)/DAL3; ALPHAmALPHA3oDAL32 = ALPHAmALPHA3oDAL3*ALPHAmALPHA3oDAL3;
<a name="l02534"></a>02534     ALPHAmALPHA3 = ALPHA-ALPHA3; ALPHAmALPHA32 = ALPHAmALPHA3*ALPHAmALPHA3;
<a name="l02535"></a>02535     GAMMAoDG2 = GAMMA/DG2; GAMMAoDG22 = GAMMAoDG2*GAMMAoDG2;
<a name="l02536"></a>02536     GAMMAoDG3 = GAMMA/DG3; GAMMAoDG32 = GAMMAoDG3*GAMMAoDG3;
<a name="l02537"></a>02537 
<a name="l02538"></a>02538     ALPHA_S = ALPHA*(1.+P1/pow(1.+ALPHAmALPHA1oDAL12, BETA1)
<a name="l02539"></a>02539         *DEXP1+P2*(ALPHA-ALPHA2)/pow(1.+ALPHAmALPHA2oDAL22, BETA2)
<a name="l02540"></a>02540         /pow(1.+GAMMAoDG22, BETA3)
<a name="l02541"></a>02541         +P3*ALPHAmALPHA32/pow(1.+ALPHAmALPHA3oDAL32, BETA4)
<a name="l02542"></a>02542         /pow(1.+GAMMAoDG32, BETA5));        <span class="comment">// ALPHA -&gt; ALPHA_S  (DEFORMED)</span>
<a name="l02543"></a>02543 
<a name="l02544"></a>02544 
<a name="l02545"></a>02545                                                                                                                                               
<a name="l02546"></a>02546     GAMMAoDG5 = GAMMA/DG5; GAMMAoDG52 = GAMMAoDG5*GAMMAoDG5;
<a name="l02547"></a>02547     ALPHApALPHA5oDAL5 = (ALPHA-ALPHA5)/DAL5; ALPHApALPHA5oDAL52 = ALPHApALPHA5oDAL5*ALPHApALPHA5oDAL5;
<a name="l02548"></a>02548     GAMMA_S = GAMMA*(1.+Q0+Q1*(ALPHA-ALPHA4)*DEXP2  <span class="comment">// GAMMA -&gt; GAMMA_  (DEFORMED)</span>
<a name="l02549"></a>02549         +Q2*(ALPHA-ALPHA5)/pow( 1.+ALPHApALPHA5oDAL52, BETA6 )
<a name="l02550"></a>02550         /pow( 1.+GAMMAoDG52, BETA7 ));
<a name="l02551"></a>02551                                                                                                                                               
<a name="l02552"></a>02552     GAMMAS2 = GAMMA_S*GAMMA_S;
<a name="l02553"></a>02553                                                                                                                                               
<a name="l02554"></a>02554     ALSQH = 0.5*ALPHA_S*ALPHA_S;        <span class="comment">// ALPHA_S,GAMMA_S -&gt; RS,SINTS,COSTS</span>
<a name="l02555"></a>02555     F = 64./27.*GAMMAS2+ALSQH*ALSQH;
<a name="l02556"></a>02556     Q = pow( sqrt(F)+ALSQH, 1./3. );
<a name="l02557"></a>02557     C = Q-4.*pow( GAMMAS2, 1./3. )/(3.*Q);
<a name="l02558"></a>02558 
<a name="l02559"></a>02559 
<a name="l02560"></a>02560     <span class="keywordflow">if</span> (C &lt; 0.) C = 0.;
<a name="l02561"></a>02561 
<a name="l02562"></a>02562     G  = sqrt(C*C+4.*pow( GAMMAS2, 1./3. ));
<a name="l02563"></a>02563     RS = 4./((sqrt(2.*G-C)+sqrt(C))*(G+C));
<a name="l02564"></a>02564     COSTS = GAMMA_S*RS*RS;
<a name="l02565"></a>02565     SINTS = sqrt(1.-COSTS*COSTS);
<a name="l02566"></a>02566     RHOS  = RS*SINTS;
<a name="l02567"></a>02567     RHOS2 = RHOS*RHOS;
<a name="l02568"></a>02568     ZS = RS*COSTS;
<a name="l02569"></a>02569 
<a name="l02570"></a>02570 
<a name="l02571"></a>02571     <span class="comment">/*</span>
<a name="l02572"></a>02572 <span class="comment">     *  1st loop:</span>
<a name="l02573"></a>02573 <span class="comment">     */</span>
<a name="l02574"></a>02574     RRC1pRHOS = RRC1+RHOS; RRC1pRHOS2 = RRC1pRHOS*RRC1pRHOS;
<a name="l02575"></a>02575     P   = RRC1pRHOS2+ZS*ZS+DD1*DD1;
<a name="l02576"></a>02576     XK2 = 4.*RRC1*RHOS/P;
<a name="l02577"></a>02577     XK  = sqrt(XK2);
<a name="l02578"></a>02578     XKRHO12 = XK*sqrt(RHOS);
<a name="l02579"></a>02579 
<a name="l02580"></a>02580     XK2S = 1.-XK2;
<a name="l02581"></a>02581     DL   = log(1./XK2S);    <span class="comment">// CEHCK was LOG in FORTRAN</span>
<a name="l02582"></a>02582     ELK  = 1.38629436112+XK2S*(0.09666344259+XK2S*(0.03590092383+
<a name="l02583"></a>02583         XK2S*(0.03742563713+XK2S*0.01451196212))) +DL*
<a name="l02584"></a>02584         (0.5+XK2S*(0.12498593597+XK2S*(0.06880248576+
<a name="l02585"></a>02585         XK2S*(0.03328355346+XK2S*0.00441787012))));
<a name="l02586"></a>02586     ELE  = 1.+XK2S*(0.44325141463+XK2S*(0.0626060122+XK2S*
<a name="l02587"></a>02587         (0.04757383546+XK2S*0.01736506451))) +DL*
<a name="l02588"></a>02588         XK2S*(0.2499836831+XK2S*(0.09200180037+XK2S*
<a name="l02589"></a>02589         (0.04069697526+XK2S*0.00526449639)));
<a name="l02590"></a>02590  
<a name="l02591"></a>02591     APHI1 = ((1.-XK2*0.5)*ELK-ELE)/XKRHO12;
<a name="l02592"></a>02592 
<a name="l02593"></a>02593 
<a name="l02594"></a>02594 
<a name="l02595"></a>02595     <span class="comment">/*</span>
<a name="l02596"></a>02596 <span class="comment">     *  2nd loop:</span>
<a name="l02597"></a>02597 <span class="comment">     */</span>
<a name="l02598"></a>02598     
<a name="l02599"></a>02599     RRC2pRHOS = RRC2+RHOS; RRC2pRHOS2 = RRC2pRHOS*RRC2pRHOS;
<a name="l02600"></a>02600     P   = RRC2pRHOS2+ZS*ZS+DD2*DD2;
<a name="l02601"></a>02601     XK2 = 4.*RRC2*RHOS/P;
<a name="l02602"></a>02602     XK  = sqrt(XK2);
<a name="l02603"></a>02603     XKRHO12 = XK*sqrt(RHOS);
<a name="l02604"></a>02604  
<a name="l02605"></a>02605     XK2S = 1.-XK2;
<a name="l02606"></a>02606     DL   = log(1./XK2S);    <span class="comment">// CHECK was LOG in FORTRAN</span>
<a name="l02607"></a>02607     ELK  = 1.38629436112+XK2S*(0.09666344259+XK2S*(0.03590092383+
<a name="l02608"></a>02608           XK2S*(0.03742563713+XK2S*0.01451196212))) +DL*
<a name="l02609"></a>02609           (0.5+XK2S*(0.12498593597+XK2S*(0.06880248576+
<a name="l02610"></a>02610           XK2S*(0.03328355346+XK2S*0.00441787012))));
<a name="l02611"></a>02611     ELE  = 1.+XK2S*(0.44325141463+XK2S*(0.0626060122+XK2S*
<a name="l02612"></a>02612            (0.04757383546+XK2S*0.01736506451))) +DL*
<a name="l02613"></a>02613           XK2S*(0.2499836831+XK2S*(0.09200180037+XK2S*
<a name="l02614"></a>02614             (0.04069697526+XK2S*0.00526449639)));
<a name="l02615"></a>02615  
<a name="l02616"></a>02616     APHI2 = ((1.-XK2*0.5)*ELK-ELE)/XKRHO12;
<a name="l02617"></a>02617                                                                                                                                               
<a name="l02618"></a>02618     Result = A1*APHI1+A2*APHI2;
<a name="l02619"></a>02619     <span class="keywordflow">if</span> (PROX) Result *= SINT/SINT1;     <span class="comment">// LINEAR INTERPOLATION, IF TOO CLOSE TO THE Z-AXIS</span>
<a name="l02620"></a>02620 
<a name="l02621"></a>02621  
<a name="l02622"></a>02622     <span class="keywordflow">return</span>( Result );
<a name="l02623"></a>02623 
<a name="l02624"></a>02624 
<a name="l02625"></a>02625 }
<a name="l02626"></a>02626 
<a name="l02627"></a>02627 
<a name="l02628"></a><a class="code" href="_tsyg2004_8c.html#7d3132f7a6ed31b467740063133da1fe">02628</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#7d3132f7a6ed31b467740063133da1fe">PRC_QUAD</a>( <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ) {
<a name="l02629"></a>02629 
<a name="l02630"></a>02630 <span class="comment">//    double    DD=2e-4;</span>
<a name="l02631"></a>02631     <span class="keywordtype">double</span>  D=1e-4, DS=1e-2, DC=0.99994999875, ooDD=5000.0;
<a name="l02632"></a>02632 
<a name="l02633"></a>02633 
<a name="l02634"></a>02634     <span class="keywordtype">double</span>  X2, Y2, RHO2, R, ooR, RHO, SINT, COST, RP, RM, ooRHO, CPHI, SPHI;
<a name="l02635"></a>02635     <span class="keywordtype">double</span>  BR, BT, DBRR, THETA, TP, TM, SINTP, COSTP, SINTM, COSTM, DBTT, ST;
<a name="l02636"></a>02636     <span class="keywordtype">double</span>  CT, FCXY, RtST, RtST2, ooRtST2;
<a name="l02637"></a>02637                                                                                                                                               
<a name="l02638"></a>02638                                                                                                                                               
<a name="l02639"></a>02639     X2 = X*X; Y2 = Y*Y;
<a name="l02640"></a>02640     RHO2 = X2+Y2;
<a name="l02641"></a>02641     R    = sqrt(RHO2+Z*Z); ooR = 1.0/R;
<a name="l02642"></a>02642     RHO  = sqrt(RHO2);
<a name="l02643"></a>02643     SINT = RHO*ooR;
<a name="l02644"></a>02644     COST = Z*ooR;
<a name="l02645"></a>02645     RP = R+D;
<a name="l02646"></a>02646     RM = R-D;
<a name="l02647"></a>02647                                                                                                                                               
<a name="l02648"></a>02648     <span class="keywordflow">if</span> (SINT &gt; DS) {
<a name="l02649"></a>02649     ooRHO = 1.0/RHO;
<a name="l02650"></a>02650     CPHI  = X*ooRHO;
<a name="l02651"></a>02651     SPHI  = Y*ooRHO;
<a name="l02652"></a>02652     BR = <a class="code" href="_tsyg2004_8c.html#51ea88e5a0772dd9763092b23868d83e">BR_PRC_Q</a>(R,SINT,COST);
<a name="l02653"></a>02653     BT = <a class="code" href="_tsyg2004_8c.html#40293e54c4b1290d9463ec556292303b">BT_PRC_Q</a>(R,SINT,COST);
<a name="l02654"></a>02654     DBRR  = (<a class="code" href="_tsyg2004_8c.html#51ea88e5a0772dd9763092b23868d83e">BR_PRC_Q</a>(RP,SINT,COST)-<a class="code" href="_tsyg2004_8c.html#51ea88e5a0772dd9763092b23868d83e">BR_PRC_Q</a>(RM,SINT,COST))*ooDD;
<a name="l02655"></a>02655     THETA = atan2(SINT,COST);
<a name="l02656"></a>02656     TP = THETA+D;
<a name="l02657"></a>02657     TM = THETA-D;
<a name="l02658"></a>02658     SINTP = sin(TP);
<a name="l02659"></a>02659     COSTP = cos(TP);
<a name="l02660"></a>02660     SINTM = sin(TM);
<a name="l02661"></a>02661     COSTM = cos(TM);
<a name="l02662"></a>02662     DBTT  = (<a class="code" href="_tsyg2004_8c.html#40293e54c4b1290d9463ec556292303b">BT_PRC_Q</a>(R,SINTP,COSTP)-<a class="code" href="_tsyg2004_8c.html#40293e54c4b1290d9463ec556292303b">BT_PRC_Q</a>(R,SINTM,COSTM))*ooDD;
<a name="l02663"></a>02663     *BX = SINT*(BR+(BR+R*DBRR+DBTT)*SPHI*SPHI)+COST*BT;
<a name="l02664"></a>02664     *BY = -SINT*SPHI*CPHI*(BR+R*DBRR+DBTT);
<a name="l02665"></a>02665     *BZ = (BR*COST-BT*SINT)*CPHI;
<a name="l02666"></a>02666     } <span class="keywordflow">else</span> {
<a name="l02667"></a>02667     ST = DS;
<a name="l02668"></a>02668     CT = DC;
<a name="l02669"></a>02669     <span class="keywordflow">if</span> (Z &lt; 0.0) CT = -DC;
<a name="l02670"></a>02670     THETA = atan2(ST,CT);
<a name="l02671"></a>02671     TP = THETA+D;
<a name="l02672"></a>02672     TM = THETA-D;
<a name="l02673"></a>02673     SINTP = sin(TP);
<a name="l02674"></a>02674     COSTP = cos(TP);
<a name="l02675"></a>02675     SINTM = sin(TM);
<a name="l02676"></a>02676     COSTM = cos(TM);
<a name="l02677"></a>02677     BR = <a class="code" href="_tsyg2004_8c.html#51ea88e5a0772dd9763092b23868d83e">BR_PRC_Q</a>(R,ST,CT);
<a name="l02678"></a>02678     BT = <a class="code" href="_tsyg2004_8c.html#40293e54c4b1290d9463ec556292303b">BT_PRC_Q</a>(R,ST,CT);
<a name="l02679"></a>02679     DBRR = (<a class="code" href="_tsyg2004_8c.html#51ea88e5a0772dd9763092b23868d83e">BR_PRC_Q</a>(RP,ST,CT)-<a class="code" href="_tsyg2004_8c.html#51ea88e5a0772dd9763092b23868d83e">BR_PRC_Q</a>(RM,ST,CT))*ooDD;
<a name="l02680"></a>02680     DBTT = (<a class="code" href="_tsyg2004_8c.html#40293e54c4b1290d9463ec556292303b">BT_PRC_Q</a>(R,SINTP,COSTP)-<a class="code" href="_tsyg2004_8c.html#40293e54c4b1290d9463ec556292303b">BT_PRC_Q</a>(R,SINTM,COSTM))*ooDD;
<a name="l02681"></a>02681     FCXY = R*DBRR+DBTT;
<a name="l02682"></a>02682     RtST = R*ST; RtST2 = RtST*RtST; ooRtST2 = 1.0/RtST2;
<a name="l02683"></a>02683     *BX = (BR*(X2+2.0*Y2)+FCXY*Y2)*ooRtST2+BT*COST;
<a name="l02684"></a>02684     *BY = -(BR+FCXY)*X*Y*ooRtST2;
<a name="l02685"></a>02685     *BZ = (BR*COST/ST-BT)*X/R;
<a name="l02686"></a>02686     }
<a name="l02687"></a>02687                                                                                                                                               
<a name="l02688"></a>02688     <span class="keywordflow">return</span>;
<a name="l02689"></a>02689 
<a name="l02690"></a>02690 }
<a name="l02691"></a>02691 
<a name="l02692"></a>02692 
<a name="l02693"></a><a class="code" href="_tsyg2004_8c.html#51ea88e5a0772dd9763092b23868d83e">02693</a> <span class="keywordtype">double</span>  <a class="code" href="_tsyg2004_8c.html#51ea88e5a0772dd9763092b23868d83e">BR_PRC_Q</a>( <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> SINT, <span class="keywordtype">double</span> COST ) {
<a name="l02694"></a>02694 
<a name="l02695"></a>02695     <span class="comment">/* </span>
<a name="l02696"></a>02696 <span class="comment">     *   Calculates the radial component of the "quadrupole" part of the model partial ring current.</span>
<a name="l02697"></a>02697 <span class="comment">     */</span>
<a name="l02698"></a>02698 
<a name="l02699"></a>02699     <span class="keywordtype">double</span> A1=-21.2666329;
<a name="l02700"></a>02700     <span class="keywordtype">double</span> A2=32.24527521, A3=-6.062894078, A4=7.515660734, A5=233.7341288, A6=-227.1195714;        <span class="comment">// ALL LINEAR PARAMETERS HERE</span>
<a name="l02701"></a>02701     <span class="keywordtype">double</span> A7=8.483233889, A8=16.80642754, A9=-24.63534184, A10=9.067120578, A11=-1.052686913;      <span class="comment">// WERE MULTIPLIED BY 0.1,</span>
<a name="l02702"></a>02702     <span class="keywordtype">double</span> A12=-12.08384538, A13=18.61969572, A14=-12.71686069, A15=47017.35679, A16=-50646.71204;  <span class="comment">// SO THAT THEY CORRESPOND TO P_0=1 nPa,</span>
<a name="l02703"></a>02703     <span class="keywordtype">double</span> A17=7746.058231,  A18=1.531069371, XK1=2.318824273, AL1=.1417519429, DAL1=.6388013110E-02;   <span class="comment">// RATHER THAN THE ORIGINAL VALUE OF 10 nPa</span>
<a name="l02704"></a>02704     <span class="keywordtype">double</span> B1=5.303934488, BE1=4.213397467, XK2=.7955534018, AL2=.1401142771, DAL2=.2306094179E-01; <span class="comment">// ASSUMED IN THE BIOT-SAVART INTEGRAL</span>
<a name="l02705"></a>02705     <span class="keywordtype">double</span> B2=3.462235072, BE2=2.568743010, XK3=3.477425908, XK4=1.922155110, AL3=.1485233485;
<a name="l02706"></a>02706     <span class="keywordtype">double</span> DAL3=.2319676273E-01, B3=7.830223587,  BE3=8.492933868, AL4=.1295221828, DAL4=.01753008801;
<a name="l02707"></a>02707     <span class="keywordtype">double</span> DG1=.01125504083, AL5=.1811846095, DAL5=.04841237481, DG2=.01981805097, C1=6.557801891;
<a name="l02708"></a>02708     <span class="keywordtype">double</span> C2=6.348576071, C3=5.744436687, AL6=.2265212965, DAL6=.1301957209, DRM=.5654023158;
<a name="l02709"></a>02709     
<a name="l02710"></a>02710     <span class="keywordtype">double</span> ooR, ooR2, SINT2, COST2, SC, ALPHA, GAMMA, F, FA, FS;
<a name="l02711"></a>02711     <span class="keywordtype">double</span> D1, D2, D3, D4, D5, D6, ALPHAmAL4oDAL4, ALPHAmAL4oDAL42;
<a name="l02712"></a>02712     <span class="keywordtype">double</span> GAMMAoDG1, GAMMAoDG12, ARGA, ooARGA, ARGG, D7, D8, D9, D10;
<a name="l02713"></a>02713     <span class="keywordtype">double</span> ALPHAmAL5oDAL5, ALPHAmAL5oDAL52, GAMMAoDG2, GAMMAoDG22, D11;
<a name="l02714"></a>02714     <span class="keywordtype">double</span> D12, D13, D14, R2, R4, C12, C14, C22, C24, C32, C34, D15, D16;
<a name="l02715"></a>02715     <span class="keywordtype">double</span> D17, RmNUMoDRM, RmNUMoDRM2, D18, Result;
<a name="l02716"></a>02716                                                                                                                                               
<a name="l02717"></a>02717     ooR = 1.0/R; ooR2 = ooR*ooR;
<a name="l02718"></a>02718     SINT2 = SINT*SINT;
<a name="l02719"></a>02719     COST2 = COST*COST;
<a name="l02720"></a>02720     SC    = SINT*COST;
<a name="l02721"></a>02721     ALPHA = SINT2*ooR;
<a name="l02722"></a>02722     GAMMA = COST*ooR2;
<a name="l02723"></a>02723                                                                                                                                               
<a name="l02724"></a>02724     <a class="code" href="_tsyg2004_8c.html#e9137c27c3c66aef974f6c4017b6ab9d">FFS</a>(ALPHA,AL1,DAL1,&amp;F,&amp;FA,&amp;FS);
<a name="l02725"></a>02725     D1 = SC*pow(F, XK1)/(pow( R/B1, BE1) +1.0);
<a name="l02726"></a>02726     D2 = D1*COST2;
<a name="l02727"></a>02727                                                                                                                                               
<a name="l02728"></a>02728     <a class="code" href="_tsyg2004_8c.html#e9137c27c3c66aef974f6c4017b6ab9d">FFS</a>(ALPHA,AL2,DAL2,&amp;F,&amp;FA,&amp;FS);
<a name="l02729"></a>02729     D3 = SC*pow(FS, XK2)/(pow( R/B2, BE2) +1.0);
<a name="l02730"></a>02730     D4 = D3*COST2;
<a name="l02731"></a>02731                                                                                                                                               
<a name="l02732"></a>02732     <a class="code" href="_tsyg2004_8c.html#e9137c27c3c66aef974f6c4017b6ab9d">FFS</a>(ALPHA,AL3,DAL3,&amp;F,&amp;FA,&amp;FS);
<a name="l02733"></a>02733     D5 = SC*pow(ALPHA, XK3)*pow(FS, XK4)/(pow(R/B3, BE3)+1.0);
<a name="l02734"></a>02734     D6 = D5*COST2;
<a name="l02735"></a>02735                                                                                                                                               
<a name="l02736"></a>02736     ALPHAmAL4oDAL4 = (ALPHA-AL4)/DAL4; ALPHAmAL4oDAL42 = ALPHAmAL4oDAL4*ALPHAmAL4oDAL4;
<a name="l02737"></a>02737     GAMMAoDG1 = GAMMA/DG1; GAMMAoDG12 = GAMMAoDG1*GAMMAoDG1;
<a name="l02738"></a>02738     ARGA = ALPHAmAL4oDAL42+1.0; ooARGA = 1.0/ARGA;
<a name="l02739"></a>02739     ARGG = 1.0+GAMMAoDG12;
<a name="l02740"></a>02740                                                                                                                                               
<a name="l02741"></a>02741     D7  = SC*ooARGA/ARGG;
<a name="l02742"></a>02742     D8  = D7*ooARGA;
<a name="l02743"></a>02743     D9  = D8*ooARGA;
<a name="l02744"></a>02744     D10 = D9*ooARGA;
<a name="l02745"></a>02745                                                                                                                                               
<a name="l02746"></a>02746     ALPHAmAL5oDAL5 = (ALPHA-AL5)/DAL5; ALPHAmAL5oDAL52 = ALPHAmAL5oDAL5*ALPHAmAL5oDAL5;
<a name="l02747"></a>02747     GAMMAoDG2 = GAMMA/DG2; GAMMAoDG22 = GAMMAoDG2*GAMMAoDG2;
<a name="l02748"></a>02748     ARGA = ALPHAmAL5oDAL52+1.0; ooARGA = 1.0/ARGA;
<a name="l02749"></a>02749     ARGG = 1.0+GAMMAoDG22;
<a name="l02750"></a>02750                                                                                                                                               
<a name="l02751"></a>02751     D11 = SC*ooARGA/ARGG;
<a name="l02752"></a>02752     D12 = D11*ooARGA;
<a name="l02753"></a>02753     D13 = D12*ooARGA;
<a name="l02754"></a>02754     D14 = D13*ooARGA;
<a name="l02755"></a>02755                                                                                                                                               
<a name="l02756"></a>02756                                                                                                                                                
<a name="l02757"></a>02757     R2 = R*R; R4 = R2*R2;
<a name="l02758"></a>02758     C12 = C1*C1; C14 = C12*C12;
<a name="l02759"></a>02759     C22 = C2*C2; C24 = C22*C22;
<a name="l02760"></a>02760     C32 = C3*C3; C34 = C32*C32;
<a name="l02761"></a>02761 
<a name="l02762"></a>02762     D15 = SC/(R4+C14);
<a name="l02763"></a>02763     D16 = SC/(R4+C24)*COST2;
<a name="l02764"></a>02764     D17 = SC/(R4+C34)*COST2*COST2;
<a name="l02765"></a>02765                                                                                                                                               
<a name="l02766"></a>02766     <a class="code" href="_tsyg2004_8c.html#e9137c27c3c66aef974f6c4017b6ab9d">FFS</a>(ALPHA,AL6,DAL6,&amp;F,&amp;FA,&amp;FS);
<a name="l02767"></a>02767     
<a name="l02768"></a>02768     RmNUMoDRM = (R-1.20)/DRM; RmNUMoDRM2 = RmNUMoDRM*RmNUMoDRM;
<a name="l02769"></a>02769     D18 = SC*FS/(1.0+RmNUMoDRM2);
<a name="l02770"></a>02770 
<a name="l02771"></a>02771     Result = A1*D1+A2*D2+A3*D3+A4*D4+A5*D5+A6*D6+A7*D7+A8*D8+A9*D9
<a name="l02772"></a>02772         + A10*D10+A11*D11+A12*D12+A13*D13+A14*D14+A15*D15+A16*D16+A17*D17
<a name="l02773"></a>02773         + A18*D18;
<a name="l02774"></a>02774 
<a name="l02775"></a>02775     <span class="keywordflow">return</span>( Result );
<a name="l02776"></a>02776 }
<a name="l02777"></a>02777 
<a name="l02778"></a>02778 
<a name="l02779"></a>02779 
<a name="l02780"></a><a class="code" href="_tsyg2004_8c.html#40293e54c4b1290d9463ec556292303b">02780</a> <span class="keywordtype">double</span>  <a class="code" href="_tsyg2004_8c.html#40293e54c4b1290d9463ec556292303b">BT_PRC_Q</a>( <span class="keywordtype">double</span> R, <span class="keywordtype">double</span> SINT, <span class="keywordtype">double</span> COST) {
<a name="l02781"></a>02781 
<a name="l02782"></a>02782 
<a name="l02783"></a>02783     <span class="comment">/* </span>
<a name="l02784"></a>02784 <span class="comment">     *  Calculates the Theta component of the "quadrupole" part of the model partial ring current.</span>
<a name="l02785"></a>02785 <span class="comment">     */</span>
<a name="l02786"></a>02786 
<a name="l02787"></a>02787     <span class="keywordtype">double</span> A1=12.74640393, A2=-7.516393516;
<a name="l02788"></a>02788     <span class="keywordtype">double</span> A3=-5.476233865, A4=3.212704645, A5=-59.10926169, A6=46.62198189, A7=-.01644280062;      <span class="comment">// ALL LINEAR PARAMETERS HERE</span>
<a name="l02789"></a>02789     <span class="keywordtype">double</span> A8=.1234229112, A9=-.08579198697, A10=.01321366966, A11=.8970494003, A12=9.136186247;    <span class="comment">// WERE MULTIPLIED BY 0.1,</span>
<a name="l02790"></a>02790     <span class="keywordtype">double</span> A13=-38.19301215, A14=21.73775846, A15=-410.0783424, A16=-69.90832690, A17=-848.8543440; <span class="comment">// SO THAT THEY CORRESPOND TO P_0=1 nPa,</span>
<a name="l02791"></a>02791     <span class="keywordtype">double</span> XK1=1.243288286, AL1=.2071721360, DAL1=.05030555417, B1=7.471332374, BE1=3.180533613;    <span class="comment">// RATHER THAN THE ORIGINAL VALUE OF 10 nPa</span>
<a name="l02792"></a>02792     <span class="keywordtype">double</span> XK2=1.376743507, AL2=.1568504222, DAL2=.02092910682, BE2=1.985148197, XK3=.3157139940;   <span class="comment">// ASSUMED IN THE BIOT-SAVART INTEGRAL</span>
<a name="l02793"></a>02793     <span class="keywordtype">double</span> XK4=1.056309517, AL3=.1701395257, DAL3=.1019870070, B3=6.293740981, BE3=5.671824276;
<a name="l02794"></a>02794     <span class="keywordtype">double</span> AL4=.1280772299, DAL4=.02189060799, DG1=.01040696080, AL5=.1648265607, DAL5=.04701592613;
<a name="l02795"></a>02795     <span class="keywordtype">double</span> DG2=.01526400086, C1=12.88384229, C2=3.361775101, C3=23.44173897;
<a name="l02796"></a>02796 
<a name="l02797"></a>02797     <span class="keywordtype">double</span> ooR, ooR2, SINT2, COST2, SC, ALPHA, GAMMA, F, FA, FS, D1, D2;
<a name="l02798"></a>02798     <span class="keywordtype">double</span> D3, D4, D5, D6, ALPHAmAL4oDAL42, ALPHAmAL4oDAL4, FCC, ooFCC, D7;
<a name="l02799"></a>02799     <span class="keywordtype">double</span> ALPHAmAL5oDAL52, ALPHAmAL5oDAL5, GAMMAoDG2, GAMMAoDG22, ARG, ooARG;
<a name="l02800"></a>02800     <span class="keywordtype">double</span> D8, D9, D10, D11, D12, D13, D14, R2, R4, C12, C22, C32, D15, Result;
<a name="l02801"></a>02801     <span class="keywordtype">double</span> D16, D17;
<a name="l02802"></a>02802 
<a name="l02803"></a>02803 
<a name="l02804"></a>02804     ooR = 1.0/R; ooR2 = ooR*ooR;
<a name="l02805"></a>02805     SINT2 = SINT*SINT;
<a name="l02806"></a>02806     COST2 = COST*COST;
<a name="l02807"></a>02807     SC    = SINT*COST;
<a name="l02808"></a>02808     ALPHA = SINT2*ooR;
<a name="l02809"></a>02809     GAMMA = COST*ooR2;
<a name="l02810"></a>02810                                                                                                                                               
<a name="l02811"></a>02811     <a class="code" href="_tsyg2004_8c.html#e9137c27c3c66aef974f6c4017b6ab9d">FFS</a>(ALPHA,AL1,DAL1,&amp;F,&amp;FA,&amp;FS);
<a name="l02812"></a>02812     D1 = pow(F, XK1)/(pow(R/B1, BE1)+1.0);
<a name="l02813"></a>02813     D2 = D1*COST2;
<a name="l02814"></a>02814                                                                                                                                               
<a name="l02815"></a>02815     <a class="code" href="_tsyg2004_8c.html#e9137c27c3c66aef974f6c4017b6ab9d">FFS</a>(ALPHA,AL2,DAL2,&amp;F,&amp;FA,&amp;FS);
<a name="l02816"></a>02816     D3 = pow(FA, XK2)/pow(R, BE2);
<a name="l02817"></a>02817     D4 = D3*COST2;
<a name="l02818"></a>02818                                                                                                                                               
<a name="l02819"></a>02819     <a class="code" href="_tsyg2004_8c.html#e9137c27c3c66aef974f6c4017b6ab9d">FFS</a>(ALPHA,AL3,DAL3,&amp;F,&amp;FA,&amp;FS);
<a name="l02820"></a>02820     D5 = pow(FS, XK3)*pow(ALPHA, XK4)/(pow(R/B3, BE3)+1.0);
<a name="l02821"></a>02821     D6 = D5*COST2;
<a name="l02822"></a>02822                                                                                                                                               
<a name="l02823"></a>02823     <a class="code" href="_tsyg2004_8c.html#e9137c27c3c66aef974f6c4017b6ab9d">FFS</a>(GAMMA,0.0,DG1,&amp;F,&amp;FA,&amp;FS);
<a name="l02824"></a>02824     ALPHAmAL4oDAL4 = (ALPHA-AL4)/DAL4; ALPHAmAL4oDAL42 = ALPHAmAL4oDAL4*ALPHAmAL4oDAL4;
<a name="l02825"></a>02825     FCC = (1.0+ALPHAmAL4oDAL42); ooFCC = 1.0/FCC;
<a name="l02826"></a>02826     D7  = ooFCC*FS;
<a name="l02827"></a>02827     D8  = D7*ooFCC;
<a name="l02828"></a>02828     D9  = D8*ooFCC;
<a name="l02829"></a>02829     D10 = D9*ooFCC;
<a name="l02830"></a>02830                                                                                                                                               
<a name="l02831"></a>02831     ALPHAmAL5oDAL5 = (ALPHA-AL5)/DAL5; ALPHAmAL5oDAL52 = ALPHAmAL5oDAL5*ALPHAmAL5oDAL5;
<a name="l02832"></a>02832     GAMMAoDG2 = GAMMA/DG2; GAMMAoDG22 = GAMMAoDG2*GAMMAoDG2;
<a name="l02833"></a>02833     ARG = 1.0+ALPHAmAL5oDAL52; ooARG = 1.0/ARG;
<a name="l02834"></a>02834     D11 = ooARG/(1.0+GAMMAoDG22);
<a name="l02835"></a>02835     D12 = D11*ooARG;
<a name="l02836"></a>02836     D13 = D12*ooARG;
<a name="l02837"></a>02837     D14 = D13*ooARG;
<a name="l02838"></a>02838                                                                                                                                               
<a name="l02839"></a>02839     R2 = R*R; R4 = R2*R2;
<a name="l02840"></a>02840     C12 = C1*C1;
<a name="l02841"></a>02841     C22 = C2*C2;
<a name="l02842"></a>02842     C32 = C3*C3;
<a name="l02843"></a>02843     D15 = 1.0/(R4+C12);
<a name="l02844"></a>02844     D16 = COST2/(R4+C22);
<a name="l02845"></a>02845     D17 = COST2*COST2/(R4+C32);
<a name="l02846"></a>02846  
<a name="l02847"></a>02847     Result = A1*D1+A2*D2+A3*D3+A4*D4+A5*D5+A6*D6+A7*D7+A8*D8+A9*D9
<a name="l02848"></a>02848         + A10*D10+A11*D11+A12*D12+A13*D13+A14*D14+A15*D15+A16*D16+A17*D17;
<a name="l02849"></a>02849  
<a name="l02850"></a>02850     <span class="keywordflow">return</span>( Result );
<a name="l02851"></a>02851 
<a name="l02852"></a>02852 }
<a name="l02853"></a>02853 
<a name="l02854"></a>02854 
<a name="l02855"></a>02855 
<a name="l02856"></a><a class="code" href="_tsyg2004_8c.html#e9137c27c3c66aef974f6c4017b6ab9d">02856</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#e9137c27c3c66aef974f6c4017b6ab9d">FFS</a>( <span class="keywordtype">double</span> A, <span class="keywordtype">double</span> A0, <span class="keywordtype">double</span> DA, <span class="keywordtype">double</span> *F, <span class="keywordtype">double</span> *FA, <span class="keywordtype">double</span> *FS ) {
<a name="l02857"></a>02857 
<a name="l02858"></a>02858     <span class="keywordtype">double</span>  DA2, ApA0, ApA02, AmA0, AmA02, SQ1, SQ2;
<a name="l02859"></a>02859 
<a name="l02860"></a>02860     DA2 = DA*DA;
<a name="l02861"></a>02861     ApA0 = A+A0; ApA02 = ApA0*ApA0;
<a name="l02862"></a>02862     AmA0 = A-A0; AmA02 = AmA0*AmA0;
<a name="l02863"></a>02863 
<a name="l02864"></a>02864     SQ1 = sqrt(ApA02+DA2);
<a name="l02865"></a>02865     SQ2 = sqrt(AmA02+DA2);
<a name="l02866"></a>02866     *FA  = 2.0/(SQ1+SQ2);
<a name="l02867"></a>02867     *F   = *FA*A;
<a name="l02868"></a>02868     *FS  = 0.50*(SQ1+SQ2)/(SQ1*SQ2)*(1.0-(*F)*(*F));
<a name="l02869"></a>02869 
<a name="l02870"></a>02870     <span class="keywordflow">return</span>;
<a name="l02871"></a>02871 
<a name="l02872"></a>02872 }
<a name="l02873"></a>02873 
<a name="l02874"></a>02874 
<a name="l02875"></a>02875 
<a name="l02876"></a><a class="code" href="_tsyg2004_8c.html#ae1fabae2232fcfa073907bc921dbf66">02876</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#ae1fabae2232fcfa073907bc921dbf66">RC_SHIELD</a>( <span class="keywordtype">double</span> *A, <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X_SC, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ ) {
<a name="l02877"></a>02877 
<a name="l02878"></a>02878 
<a name="l02879"></a>02879     <span class="keywordtype">int</span> L, <a class="code" href="quicksort_8c.html#52037c938e3c1b126c6277da5ca689d0">M</a>, I, K, N, NN ;
<a name="l02880"></a>02880     <span class="keywordtype">double</span> X_SCp1, X_SCp12, X_SCp13, FAC_SC, CPS, SPS, S3PS, PST1;
<a name="l02881"></a>02881     <span class="keywordtype">double</span> PST2, ST1, CT1, ST2, CT2, X1, Z1, X2, Z2, GX, GY, GZ, P;
<a name="l02882"></a>02882     <span class="keywordtype">double</span> ooP, ooP2, Q, ooQ, ooQ2, YoP, YoQ, CYPI, CYQI, SYPI, SYQI;
<a name="l02883"></a>02883     <span class="keywordtype">double</span> R, ooR, ooR2, S, ooS, ooS2, Z1oR, Z2oS, SZRK, CZSK, CZRK;
<a name="l02884"></a>02884     <span class="keywordtype">double</span> SZSK, SQPR, SQQS, EPR, EQS, FX, FY, FZ, HX, HY, HZ, HXR, HZR;
<a name="l02885"></a>02885 
<a name="l02886"></a>02886 
<a name="l02887"></a>02887     X_SCp1 = X_SC+1.0; X_SCp12 = X_SCp1*X_SCp1; X_SCp13 = X_SCp1*X_SCp12;
<a name="l02888"></a>02888  
<a name="l02889"></a>02889     FAC_SC = X_SCp13;
<a name="l02890"></a>02890  
<a name="l02891"></a>02891     <span class="comment">//CPS = cos(PS); SPS = sin(PS);</span>
<a name="l02892"></a>02892     CPS = <a class="code" href="_tsyg2004_8c.html#98e0e08bb8a65f90813e5adb482aeb2c">cos_psi</a>; SPS = <a class="code" href="_tsyg2004_8c.html#5b35fcda1a15310fa7b7e3e242431de3">sin_psi</a>;
<a name="l02893"></a>02893                                                                                                                                               
<a name="l02894"></a>02894     S3PS = 2.0*CPS;
<a name="l02895"></a>02895  
<a name="l02896"></a>02896     PST1 = PS*A[85];
<a name="l02897"></a>02897     PST2 = PS*A[86];
<a name="l02898"></a>02898                                                                                                                                               
<a name="l02899"></a>02899     ST1 = sin(PST1);
<a name="l02900"></a>02900     CT1 = cos(PST1);
<a name="l02901"></a>02901     ST2 = sin(PST2);
<a name="l02902"></a>02902     CT2 = cos(PST2);
<a name="l02903"></a>02903                                                                                                                                               
<a name="l02904"></a>02904     X1 = X*CT1-Z*ST1;
<a name="l02905"></a>02905     Z1 = X*ST1+Z*CT1;
<a name="l02906"></a>02906     X2 = X*CT2-Z*ST2;
<a name="l02907"></a>02907     Z2 = X*ST2+Z*CT2;
<a name="l02908"></a>02908  
<a name="l02909"></a>02909     L  = 0;
<a name="l02910"></a>02910     GX = 0.0;
<a name="l02911"></a>02911     GY = 0.0;
<a name="l02912"></a>02912     GZ = 0.0;
<a name="l02913"></a>02913  
<a name="l02914"></a>02914     <span class="keywordflow">for</span> (M=1; M&lt;=2; M++ ){  <span class="comment">// M=1 IS FOR THE 1ST SUM ("PERP." SYMMETRY)</span>
<a name="l02915"></a>02915                 <span class="comment">// AND M=2 IS FOR THE SECOND SUM ("PARALL." SYMMETRY)</span>
<a name="l02916"></a>02916 
<a name="l02917"></a>02917     <span class="keywordflow">for</span> (I=1; I&lt;=3; I++ ){
<a name="l02918"></a>02918 
<a name="l02919"></a>02919         P    = A[72+I]; ooP = 1.0/P; ooP2 = ooP*ooP;
<a name="l02920"></a>02920         Q    = A[78+I]; ooQ = 1.0/Q; ooQ2 = ooQ*ooQ;
<a name="l02921"></a>02921         YoP = Y*ooP; YoQ = Y*ooQ;
<a name="l02922"></a>02922         CYPI = cos(YoP);
<a name="l02923"></a>02923         CYQI = cos(YoQ);
<a name="l02924"></a>02924         SYPI = sin(YoP);
<a name="l02925"></a>02925         SYQI = sin(YoQ);
<a name="l02926"></a>02926  
<a name="l02927"></a>02927         <span class="keywordflow">for</span> (K=1; K&lt;=3; K++ ){
<a name="l02928"></a>02928 
<a name="l02929"></a>02929         R    = A[75+K]; ooR = 1.0/R; ooR2 = ooR*ooR;
<a name="l02930"></a>02930         S    = A[81+K]; ooS = 1.0/S; ooS2 = ooS*ooS;
<a name="l02931"></a>02931         Z1oR = Z1*ooR; Z2oS = Z2*ooS;
<a name="l02932"></a>02932         SZRK = sin(Z1oR);
<a name="l02933"></a>02933         CZSK = cos(Z2oS);
<a name="l02934"></a>02934         CZRK = cos(Z1oR);
<a name="l02935"></a>02935         SZSK = sin(Z2oS);
<a name="l02936"></a>02936         SQPR = sqrt(ooP2+ooR2);
<a name="l02937"></a>02937         SQQS = sqrt(ooQ2+ooS2);
<a name="l02938"></a>02938         EPR  = exp(X1*SQPR);
<a name="l02939"></a>02939         EQS  = exp(X2*SQQS);
<a name="l02940"></a>02940  
<a name="l02941"></a>02941         <span class="keywordflow">for</span> (N=1; N&lt;=2; N++ ){  <span class="comment">// N=1 IS FOR THE FIRST PART OF EACH COEFFICIENT</span>
<a name="l02942"></a>02942                     <span class="comment">// AND N=2 IS FOR THE SECOND ONE</span>
<a name="l02943"></a>02943                                                                                                                                               
<a name="l02944"></a>02944             <span class="keywordflow">for</span> (NN=1; NN&lt;=2; NN++ ){   <span class="comment">// NN = 1,2 FURTHER SPLITS THE COEFFICIENTS INTO 2 PARTS,</span>
<a name="l02945"></a>02945                         <span class="comment">// TO TAKE INTO ACCOUNT THE SCALE FACTOR DEPENDENCE</span>
<a name="l02946"></a>02946 
<a name="l02947"></a>02947             <span class="keywordflow">if</span> (M == 1) {
<a name="l02948"></a>02948 
<a name="l02949"></a>02949                 FX = -SQPR*EPR*CYPI*SZRK  *FAC_SC;
<a name="l02950"></a>02950                 FY = EPR*SYPI*SZRK*ooP   *FAC_SC;
<a name="l02951"></a>02951                 FZ = -EPR*CYPI*CZRK*ooR  *FAC_SC;
<a name="l02952"></a>02952 
<a name="l02953"></a>02953                 <span class="keywordflow">if</span> (N == 1) {
<a name="l02954"></a>02954                 <span class="keywordflow">if</span> (NN == 1) {
<a name="l02955"></a>02955                     HX = FX;
<a name="l02956"></a>02956                     HY = FY;
<a name="l02957"></a>02957                     HZ = FZ;
<a name="l02958"></a>02958                 } <span class="keywordflow">else</span> {
<a name="l02959"></a>02959                     HX = FX*X_SC;
<a name="l02960"></a>02960                     HY = FY*X_SC;
<a name="l02961"></a>02961                     HZ = FZ*X_SC;
<a name="l02962"></a>02962                 }
<a name="l02963"></a>02963                 } <span class="keywordflow">else</span> {
<a name="l02964"></a>02964                 <span class="keywordflow">if</span> (NN == 1) {
<a name="l02965"></a>02965                     HX = FX*CPS;
<a name="l02966"></a>02966                     HY = FY*CPS;
<a name="l02967"></a>02967                     HZ = FZ*CPS;
<a name="l02968"></a>02968                 } <span class="keywordflow">else</span> {
<a name="l02969"></a>02969                     HX = FX*CPS*X_SC;
<a name="l02970"></a>02970                     HY = FY*CPS*X_SC;
<a name="l02971"></a>02971                     HZ = FZ*CPS*X_SC;
<a name="l02972"></a>02972                 }
<a name="l02973"></a>02973                 }
<a name="l02974"></a>02974                                                                                                                                               
<a name="l02975"></a>02975             } <span class="keywordflow">else</span> {        <span class="comment">// M.EQ.2</span>
<a name="l02976"></a>02976 
<a name="l02977"></a>02977                 FX = -SPS*SQQS*EQS*CYQI*CZSK  *FAC_SC;
<a name="l02978"></a>02978                 FY = SPS*ooQ*EQS*SYQI*CZSK   *FAC_SC;
<a name="l02979"></a>02979                 FZ = SPS*ooS*EQS*CYQI*SZSK   *FAC_SC;
<a name="l02980"></a>02980 
<a name="l02981"></a>02981                 <span class="keywordflow">if</span> (N == 1) {
<a name="l02982"></a>02982 
<a name="l02983"></a>02983                 <span class="keywordflow">if</span> (NN == 1) {
<a name="l02984"></a>02984                     HX = FX;
<a name="l02985"></a>02985                     HY = FY;
<a name="l02986"></a>02986                     HZ = FZ;
<a name="l02987"></a>02987                 } <span class="keywordflow">else</span> {
<a name="l02988"></a>02988                     HX = FX*X_SC;
<a name="l02989"></a>02989                     HY = FY*X_SC;
<a name="l02990"></a>02990                     HZ = FZ*X_SC;
<a name="l02991"></a>02991                 }
<a name="l02992"></a>02992                 } <span class="keywordflow">else</span> {
<a name="l02993"></a>02993 
<a name="l02994"></a>02994                 <span class="keywordflow">if</span> (NN == 1) {
<a name="l02995"></a>02995                     HX = FX*S3PS;
<a name="l02996"></a>02996                     HY = FY*S3PS;
<a name="l02997"></a>02997                     HZ = FZ*S3PS;
<a name="l02998"></a>02998                 } <span class="keywordflow">else</span> {
<a name="l02999"></a>02999                     HX = FX*S3PS*X_SC;
<a name="l03000"></a>03000                     HY = FY*S3PS*X_SC;
<a name="l03001"></a>03001                     HZ = FZ*S3PS*X_SC;
<a name="l03002"></a>03002                 }
<a name="l03003"></a>03003                 }
<a name="l03004"></a>03004             }
<a name="l03005"></a>03005 
<a name="l03006"></a>03006             ++L;
<a name="l03007"></a>03007                                                                                                                                               
<a name="l03008"></a>03008             <span class="keywordflow">if</span> (M == 1) {
<a name="l03009"></a>03009                 HXR = HX*CT1+HZ*ST1;
<a name="l03010"></a>03010                 HZR = -HX*ST1+HZ*CT1;
<a name="l03011"></a>03011             } <span class="keywordflow">else</span> {
<a name="l03012"></a>03012                 HXR = HX*CT2+HZ*ST2;
<a name="l03013"></a>03013                 HZR = -HX*ST2+HZ*CT2;
<a name="l03014"></a>03014             }
<a name="l03015"></a>03015                                                                                                                                               
<a name="l03016"></a>03016             GX = GX + HXR*A[L];
<a name="l03017"></a>03017             GY = GY + HY *A[L];
<a name="l03018"></a>03018             GZ = GZ + HZR*A[L];
<a name="l03019"></a>03019                                                                                                                                               
<a name="l03020"></a>03020             }
<a name="l03021"></a>03021         }
<a name="l03022"></a>03022         }
<a name="l03023"></a>03023     }
<a name="l03024"></a>03024     }
<a name="l03025"></a>03025                                                                                                                                               
<a name="l03026"></a>03026     *BX = GX;
<a name="l03027"></a>03027     *BY = GY;
<a name="l03028"></a>03028     *BZ = GZ;
<a name="l03029"></a>03029                                                                                                                                               
<a name="l03030"></a>03030     <span class="keywordflow">return</span>;
<a name="l03031"></a>03031 
<a name="l03032"></a>03032 }
<a name="l03033"></a>03033 
<a name="l03034"></a>03034 
<a name="l03035"></a>03035 
<a name="l03036"></a><a class="code" href="_tsyg2004_8c.html#b1ff14f59abcc09994d8743db9a8f736">03036</a> <span class="keywordtype">void</span>    <a class="code" href="_tsyg2004_8c.html#b1ff14f59abcc09994d8743db9a8f736">DIPOLE</a>( <span class="keywordtype">double</span> PS, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> Z, <span class="keywordtype">double</span> *BX, <span class="keywordtype">double</span> *BY, <span class="keywordtype">double</span> *BZ ) {
<a name="l03037"></a>03037 
<a name="l03038"></a>03038     <span class="comment">/* </span>
<a name="l03039"></a>03039 <span class="comment">     *        A DOUBLE PRECISION ROUTINE</span>
<a name="l03040"></a>03040 <span class="comment">     *  </span>
<a name="l03041"></a>03041 <span class="comment">     *    CALCULATES GSM COMPONENTS OF A GEODIPOLE FIELD WITH THE DIPOLE MOMENT</span>
<a name="l03042"></a>03042 <span class="comment">     *    CORRESPONDING TO THE EPOCH OF 2000.</span>
<a name="l03043"></a>03043 <span class="comment">     *  </span>
<a name="l03044"></a>03044 <span class="comment">     *  ----INPUT PARAMETERS:</span>
<a name="l03045"></a>03045 <span class="comment">     *       PS - GEODIPOLE TILT ANGLE IN RADIANS,</span>
<a name="l03046"></a>03046 <span class="comment">     *       X,Y,Z - GSM COORDINATES IN RE (1 RE = 6371.2 km)</span>
<a name="l03047"></a>03047 <span class="comment">     *  </span>
<a name="l03048"></a>03048 <span class="comment">     *  ----OUTPUT PARAMETERS:</span>
<a name="l03049"></a>03049 <span class="comment">     *       BX,BY,BZ - FIELD COMPONENTS IN GSM SYSTEM, IN NANOTESLA.</span>
<a name="l03050"></a>03050 <span class="comment">     */</span>  
<a name="l03051"></a>03051     <span class="keywordtype">double</span>  SPS, CPS, P, U, V, T, s, s2, s3, s5, Q;
<a name="l03052"></a>03052 
<a name="l03053"></a>03053     <span class="comment">//SPS = sin(PS); CPS = cos(PS);</span>
<a name="l03054"></a>03054     SPS = <a class="code" href="_tsyg2004_8c.html#5b35fcda1a15310fa7b7e3e242431de3">sin_psi</a>; CPS = <a class="code" href="_tsyg2004_8c.html#98e0e08bb8a65f90813e5adb482aeb2c">cos_psi</a>;
<a name="l03055"></a>03055     P = X*X;
<a name="l03056"></a>03056     U = Z*Z;
<a name="l03057"></a>03057     V = 3.0*Z*X;
<a name="l03058"></a>03058     T = Y*Y;
<a name="l03059"></a>03059     s = sqrt(P+T+U); s2 = s*s; s3 = s2*s; s5 = s2*s3;
<a name="l03060"></a>03060     Q = 30115.0/s5;
<a name="l03061"></a>03061 
<a name="l03062"></a>03062     *BX = Q*((T+U-2.0*P)*SPS-V*CPS);
<a name="l03063"></a>03063     *BY = -3.0*Y*Q*(X*SPS+Z*CPS);
<a name="l03064"></a>03064     *BZ = Q*((P+T-2.0*U)*CPS-V*SPS);
<a name="l03065"></a>03065 
<a name="l03066"></a>03066     <span class="keywordflow">return</span>;
<a name="l03067"></a>03067 
<a name="l03068"></a>03068 }
<a name="l03069"></a>03069 
<a name="l03070"></a>03070 
<a name="l03071"></a>03071 <span class="comment">/*</span>
<a name="l03072"></a>03072 <span class="comment"> *   $id$</span>
<a name="l03073"></a>03073 <span class="comment"> */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small><a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> </small></address>
</body>
</html>
