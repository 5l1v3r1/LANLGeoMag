<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>LanlGeoMag: /home/mgh/LanlGeoMag/libLanlGeoMag/ParseTimeStr.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>/home/mgh/LanlGeoMag/libLanlGeoMag/ParseTimeStr.c</h1><a href="_parse_time_str_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;EXTERN.h&gt;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;perl.h&gt;</span>
<a name="l00003"></a><a class="code" href="_parse_time_str_8c.html#8fc0d2e02d252654157f1b50f8c44426">00003</a> <span class="preprocessor">#define ISO_YYYYMMDDTHHMMSS 1</span>
<a name="l00004"></a><a class="code" href="_parse_time_str_8c.html#4f4e2f3e10dc38d7cab395d944fc34fc">00004</a> <span class="preprocessor"></span><span class="preprocessor">#define ISO_YYYYWwwDTHHMMSS 2</span>
<a name="l00005"></a><a class="code" href="_parse_time_str_8c.html#1a7be279762b73f218a800b7a8fdfdae">00005</a> <span class="preprocessor"></span><span class="preprocessor">#define ISO_YYYYMMDDTHHMM   3</span>
<a name="l00006"></a><a class="code" href="_parse_time_str_8c.html#491baa480fb693ff72ce7af7e5f80d13">00006</a> <span class="preprocessor"></span><span class="preprocessor">#define ISO_YYYYWwwDTHHMM   4</span>
<a name="l00007"></a><a class="code" href="_parse_time_str_8c.html#d771fd8212deeb2216d57ab1e2849a41">00007</a> <span class="preprocessor"></span><span class="preprocessor">#define ISO_YYYYMMDD        5</span>
<a name="l00008"></a><a class="code" href="_parse_time_str_8c.html#50a847fdfca395daa5fe22e22ff78504">00008</a> <span class="preprocessor"></span><span class="preprocessor">#define ISO_YYYYWwwD        6</span>
<a name="l00009"></a><a class="code" href="_parse_time_str_8c.html#88c524fa49cc84eaeb54a1d730ef22e0">00009</a> <span class="preprocessor"></span><span class="preprocessor">#define ISO_YYYYMM          7</span>
<a name="l00010"></a><a class="code" href="_parse_time_str_8c.html#d36fbb85a00cff362a3f3843c8515559">00010</a> <span class="preprocessor"></span><span class="preprocessor">#define ISO_YYYYWww         8</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span>
<a name="l00012"></a>00012 <span class="keyword">static</span> PerlInterpreter *my_perl;
<a name="l00013"></a>00013 
<a name="l00014"></a><a class="code" href="_parse_time_str_8c.html#ee5ecc4b3638e9d9106ae724c2134256">00014</a> <a class="code" href="_parse_time_str_8c.html#ee5ecc4b3638e9d9106ae724c2134256">ParseTimeString</a>( <span class="keywordtype">char</span> *TimeString ) {
<a name="l00015"></a>00015 
<a name="l00016"></a>00016     <span class="keywordtype">int</span>     Year, wYear, Month, Day, Hours, Minutes, TZD_sgn, TZD_hh, TZD_mm, Week, DayOfWeek;
<a name="l00017"></a>00017     <span class="keywordtype">int</span>     ISOFormat;
<a name="l00018"></a>00018     <span class="keywordtype">double</span>  Seconds;
<a name="l00019"></a>00019     STRLEN  n_a;
<a name="l00020"></a>00020     <span class="keywordtype">char</span>    *embedding[] = { <span class="stringliteral">""</span>, <span class="stringliteral">"-e"</span>, <span class="stringliteral">"0"</span> };
<a name="l00021"></a>00021     <span class="keywordtype">char</span>    Str[6000];
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024     my_perl = perl_alloc();
<a name="l00025"></a>00025     perl_construct( my_perl );
<a name="l00026"></a>00026 
<a name="l00027"></a>00027     perl_parse(my_perl, NULL, 3, embedding, NULL);
<a name="l00028"></a>00028     perl_run(my_perl);
<a name="l00029"></a>00029 
<a name="l00030"></a>00030     <span class="comment">/* </span>
<a name="l00031"></a>00031 <span class="comment">     * ISO 8601 Time Formats are strictly formated, but have a number of variations</span>
<a name="l00032"></a>00032 <span class="comment">     * as follows;</span>
<a name="l00033"></a>00033 <span class="comment">     *</span>
<a name="l00034"></a>00034 <span class="comment">     *     YYYY</span>
<a name="l00035"></a>00035 <span class="comment">     *     YYYY-MM</span>
<a name="l00036"></a>00036 <span class="comment">     *     YYYY-MM-DD (hypens optional)</span>
<a name="l00037"></a>00037 <span class="comment">     *     YYYY-MM-DDThh:mmTZD (hypens and colons optional)</span>
<a name="l00038"></a>00038 <span class="comment">     *     YYYY-MM-DDThh:mm:ssTZD (hypens and colons optional)</span>
<a name="l00039"></a>00039 <span class="comment">     *     YYYY-Www (hypens can be omitted)</span>
<a name="l00040"></a>00040 <span class="comment">     *     YYYY-Www-D (hypens can be omitted)</span>
<a name="l00041"></a>00041 <span class="comment">     *</span>
<a name="l00042"></a>00042 <span class="comment">     * where,</span>
<a name="l00043"></a>00043 <span class="comment">     * </span>
<a name="l00044"></a>00044 <span class="comment">     *     YYYY = four-digit year</span>
<a name="l00045"></a>00045 <span class="comment">     *     MM   = two-digit month (01=January, etc.)</span>
<a name="l00046"></a>00046 <span class="comment">     *     DD   = two-digit day of month (01 through 31)</span>
<a name="l00047"></a>00047 <span class="comment">     *     hh   = two digits of hour (00 through 23) (am/pm NOT allowed)</span>
<a name="l00048"></a>00048 <span class="comment">     *     mm   = two digits of minute (00 through 59)</span>
<a name="l00049"></a>00049 <span class="comment">     *     ss   = two digits of second (00 through 59)</span>
<a name="l00050"></a>00050 <span class="comment">     *     s    = one or more digits representing a decimal fraction of a second</span>
<a name="l00051"></a>00051 <span class="comment">     *     TZD  = time zone designator (Z or +hh:mm or -hh:mm) (colons optional)</span>
<a name="l00052"></a>00052 <span class="comment">     *     ww   = ww is the week of the year</span>
<a name="l00053"></a>00053 <span class="comment">     *     D    = ww is day of week </span>
<a name="l00054"></a>00054 <span class="comment">     * </span>
<a name="l00055"></a>00055 <span class="comment">     * The hypens and colons are optional above except in the YYYY-MM format.</span>
<a name="l00056"></a>00056 <span class="comment">     *</span>
<a name="l00057"></a>00057 <span class="comment">     * YYYY can be positive or negative but only if users agree on it (so by</span>
<a name="l00058"></a>00058 <span class="comment">     * default its not in the standard). Here we assume it to be positive.</span>
<a name="l00059"></a>00059 <span class="comment">     *</span>
<a name="l00060"></a>00060 <span class="comment">     * Also, its not clear that if you omit one hyphen you have to omit them</span>
<a name="l00061"></a>00061 <span class="comment">     * all.  Or that omitting one colon means you have to omit them all. Check</span>
<a name="l00062"></a>00062 <span class="comment">     * the standard on this, but here I allow you to omit any number of them.</span>
<a name="l00063"></a>00063 <span class="comment">     * E.g., 2009-06-21T05:12:34.01Z and 2009-0621T0512:34.01Z should be</span>
<a name="l00064"></a>00064 <span class="comment">     * treated the same here.</span>
<a name="l00065"></a>00065 <span class="comment">     *</span>
<a name="l00066"></a>00066 <span class="comment">     * Combined Date and Time formats must have the T separating them, but you</span>
<a name="l00067"></a>00067 <span class="comment">     * can also have separate date and time formats and we recognize both E.g.,</span>
<a name="l00068"></a>00068 <span class="comment">     * 2009-06-21T05:12:34.01Z versus 2009-06-21 05:12:34.01Z</span>
<a name="l00069"></a>00069 <span class="comment">     */</span>
<a name="l00070"></a>00070     sprintf( Str, <span class="stringliteral">" $str = '%s';\n\</span>
<a name="l00071"></a>00071 <span class="stringliteral">                    $str =~ m/^\\s*(\\S*\\s*\\S*)\\s*$/; $str = $1; # Strip leading and trailing whitespace\n\</span>
<a name="l00072"></a>00072 <span class="stringliteral">                    $str =~ s/\\s{2,}/ /g; # Compress out extraneous whitespace\n\</span>
<a name="l00073"></a>00073 <span class="stringliteral">                    print \"str = $str\\n\";\n\</span>
<a name="l00074"></a>00074 <span class="stringliteral">                    my $ISOFormat = 0; my $Year = -9999; my $Month = -9999; my $Day = -9999; my $Hour = -9999; my $Minute = -9999; my $Second = -9999; my $TZD = -9999;\n\</span>
<a name="l00075"></a>00075 <span class="stringliteral">                    if ( $str =~ m/^(\\d{4})-?(\\d{2})-?(\\d{2})[T ](\\d{2}):?(\\d{2}):?(\\d{2}[\\.]?\\d*)([+-]\\d{2}:?\\d{2}|Z)/ ) { #  YYYY[-]MM[-]DDThh[:]mm[:]ss[.ssssss](TZD or Z)\n\</span>
<a name="l00076"></a>00076 <span class="stringliteral">                        $Year = $1; $Month = $2; $Day = $3; $Hour = $4; $Minute = $5; $Second = $6; $TZD = $7; $ISOFormat = 1;\n\</span>
<a name="l00077"></a>00077 <span class="stringliteral">                    } elsif ( $str =~ m/^(\\d{4})-?W(\\d{2})-?(\\d{1})[T ](\\d{2}):?(\\d{2}):?(\\d{2}[\\.]?\\d*)([+-]\\d{2}:?\\d{2}|Z)/ ) { #  YYYY[-]Www[-]DThh[:]mm[:]ss[.ssssss](TZD or Z)\n\</span>
<a name="l00078"></a>00078 <span class="stringliteral">                        $Year = $1; $Week = $2; $DayOfWeek = $3; $Hour = $4; $Minute = $5; $Second = $6; $TZD = $7; $ISOFormat = 2;\n\</span>
<a name="l00079"></a>00079 <span class="stringliteral">                    } elsif ( $str =~ m/^(\\d{4})-?(\\d{2})-?(\\d{2})[T ](\\d{2}):?(\\d{2})([+-]\\d{2}:?\\d{2}|Z)$/ ) { #  YYYY[-]MM[-]DDThh[:]mm(TZD or Z)\n\</span>
<a name="l00080"></a>00080 <span class="stringliteral">                        $Year = $1; $Month = $2; $Day = $3; $Hour = $4; $Minute = $5; $TZD = $6; $ISOFormat = 3;\n\</span>
<a name="l00081"></a>00081 <span class="stringliteral">                    } elsif ( $str =~ m/^(\\d{4})-?W(\\d{2})-?(\\d{1})[T ](\\d{2}):?(\\d{2})([+-]\\d{2}:?\\d{2}|Z)$/ ) { #  YYYY[-]Www[-]DThh[:]mm(TZD or Z)\n\</span>
<a name="l00082"></a>00082 <span class="stringliteral">                        $Year = $1; $Week = $2; $DayOfWeek = $3; $Hour = $4; $Minute = $5; $TZD = $6; $ISOFormat = 4;\n\</span>
<a name="l00083"></a>00083 <span class="stringliteral">                    } elsif ( $str =~ m/^(\\d{4})-?(\\d{2})-?(\\d{2})$/ ) { # YYYY[-]MM[-]DD\n\</span>
<a name="l00084"></a>00084 <span class="stringliteral">                        $Year = $1; $Month = $2; $Day = $3;  $ISOFormat = 5;\n\</span>
<a name="l00085"></a>00085 <span class="stringliteral">                    } elsif ( $str =~ m/^(\\d{4})-?W(\\d{2})-?(\\d{1})$/ ) { # YYYY[-]Www[-]D\n\</span>
<a name="l00086"></a>00086 <span class="stringliteral">                        $Year = $1; $Week = $2; $DayOfWeek = $3;  $ISOFormat = 6;\n\</span>
<a name="l00087"></a>00087 <span class="stringliteral">                    } elsif ( $str =~ m/^(\\d{4})-(\\d{2})$/ ) { # YYYY-MM\n\</span>
<a name="l00088"></a>00088 <span class="stringliteral">                        $Year = $1; $Month = $2;  $ISOFormat = 7;\n\</span>
<a name="l00089"></a>00089 <span class="stringliteral">                    } elsif ( $str =~ m/^(\\d{4})-W(\\d{2})$/ ) { # YYYY-Www\n\</span>
<a name="l00090"></a>00090 <span class="stringliteral">                        $Year = $1; $Week = $2;  $ISOFormat = 8;\n\</span>
<a name="l00091"></a>00091 <span class="stringliteral">                    } elsif ( $str =~ m/^(\\d{4})$/ ) { # YYYY\n\</span>
<a name="l00092"></a>00092 <span class="stringliteral">                        $Year = $1; $ISOFormat = 9;\n\</span>
<a name="l00093"></a>00093 <span class="stringliteral">                    }\n\</span>
<a name="l00094"></a>00094 <span class="stringliteral">                    if ( $TZD =~ m/^Z$/ ) {\n\</span>
<a name="l00095"></a>00095 <span class="stringliteral">                        $TZD_sgn = +1; $TZD_hh = 0; $TZD_mm = 0;\n\</span>
<a name="l00096"></a>00096 <span class="stringliteral">                    } elsif ( $TZD =~ m/^([+-])(\\d{2}):?(\\d{2})$/ ) {\n\</span>
<a name="l00097"></a>00097 <span class="stringliteral">                        $TZD_sgn = ($1 == '+') ? +1 : -1; $TZD_hh = $2; $TZD_mm = $3;\n\</span>
<a name="l00098"></a>00098 <span class="stringliteral">                    } elsif ( $TZD =~ m/^([+-])(\\d{2})$/ ) {\n\</span>
<a name="l00099"></a>00099 <span class="stringliteral">                        $TZD_sgn = ($1 == '+') ? +1 : -1; $TZD_hh = $2; $TZD_mm = 0;\n\</span>
<a name="l00100"></a>00100 <span class="stringliteral">                    } else { \n\</span>
<a name="l00101"></a>00101 <span class="stringliteral">                        $TZD_sgn = +1; $TZD_hh = 0; $TZD_mm = 0;\n\</span>
<a name="l00102"></a>00102 <span class="stringliteral">                    }\n\</span>
<a name="l00103"></a>00103 <span class="stringliteral">                    $oYear = $Year; $oMonth = $Month; $oDay = $Day; $oHour = $Hour; $oMinute = $Minute; $oSecond = $Second; $oTZD = $TZD; $oTZD_sgn = $TZD_sgn; $oTZD_hh = $TZD_hh; $oTZD_mm = $TZD_mm; $oWeek = $Week; $oDayOfWeek = $DayOfWeek; $oISOFormat = $ISOFormat;\n"</span>, TimeString);
<a name="l00104"></a>00104     
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     eval_pv( Str, <a class="code" href="_lgm___c_trans_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> );
<a name="l00107"></a>00107     printf( <span class="stringliteral">"Year      = %d\n"</span>,  Year = SvIV(get_sv(<span class="stringliteral">"oYear"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) );
<a name="l00108"></a>00108     printf( <span class="stringliteral">"Month     = %d\n"</span>,  Month = SvIV(get_sv(<span class="stringliteral">"oMonth"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) );
<a name="l00109"></a>00109     printf( <span class="stringliteral">"Day       = %d\n"</span>,  Day = SvIV(get_sv(<span class="stringliteral">"oDay"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) );
<a name="l00110"></a>00110     printf( <span class="stringliteral">"Hours     = %d\n"</span>,  Hours = SvIV(get_sv(<span class="stringliteral">"oHour"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) );
<a name="l00111"></a>00111     printf( <span class="stringliteral">"Minutes   = %d\n"</span>,  Minutes = SvIV(get_sv(<span class="stringliteral">"oMinute"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) );
<a name="l00112"></a>00112     printf( <span class="stringliteral">"Seconds   = %lf\n"</span>, Seconds = atof(SvPV(get_sv(<span class="stringliteral">"oSecond"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>), n_a)));
<a name="l00113"></a>00113     printf( <span class="stringliteral">"TZD_sgn   = %d\n"</span>,  TZD_sgn = SvIV(get_sv(<span class="stringliteral">"oTZD_sgn"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) );
<a name="l00114"></a>00114     printf( <span class="stringliteral">"TZD_hh    = %d\n"</span>,  TZD_hh = SvIV(get_sv(<span class="stringliteral">"oTZD_hh"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) );
<a name="l00115"></a>00115     printf( <span class="stringliteral">"TZD_mm    = %d\n"</span>,  TZD_mm = SvIV(get_sv(<span class="stringliteral">"oTZD_mm"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) );
<a name="l00116"></a>00116     printf( <span class="stringliteral">"Week      = %d\n"</span>,  Week = SvIV(get_sv(<span class="stringliteral">"oWeek"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) );
<a name="l00117"></a>00117     printf( <span class="stringliteral">"DayOfWeek = %d\n"</span>,  DayOfWeek = SvIV(get_sv(<span class="stringliteral">"oDayOfWeek"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) );
<a name="l00118"></a>00118     printf( <span class="stringliteral">"ISOFormat = %d\n"</span>,  ISOFormat = SvIV(get_sv(<span class="stringliteral">"oISOFormat"</span>, <a class="code" href="_lgm___c_trans_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) );
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     perl_destruct(my_perl);
<a name="l00121"></a>00121     perl_free(my_perl);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     <span class="comment">/*</span>
<a name="l00125"></a>00125 <span class="comment">     * Test for sane numbers</span>
<a name="l00126"></a>00126 <span class="comment">     */</span>
<a name="l00127"></a>00127     <span class="keywordflow">if</span>        ( (ISOFormat == <a class="code" href="_parse_time_str_8c.html#8fc0d2e02d252654157f1b50f8c44426">ISO_YYYYMMDDTHHMMSS</a>) || (ISOFormat == <a class="code" href="_parse_time_str_8c.html#1a7be279762b73f218a800b7a8fdfdae">ISO_YYYYMMDDTHHMM</a>) ) {
<a name="l00128"></a>00128 
<a name="l00129"></a>00129         <span class="keywordflow">if</span> (ISOFormat == <a class="code" href="_parse_time_str_8c.html#1a7be279762b73f218a800b7a8fdfdae">ISO_YYYYMMDDTHHMM</a>) Seconds = 0.0; <span class="comment">// assume seconds are zero</span>
<a name="l00130"></a>00130 
<a name="l00131"></a>00131         <span class="keywordflow">if</span> ( ( Year &lt; 0 ) || ( Year &gt; 9999 ) ) {
<a name="l00132"></a>00132             printf( <span class="stringliteral">"Year Out of Range!\n"</span>, Year );
<a name="l00133"></a>00133             <span class="keywordflow">return</span>( -1 );
<a name="l00134"></a>00134         }
<a name="l00135"></a>00135         <span class="keywordflow">if</span> ( ( Month &lt; 1 ) || ( Month &gt; 12 ) ) {
<a name="l00136"></a>00136             printf( <span class="stringliteral">"Month Out of Range!\n"</span>, Month );
<a name="l00137"></a>00137             <span class="keywordflow">return</span>( -1 );
<a name="l00138"></a>00138         }
<a name="l00139"></a>00139         <span class="keywordflow">if</span> ( ( Day &lt; 1 ) || ( Day &gt; 31 ) ) {
<a name="l00140"></a>00140             printf( <span class="stringliteral">"Day Out of Range!\n"</span>, Day );
<a name="l00141"></a>00141             <span class="keywordflow">return</span>( -1 );
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143         <span class="keywordflow">if</span> ( ( Hours &lt; 0 ) || ( Hours &gt; 23 ) ) {
<a name="l00144"></a>00144             printf( <span class="stringliteral">"Hours Out of Range!\n"</span>, Hours );
<a name="l00145"></a>00145             <span class="keywordflow">return</span>( -1 );
<a name="l00146"></a>00146         }
<a name="l00147"></a>00147         <span class="keywordflow">if</span> ( ( Minutes &lt; 0 ) || ( Minutes &gt; 59 ) ) {
<a name="l00148"></a>00148             printf( <span class="stringliteral">"Minutes Out of Range!\n"</span>, Minutes );
<a name="l00149"></a>00149             <span class="keywordflow">return</span>( -1 );
<a name="l00150"></a>00150         }
<a name="l00151"></a>00151         <span class="keywordflow">if</span> ( ( Seconds &lt; 0 ) || ( Seconds &gt; 60 ) ) { <span class="comment">// Yes seconds can be 60 to accomodate leap seconds</span>
<a name="l00152"></a>00152             printf( <span class="stringliteral">"Seconds Out of Range!\n"</span>, Seconds ); 
<a name="l00153"></a>00153             <span class="keywordflow">return</span>( -1 );
<a name="l00154"></a>00154         }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (ISOFormat = <a class="code" href="_parse_time_str_8c.html#491baa480fb693ff72ce7af7e5f80d13">ISO_YYYYWwwDTHHMM</a>) || (ISOFormat = <a class="code" href="_parse_time_str_8c.html#4f4e2f3e10dc38d7cab395d944fc34fc">ISO_YYYYWwwDTHHMMSS</a>) ) {
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         <span class="keywordflow">if</span> (ISOFormat = <a class="code" href="_parse_time_str_8c.html#4f4e2f3e10dc38d7cab395d944fc34fc">ISO_YYYYWwwDTHHMMSS</a>) Seconds = 0.0; <span class="comment">// assume seconds are zero</span>
<a name="l00159"></a>00159         wYear = Year;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161         <span class="keywordflow">if</span> ( ( wYear &lt; 0 ) || ( wYear &gt; 9999 ) ) {
<a name="l00162"></a>00162             printf( <span class="stringliteral">"wYear Out of Range!\n"</span>, wYear );
<a name="l00163"></a>00163             <span class="keywordflow">return</span>( -1 );
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165         <span class="keywordflow">if</span> ( ( Week &lt; 1 ) || ( Week &gt; 53 ) ) {
<a name="l00166"></a>00166             printf( <span class="stringliteral">"Week Out of Range!\n"</span>, Week );
<a name="l00167"></a>00167             <span class="keywordflow">return</span>( -1 );
<a name="l00168"></a>00168         }
<a name="l00169"></a>00169         <span class="keywordflow">if</span> ( ( DayOfWeek &lt; 1 ) || ( DayOfWeek &gt; 7 ) ) {
<a name="l00170"></a>00170             printf( <span class="stringliteral">"DayOfWeek Out of Range!\n"</span>, DayOfWeek );
<a name="l00171"></a>00171             <span class="keywordflow">return</span>( -1 );
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173         <span class="keywordflow">if</span> ( ( Hours &lt; 0 ) || ( Hours &gt; 23 ) ) {
<a name="l00174"></a>00174             printf( <span class="stringliteral">"Hours Out of Range!\n"</span>, Hours );
<a name="l00175"></a>00175             <span class="keywordflow">return</span>( -1 );
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177         <span class="keywordflow">if</span> ( ( Minutes &lt; 0 ) || ( Minutes &gt; 59 ) ) {
<a name="l00178"></a>00178             printf( <span class="stringliteral">"Minutes Out of Range!\n"</span>, Minutes );
<a name="l00179"></a>00179             <span class="keywordflow">return</span>( -1 );
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181         <span class="keywordflow">if</span> ( ( Seconds &lt; 0 ) || ( Seconds &gt; 60 ) ) { <span class="comment">// Yes seconds can be 60 to accomodate leap seconds</span>
<a name="l00182"></a>00182             printf( <span class="stringliteral">"Seconds Out of Range!\n"</span>, Seconds ); 
<a name="l00183"></a>00183             <span class="keywordflow">return</span>( -1 );
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (ISOFormat = <a class="code" href="_parse_time_str_8c.html#88c524fa49cc84eaeb54a1d730ef22e0">ISO_YYYYMM</a>) || (ISOFormat = <a class="code" href="_parse_time_str_8c.html#d771fd8212deeb2216d57ab1e2849a41">ISO_YYYYMMDD</a>) ) {
<a name="l00187"></a>00187         
<a name="l00188"></a>00188         <span class="keywordflow">if</span> ( ISOFormat = <a class="code" href="_parse_time_str_8c.html#88c524fa49cc84eaeb54a1d730ef22e0">ISO_YYYYMM</a> ) Day = 1; <span class="comment">//assume day is 1st day on Month</span>
<a name="l00189"></a>00189 
<a name="l00190"></a>00190         <span class="keywordflow">if</span> ( ( Year &lt; 0 ) || ( Year &gt; 9999 ) ) {
<a name="l00191"></a>00191             printf( <span class="stringliteral">"Year Out of Range!\n"</span>, Year );
<a name="l00192"></a>00192             <span class="keywordflow">return</span>( -1 );
<a name="l00193"></a>00193         }
<a name="l00194"></a>00194         <span class="keywordflow">if</span> ( ( Month &lt; 1 ) || ( Month &gt; 12 ) ) {
<a name="l00195"></a>00195             printf( <span class="stringliteral">"Month Out of Range!\n"</span>, Month );
<a name="l00196"></a>00196             <span class="keywordflow">return</span>( -1 );
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198         <span class="keywordflow">if</span> ( ( Day &lt; 1 ) || ( Day &gt; 31 ) ) {
<a name="l00199"></a>00199             printf( <span class="stringliteral">"Day Out of Range!\n"</span>, Day );
<a name="l00200"></a>00200             <span class="keywordflow">return</span>( -1 );
<a name="l00201"></a>00201         }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (ISOFormat = <a class="code" href="_parse_time_str_8c.html#d36fbb85a00cff362a3f3843c8515559">ISO_YYYYWww</a>) || (ISOFormat = <a class="code" href="_parse_time_str_8c.html#50a847fdfca395daa5fe22e22ff78504">ISO_YYYYWwwD</a>) ) {
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         <span class="keywordflow">if</span> ( ISOFormat = <a class="code" href="_parse_time_str_8c.html#d36fbb85a00cff362a3f3843c8515559">ISO_YYYYWww</a> ) DayOfWeek = 1; <span class="comment">//assume day is 1st day on Week</span>
<a name="l00206"></a>00206         wYear = Year;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208         <span class="keywordflow">if</span> ( ( wYear &lt; 0 ) || ( wYear &gt; 9999 ) ) {
<a name="l00209"></a>00209             printf( <span class="stringliteral">"Year Out of Range!\n"</span>, wYear );
<a name="l00210"></a>00210             <span class="keywordflow">return</span>( -1 );
<a name="l00211"></a>00211         }
<a name="l00212"></a>00212         <span class="keywordflow">if</span> ( ( Week &lt; 1 ) || ( Week &gt; 53 ) ) {
<a name="l00213"></a>00213             printf( <span class="stringliteral">"Week Out of Range!\n"</span>, Week );
<a name="l00214"></a>00214             <span class="keywordflow">return</span>( -1 );
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216         <span class="keywordflow">if</span> ( ( DayOfWeek &lt; 1 ) || ( DayOfWeek &gt; 7 ) ) {
<a name="l00217"></a>00217             printf( <span class="stringliteral">"DayOfWeek Out of Range!\n"</span>, DayOfWeek );
<a name="l00218"></a>00218             <span class="keywordflow">return</span>( -1 );
<a name="l00219"></a>00219         }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00230"></a><a class="code" href="_parse_time_str_8c.html#fea1a4f62fd5d298db88b24644adc4c6">00230</a> <a class="code" href="_parse_time_str_8c.html#fea1a4f62fd5d298db88b24644adc4c6">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv, <span class="keywordtype">char</span> **env) {
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="keywordtype">char</span>    TimeString[128];
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     sprintf(TimeString, <span class="stringliteral">"2009-06-21T05:12:34.123456789Z"</span>);
<a name="l00235"></a>00235     sprintf(TimeString, <span class="stringliteral">"2009-06-21T05:1234.01Z"</span>);
<a name="l00236"></a>00236     sprintf(TimeString, <span class="stringliteral">"2009-06-21                           0512:34.01Z"</span>);
<a name="l00237"></a>00237     sprintf(TimeString, <span class="stringliteral">"2009-0621T99:12:34.123456789-03:34"</span>);
<a name="l00238"></a>00238     sprintf(TimeString, <span class="stringliteral">"2009-W52-7T2312:34.01Z"</span>);
<a name="l00239"></a>00239     printf(<span class="stringliteral">"TimeString = %s\n"</span>, TimeString );
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     <a class="code" href="_parse_time_str_8c.html#ee5ecc4b3638e9d9106ae724c2134256">ParseTimeString</a>( TimeString );
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small><a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> </small></address>
</body>
</html>
